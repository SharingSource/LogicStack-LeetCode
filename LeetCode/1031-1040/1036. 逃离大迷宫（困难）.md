### é¢˜ç›®æè¿°

è¿™æ˜¯ LeetCode ä¸Šçš„ **[1036. é€ƒç¦»å¤§è¿·å®«](https://leetcode-cn.com/problems/escape-a-large-maze/solution/gong-shui-san-xie-bfs-gei-ding-zhang-ai-8w63o/)** ï¼Œéš¾åº¦ä¸º **å›°éš¾**ã€‚

Tag : ã€Œå‡ ä½•ã€ã€ã€ŒBFSã€



åœ¨ä¸€ä¸ª $10^6$ x $10^6$ çš„ç½‘æ ¼ä¸­ï¼Œæ¯ä¸ªç½‘æ ¼ä¸Šæ–¹æ ¼çš„åæ ‡ä¸ºÂ $(x, y)$ ã€‚

ç°åœ¨ä»æºæ–¹æ ¼Â $source = [s_x, s_y]$Â å¼€å§‹å‡ºå‘ï¼Œæ„å›¾èµ¶å¾€ç›®æ ‡æ–¹æ ¼Â $target = [t_x, t_y]$ ã€‚

æ•°ç»„ $blocked$ æ˜¯å°é”çš„æ–¹æ ¼åˆ—è¡¨ï¼Œå…¶ä¸­æ¯ä¸ª $blocked[i] = [x_i, y_i]$ è¡¨ç¤ºåæ ‡ä¸º $(x_i, y_i)$ çš„æ–¹æ ¼æ˜¯ç¦æ­¢é€šè¡Œçš„ã€‚

æ¯æ¬¡ç§»åŠ¨ï¼Œéƒ½å¯ä»¥èµ°åˆ°ç½‘æ ¼ä¸­åœ¨å››ä¸ªæ–¹å‘ä¸Šç›¸é‚»çš„æ–¹æ ¼ï¼Œåªè¦è¯¥æ–¹æ ¼ ä¸ åœ¨ç»™å‡ºçš„å°é”åˆ—è¡¨Â $blocked$Â ä¸Šã€‚åŒæ—¶ï¼Œä¸å…è®¸èµ°å‡ºç½‘æ ¼ã€‚

åªæœ‰åœ¨å¯ä»¥é€šè¿‡ä¸€ç³»åˆ—çš„ç§»åŠ¨ä»æºæ–¹æ ¼Â $source$ åˆ°è¾¾ç›®æ ‡æ–¹æ ¼Â $target$ æ—¶æ‰è¿”å›Â $true$ã€‚å¦åˆ™ï¼Œè¿”å› $false$ã€‚

ç¤ºä¾‹ 1ï¼š
```
è¾“å…¥ï¼šblocked = [[0,1],[1,0]], source = [0,0], target = [0,2]

è¾“å‡ºï¼šfalse

è§£é‡Šï¼š
ä»æºæ–¹æ ¼æ— æ³•åˆ°è¾¾ç›®æ ‡æ–¹æ ¼ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•åœ¨ç½‘æ ¼ä¸­ç§»åŠ¨ã€‚
æ— æ³•å‘åŒ—æˆ–è€…å‘ä¸œç§»åŠ¨æ˜¯å› ä¸ºæ–¹æ ¼ç¦æ­¢é€šè¡Œã€‚
æ— æ³•å‘å—æˆ–è€…å‘è¥¿ç§»åŠ¨æ˜¯å› ä¸ºä¸èƒ½èµ°å‡ºç½‘æ ¼ã€‚
```
ç¤ºä¾‹ 2ï¼š
```
è¾“å…¥ï¼šblocked = [], source = [0,0], target = [999999,999999]

è¾“å‡ºï¼štrue

è§£é‡Šï¼š
å› ä¸ºæ²¡æœ‰æ–¹æ ¼è¢«å°é”ï¼Œæ‰€ä»¥ä¸€å®šå¯ä»¥åˆ°è¾¾ç›®æ ‡æ–¹æ ¼ã€‚
```

æç¤ºï¼š
* $0 <= blocked.length <= 200$
* $blocked[i].length == 2$
* $0 <= xi, yi < 10^6$
* $source.length == target.length == 2$
* $0 <= sx, sy, tx, ty < 10^6$
* $source != target$
* é¢˜ç›®æ•°æ®ä¿è¯ $source$ å’Œ $target$ ä¸åœ¨å°é”åˆ—è¡¨å†…

---

### BFS + ç»™å®šéšœç¢ç‰©æ‰€èƒ½å›´æˆçš„æœ€å¤§é¢ç§¯

ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ç”¨ $s$ ä»£æŒ‡ $source$ï¼Œç”¨ $t$ ä»£æŒ‡ $target$ï¼Œç”¨ $n$ æ¥ä»£æŒ‡ $blocked$ å¤§å°ã€‚

æ•´ç†é¢˜æ„ä¸ºï¼šåœ¨ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç©ºé—´é‡Œï¼Œæœ‰å°‘æ•°çš„éšœç¢ç‰©ï¼Œé—®ä¸¤ç‚¹æ˜¯å¦è¿é€šã€‚

å½“ä¸¤ç‚¹ç›¸éš”è¾ƒè¿œæ—¶ï¼Œå¸¸è§„çš„ `BFS` åšæ³•å¯èƒ½ä¼šæœå®Œæ•´ä¸ªæ£‹ç›˜ï¼Œè€Œæ£‹ç›˜å¤§å°ä¸º $10^6 * 10^6$ï¼Œä¼š `TLE`ã€‚

è€ƒè™‘ä»€ä¹ˆæƒ…å†µä¸‹ä¸¤ç‚¹ä¼šä¸è¿é€šï¼Ÿ

å½“ä¸¤ä¸ªç‚¹ä¸­çš„ä»»æ„ä¸€ç‚¹è¢«éšœç¢ç‰©å›´ä½æ—¶ï¼Œä¸¤ç‚¹å°†æ— æ³•è¿é€šã€‚

ä¸€ä¸ªå¾ˆå®¹æ˜“æƒ³åˆ°çš„æ€è·¯æ˜¯ï¼š**ä» $s$ è·‘ä¸€é `BFS`ï¼Œç„¶åä» $t$ è·‘ä¸€é `BFS`ï¼ŒåŒæ—¶è®¾å®šä¸€ä¸ªæœ€å¤§è®¿é—®ç‚¹æ•°é‡ `MAX`ï¼Œè‹¥ä»ä¸¤è€…å‡ºå‘èƒ½å¤Ÿè®¿é—®çš„ç‚¹æ•°é‡éƒ½èƒ½è¶…è¿‡ `MAX`ï¼Œè¯´æ˜ä¸¤ç‚¹å‡æ²¡æœ‰è¢«å›´ä½ï¼Œæœ€ç»ˆå¿…ç„¶ä¼šè”é€šã€‚**

è€ƒè™‘å¦‚ä½•æ•²å®š `MAX`  çš„å–å€¼èŒƒå›´ï¼Ÿç›´è§‚æ„Ÿå—ï¼Œ`MAX` åº”è¯¥æ˜¯ä¸€ä¸ªä¸ $blocked$ å¤§å°ç›¸å…³çš„æ•°ã€‚

ä½†ç¬¬ä¸€ååº”è¿˜æ˜¯æƒ³ä»å•ç§’è®¡ç®—é‡ä¸Šç•Œè¿›è¡Œåæ¨ï¼Œä¸¤è¾¹ `BFS`  çš„å¤æ‚åº¦å‡ä¸º $O(\max)$ï¼Œå› æ­¤ç›´æ¥è®¾å®š `MAX = 1e5` åº”è¯¥æ˜¯æ¯”è¾ƒåˆé€‚çš„ã€‚

æ›´å°çš„ `MAX` éœ€è¦è¯æ˜ï¼š**åœ¨ç»™å®šæ•°é‡éšœç¢ç‰©çš„å‰æä¸‹ï¼Œéšœç¢ç‰©æ‰€èƒ½å›´æˆçš„æœ€å¤§é¢ç§¯ä¸ºå¤šå°‘ã€‚**

é¦–å…ˆï¼Œå®¹æ˜“æƒ³åˆ°ï¼š**ä»»ä½•ä¸€æ¡å°é—­å›¾å½¢çš„ç›´è¾¹éƒ½å¯ä»¥é€šè¿‡è°ƒæ•´ä¸ºæ–œè¾¹æ¥å›´æˆæ›´å¤§çš„é¢ç§¯ï¼š**

![image.png](https://pic.leetcode-cn.com/1641855571-IOaJZJ-image.png)

**å³ç»„æˆå°é—­å›¾å½¢çš„è¾¹ä¸å¯èƒ½æœ‰ç›´è¾¹ï¼ŒåŒæ—¶ç”±äºæ˜¯å°é—­å›¾å½¢ï¼Œå› æ­¤æ–œè¾¹ç›´æ¥å¿…ç„¶æ˜¯å•ç‚¹è¡”æ¥ï¼Œè€Œä¸å¯èƒ½æ˜¯å¹³è¡Œï¼ˆæ— æ³•å°é—­ï¼‰ã€‚**

åŒæ—¶ï¼Œ**æƒ³è¦è¾¾åˆ°æœ€å¤§é¢ç§¯ï¼Œåº”å½“å°½å¯èƒ½åˆ©ç”¨è¾¹ç•Œä½œä¸ºå›´æˆå›¾å½¢çš„æŸäº›è¾¹ã€‚**

åˆ©ç”¨è¾¹ç•Œæ‰€èƒ½å›´æˆçš„æœ€å¤§å°é¢å›¾å½¢ **å¯ä»¥æ˜¯**ã€Œç”±è¾¹ç•Œæä¾›ä¸¤è¾¹ï¼Œéšœç¢ç‰©æä¾›ä¸€è¾¹çš„ä¸‰è§’å½¢ã€ã€‚

å¦‚æœä¸æ˜¯è¯¥å½¢çŠ¶ï¼Œåˆ™å¯ä»¥é€šè¿‡è°ƒæ•´éšœç¢ç‰©çš„ç›´è¾¹ä¸ºä¸€æ¡å®Œæ•´çš„æ–œè¾¹ï¼Œæ¥ç»„æˆå°é—­ä¸‰è§’å½¢ï¼Œå›´æˆé¢ç§¯ä¸ä¼šå˜å°ï¼š

![image.png](https://pic.leetcode-cn.com/1641856898-BYFygs-image.png)

å³ç»™å®š $n$ çš„æƒ…å†µä¸‹ï¼Œæ ¹æ®ã€Œç­‰å·®æ•°åˆ—æ±‚å’Œã€å¯çŸ¥ï¼Œæœ€å¤§æ‰€èƒ½å›´æˆçš„é¢ç§¯ä¸º $1 + 2 + ... + n - 1 = \frac{n * (n - 1)}{2}$ã€‚

å› æ­¤å¦‚æœä» $s$ å’Œ $t$ å‡ºå‘ï¼Œèƒ½å¤Ÿè®¿é—®çš„ç‚¹æ•°è¶…è¿‡ $\frac{n * (n - 1)}{2}$ ä¸ªï¼Œé‚£ä¹ˆä¸¤ç‚¹å¹¶æ²¡æœ‰è¢«å›´ä½ï¼Œå¿…ç„¶è”é€šã€‚

æœ€åï¼Œä¸ºäº†åœ¨ `BFS` è¿‡ç¨‹ä¸­è®°å½•æŸäº›ç‚¹è¢«è®¿é—®è¿‡ï¼Œå¯ä»¥é€šè¿‡è®¡ç®—æŸä¸ªä½ç½®å“ˆå¸Œå€¼ï¼ˆæ•°å€¼ï¼‰æ¥å®ç°ã€‚

**ä»£ç ï¼ˆæ„Ÿè°¢ [@ğŸ­å¯ä¹å¯ä¹å—QAQ](/u/littletime_cc/) å’Œ [@Benhao](/u/himymben/) åŒå­¦æä¾›çš„å…¶ä»–è¯­è¨€ç‰ˆæœ¬ï¼‰ï¼š**
```Java
class Solution {
    int EDGE = (int)1e6, MAX = (int)1e5;
    long BASE = 131L;
    Set<Long> set = new HashSet<>();
    int[][] dir = new int[][]{{1,0},{-1,0},{0,1},{0,-1}};
    public boolean isEscapePossible(int[][] blocked, int[] s, int[] t) {
        for (int[] p : blocked) set.add(p[0] * BASE + p[1]);
        int n = blocked.length;
        MAX = n * (n - 1) / 2; // å¯ç›´æ¥ä½¿ç”¨ 1e5
        return check(s, t) && check(t, s);
    }
    boolean check(int[] a, int[] b) {
        Set<Long> vis = new HashSet<>();
        Deque<int[]> d = new ArrayDeque<>();
        d.addLast(a);
        vis.add(a[0] * BASE + a[1]);
        while (!d.isEmpty() && vis.size() <= MAX) {
            int[] poll = d.pollFirst();
            int x = poll[0], y = poll[1];
            if (x == b[0] && y == b[1]) return true;
            for (int[] di : dir) {
                int nx = x + di[0], ny = y + di[1];
                if (nx < 0 || nx >= EDGE || ny < 0 || ny >= EDGE) continue;
                long hash = nx * BASE + ny;
                if (set.contains(hash)) continue;
                if (vis.contains(hash)) continue;
                d.addLast(new int[]{nx, ny});
                vis.add(hash);
            }
        }
        return vis.size() > MAX;
    }
}
```


```C++
class Solution {
public:
    int EDGE = 1e6, MAX = 1e5;
    long long BASE = 13331;
    unordered_set<long long> set;
    int dir[4][2] = { {1, 0}, {-1, 0}, {0, 1}, {0, -1} };
    bool isEscapePossible(vector<vector<int>>& blocked, vector<int>& s, vector<int>& t) {
        for(auto& p : blocked) set.insert(p[0] * BASE + p[1]);
        int n = blocked.size();
        MAX = n * (n - 1) / 2; // å¯ç›´æ¥ä½¿ç”¨ 1e5
        return check(s, t) and check(t, s);
    }
    bool check(vector<int>& a, vector<int>& b){
        unordered_set<long long> vis;
        queue< pair<int,int> > q;
        q.push( {a[0], a[1]});
        vis.insert(a[0] * BASE + a[1]);
        while(q.size() and vis.size() <= MAX){
            auto t = q.front();
            q.pop();
            int x = t.first, y = t.second;
            if(x == b[0] and y == b[1]) return true;
            for(int i = 0; i < 4; i++){
                int nx = x + dir[i][0], ny = y + dir[i][1];
                if(nx < 0 or nx >= EDGE or ny < 0 or ny >= EDGE) continue;
                if(set.count(nx * BASE + ny)) continue;
                if(vis.count(nx * BASE + ny)) continue;
                q.push( {nx, ny} );
                vis.insert(nx * BASE + ny);
            }
        }
        return vis.size() > MAX;
    }
};
```


```Python
EDGE, MAX, BASE, DIR = int(1e6), int(1e5), 131, [(1, 0), (-1, 0), (0, 1), (0, -1)]
class Solution:
    def isEscapePossible(self, blocked: List[List[int]], source: List[int], target: List[int]) -> bool:
        block = {p[0] * BASE + p[1] for p in blocked}
        n = len(blocked)
        MAX = n * (n-1)//2 # å¯ç›´æ¥ä½¿ç”¨ 1e5
        def check(a, b):
            vis = {a[0] * BASE + a[1]}
            d = deque([a])
            while len(d) and len(vis) <= MAX:
                x, y = d.popleft()
                if x == b[0] and y == b[1]:
                    return True
                for dx, dy in DIR:
                    nx, ny = x + dx, y + dy
                    if nx < 0 or nx >= EDGE or ny < 0 or ny >= EDGE:
                        continue
                    h = nx * BASE + ny
                    if h in block or h in vis:
                        continue
                    d.append((nx, ny))
                    vis.add(h)
            return len(vis) > MAX
        return check(source, target) and check(target, source)
```
* æ—¶é—´å¤æ‚åº¦ï¼šä»¤ $n$ ä¸º $blocked$ å¤§å°ï¼Œä¸¤æ¬¡ `BFS` çš„æœ€å¤§è®¿é—®ç‚¹æ•°ä¸º $\frac{n * (n - 1)}{2}$ã€‚æ•´ä½“å¤æ‚åº¦ä¸º $O(n^2)$
* ç©ºé—´å¤æ‚åº¦ï¼šä¸¤æ¬¡ `BFS` çš„æœ€å¤§è®¿é—®ç‚¹æ•°ä¸º $\frac{n * (n - 1)}{2}$ã€‚æ•´ä½“å¤æ‚åº¦ä¸º $O(n^2)$

---

### æœ€å

è¿™æ˜¯æˆ‘ä»¬ã€Œåˆ·ç©¿ LeetCodeã€ç³»åˆ—æ–‡ç« çš„ç¬¬ `No.1036` ç¯‡ï¼Œç³»åˆ—å¼€å§‹äº 2021/01/01ï¼Œæˆªæ­¢äºèµ·å§‹æ—¥ LeetCode ä¸Šå…±æœ‰ 1916 é“é¢˜ç›®ï¼Œéƒ¨åˆ†æ˜¯æœ‰é”é¢˜ï¼Œæˆ‘ä»¬å°†å…ˆæŠŠæ‰€æœ‰ä¸å¸¦é”çš„é¢˜ç›®åˆ·å®Œã€‚

åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« é‡Œé¢ï¼Œé™¤äº†è®²è§£è§£é¢˜æ€è·¯ä»¥å¤–ï¼Œè¿˜ä¼šå°½å¯èƒ½ç»™å‡ºæœ€ä¸ºç®€æ´çš„ä»£ç ã€‚å¦‚æœæ¶‰åŠé€šè§£è¿˜ä¼šç›¸åº”çš„ä»£ç æ¨¡æ¿ã€‚

ä¸ºäº†æ–¹ä¾¿å„ä½åŒå­¦èƒ½å¤Ÿç”µè„‘ä¸Šè¿›è¡Œè°ƒè¯•å’Œæäº¤ä»£ç ï¼Œæˆ‘å»ºç«‹äº†ç›¸å…³çš„ä»“åº“ï¼šhttps://github.com/SharingSource/LogicStack-LeetCode ã€‚

åœ¨ä»“åº“åœ°å€é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°ç³»åˆ—æ–‡ç« çš„é¢˜è§£é“¾æ¥ã€ç³»åˆ—æ–‡ç« çš„ç›¸åº”ä»£ç ã€LeetCode åŸé¢˜é“¾æ¥å’Œå…¶ä»–ä¼˜é€‰é¢˜è§£ã€‚

