### é¢˜ç›®æè¿°

è¿™æ˜¯ LeetCode ä¸Šçš„ **[96. ä¸åŒçš„äºŒå‰æœç´¢æ ‘](https://leetcode.cn/problems/unique-binary-search-trees/solutions/2438266/gong-shui-san-xie-cong-qu-jian-dp-dao-qi-fz5z/)** ï¼Œéš¾åº¦ä¸º **ä¸­ç­‰**ã€‚

Tag : ã€Œæ ‘ã€ã€ã€ŒäºŒå‰æœç´¢æ ‘ã€ã€ã€ŒåŠ¨æ€è§„åˆ’ã€ã€ã€ŒåŒºé—´ DPã€ã€ã€Œæ•°å­¦ã€ã€ã€Œå¡ç‰¹å…°æ•°ã€



ç»™ä½ ä¸€ä¸ªæ•´æ•° `n` ï¼Œæ±‚æ°ç”± `n` ä¸ªèŠ‚ç‚¹ç»„æˆä¸”èŠ‚ç‚¹å€¼ä» `1` åˆ° `n` äº’ä¸ç›¸åŒçš„ äºŒå‰æœç´¢æ ‘ æœ‰å¤šå°‘ç§ï¼Ÿ

è¿”å›æ»¡è¶³é¢˜æ„çš„äºŒå‰æœç´¢æ ‘çš„ç§æ•°ã€‚

ç¤ºä¾‹ 1ï¼š
![](https://assets.leetcode.com/uploads/2021/01/18/uniquebstn3.jpg)
```
è¾“å…¥ï¼šn = 3

è¾“å‡ºï¼š5
```
ç¤ºä¾‹ 2ï¼š
```
è¾“å…¥ï¼šn = 1

è¾“å‡ºï¼š1
```

æç¤ºï¼š
* $1 <= n <= 19$

---

### åŒºé—´ DP

æ²¿ç”¨ [95. ä¸åŒçš„äºŒå‰æœç´¢æ ‘ II](https://www.acoier.com/2022/12/09/95.%20%E4%B8%8D%E5%90%8C%E7%9A%84%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%20II%EF%BC%88%E4%B8%AD%E7%AD%89%EF%BC%89/) çš„åŸºæœ¬æ€è·¯ï¼Œåªä¸è¿‡æœ¬é¢˜ä¸æ˜¯æ±‚å…·ä½“æ–¹æ¡ˆï¼Œè€Œæ˜¯æ±‚ä¸ªæ•°ã€‚

é™¤äº†èƒ½ç”¨ [95. ä¸åŒçš„äºŒå‰æœç´¢æ ‘ II](https://www.acoier.com/2022/12/09/95.%20%E4%B8%8D%E5%90%8C%E7%9A%84%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%20II%EF%BC%88%E4%B8%AD%E7%AD%89%EF%BC%89/) æåˆ°çš„ã€Œå¡ç‰¹å…°æ•°ã€ç›´æ¥æ±‚è§£ $n$ ä¸ªèŠ‚ç‚¹çš„ä»¥å¤–ï¼Œæœ¬é¢˜è¿˜èƒ½é€šè¿‡å¸¸è§„ã€ŒåŒºé—´ DPã€çš„æ–¹å¼è¿›è¡Œæ±‚è§£ã€‚

> æ±‚æ•°é‡ä½¿ç”¨ DPï¼Œæ±‚æ‰€æœ‰å…·ä½“æ–¹æ¡ˆä½¿ç”¨çˆ†æœï¼Œæ˜¯æå…¶å¸¸è§çš„ä¸€é¢˜å¤šé—®æ­é…ã€‚

**å®šä¹‰ $f[l][r]$ ä¸ºä½¿ç”¨æ•°å€¼èŒƒå›´åœ¨ $[l, r]$ ä¹‹é—´çš„èŠ‚ç‚¹ï¼Œæ‰€èƒ½æ„å»ºçš„ `BST` ä¸ªæ•°**ã€‚

ä¸å¤±ä¸€èˆ¬æ€§è€ƒè™‘ $f[l][r]$ è¯¥å¦‚ä½•æ±‚è§£ï¼Œä»ç”¨ $[l, r]$ ä¸­çš„æ ¹èŠ‚ç‚¹ `i` ä¸ºä½•å€¼ï¼Œä½œä¸ºåˆ‡å…¥ç‚¹è¿›è¡Œæ€è€ƒã€‚

æ ¹æ®ã€Œ`BST` å®šä¹‰ã€åŠã€Œä¹˜æ³•åŸç†ã€å¯çŸ¥ï¼š$[l, i - 1]$ ç›¸å…³èŠ‚ç‚¹æ„æˆçš„ `BST`  å­æ ‘åªèƒ½åœ¨ `i` çš„å·¦è¾¹ï¼Œè€Œ $[i + 1, r]$ ç›¸å…³èŠ‚ç‚¹æ„æˆçš„ `BST`  å­æ ‘åªèƒ½åœ¨ `i` çš„å³è¾¹ã€‚æ‰€æœ‰çš„å·¦å³å­æ ‘ç›¸äº’ç‹¬ç«‹ï¼Œå› æ­¤ä»¥ `i` ä¸ºæ ¹èŠ‚ç‚¹çš„ `BST` æ•°é‡ä¸º $f[l][i - 1] \times f[i + 1][r]$ï¼Œè€Œ `i` å…±æœ‰ $r - l + 1$ ä¸ªå–å€¼ï¼ˆ$i \in [l, r]$ï¼‰ã€‚

å³æœ‰ï¼š
$$
f[l][r] = \sum_{i = l}^{r} (f[l][i - 1] \times f[i + 1][r])
$$
ä¸éš¾å‘ç°ï¼Œæ±‚è§£åŒºé—´ $[l, r]$ çš„ `BST`  æ•°é‡ $f[l][r]$ ä¾èµ–äºæ¯”å…¶å°çš„åŒºé—´ $[l, i - 1]$ å’Œ $[i + 1, r]$ï¼Œè¿™å¼•å¯¼æˆ‘ä»¬ä½¿ç”¨ã€ŒåŒºé—´ DPã€çš„æ–¹å¼è¿›è¡Œé€’æ¨ã€‚

> ä¸äº†è§£åŒºé—´ DP çš„åŒå­¦ï¼Œå¯çœ‹ [å‰ç½® ğŸ§€](https://mp.weixin.qq.com/s/RuIKpDEuxkhhKiTeVRMXng)

ä¸€äº›ç»†èŠ‚ï¼šç”±äºæˆ‘ä»¬ `i` çš„å–å€¼å¯èƒ½ä¼šå–åˆ°åŒºé—´ä¸­çš„æœ€å€¼ `l` å’Œ `r`ï¼Œä¸ºäº†èƒ½å¤Ÿè¯¥æƒ…å†µä¸‹ï¼Œ$f[l][i - 1]$ å’Œ $f[i + 1][r]$ èƒ½å¤Ÿé¡ºåˆ©å‚ä¸è½¬ç§»ï¼Œèµ·å§‹æˆ‘ä»¬éœ€è¦å…ˆå¯¹æ‰€æœ‰æ»¡è¶³ $i >= j$ çš„ $f[i][j]$ åˆå§‹åŒ–ä¸º `1`ã€‚

Java ä»£ç ï¼š
```Java
class Solution {
    public int numTrees(int n) {
        int[][] f = new int[n + 10][n + 10];
        for (int i = 0; i <= n + 1; i++) {
            for (int j = 0; j <= n + 1; j++) {
                if (i >= j) f[i][j] = 1;
            }
        }
        for (int len = 2; len <= n; len++) {
            for (int l = 1; l + len - 1 <= n; l++) {
                int r = l + len - 1;
                for (int i = l; i <= r; i++) {
                    f[l][r] += f[l][i - 1] * f[i + 1][r];
                }
            }
        }
        return f[1][n];
    }
}
```
C++ ä»£ç ï¼š
```C++
class Solution {
public:
    int numTrees(int n) {
        vector<vector<int>> f(n + 2, vector<int>(n + 2, 0));
        for (int i = 0; i <= n + 1; i++) {
            for (int j = 0; j <= n + 1; j++) {
                if (i >= j) f[i][j] = 1;
            }
        }
        for (int len = 2; len <= n; len++) {
            for (int l = 1; l + len - 1 <= n; l++) {
                int r = l + len - 1;
                for (int i = l; i <= r; i++) {
                    f[l][r] += f[l][i - 1] * f[i + 1][r];
                }
            }
        }
        return f[1][n];
    }
};
```
Python ä»£ç ï¼š
```Python
class Solution(object):
    def numTrees(self, n):
        f = [[0] * (n + 2) for _ in range(n + 2)]
        for i in range(n + 2):
            for j in range(n + 2):
                if i >= j:
                    f[i][j] = 1
        for length in range(2, n + 1):
            for l in range(1, n - length + 2):
                r = l + length - 1
                for i in range(l, r + 1):
                    f[l][r] += f[l][i - 1] * f[i + 1][r]
        return f[1][n]
```
TypeScript ä»£ç ï¼š
```TypeScript
function numTrees(n: number): number {
    const f = new Array(n + 2).fill(0).map(() => new Array(n + 2).fill(0));
    for (let i = 0; i <= n + 1; i++) {
        for (let j = 0; j <= n + 1; j++) {
            if (i >= j) f[i][j] = 1;
        }
    }
    for (let len = 2; len <= n; len++) {
        for (let l = 1; l + len - 1 <= n; l++) {
            const r = l + len - 1;
            for (let i = l; i <= r; i++) {
                f[l][r] += f[l][i - 1] * f[i + 1][r];
            }
        }
    }
    return f[1][n];
};
```
* æ—¶é—´å¤æ‚åº¦ï¼š$O(n^3)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n^2)$

---

### åŒºé—´ DPï¼ˆä¼˜åŒ–ï¼‰

æ±‚è§£å®Œä½¿ç”¨ $[1, n]$ å…± $n$ ä¸ªè¿ç»­æ•°æ‰€èƒ½æ„æˆçš„ `BST`  ä¸ªæ•°åï¼Œå†æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šä½¿ç”¨ $[L, R]$ å…± $n = R - L + 1$ ä¸ªè¿ç»­æ•°ï¼Œæ‰€èƒ½æ„æˆçš„ `BST`  ä¸ªæ•°åˆæ˜¯å¤šå°‘ã€‚

ç­”æ¡ˆæ˜¯ä¸€æ ·çš„ã€‚

**ç”± $n$ ä¸ªè¿ç»­æ•°æ„æˆçš„ `BST`  ä¸ªæ•°ä»…ä¸æ•°å€¼ä¸ªæ•°æœ‰å…³ç³»ï¼Œä¸æ•°å€¼å¤§å°æœ¬èº«å¹¶æ— å…³ç³»**ã€‚

ç”±äºå¯çŸ¥ï¼Œæˆ‘ä»¬ä¸Šè¿°çš„ã€ŒåŒºé—´ DPã€å¿…ç„¶è¿›è¡Œäº†å¤§é‡é‡å¤è®¡ç®—ï¼Œä¾‹å¦‚ $f[1][3]$ å’Œ $f[2][4]$ åŒä¸ºå¤§å°ä¸º $3$ çš„åŒºé—´ï¼Œå´è¢«è®¡ç®—äº†ä¸¤æ¬¡ã€‚

è°ƒæ•´æˆ‘ä»¬çš„çŠ¶æ€å®šä¹‰ï¼š**å®šä¹‰ $f[k]$ ä¸ºè€ƒè™‘è¿ç»­æ•°ä¸ªæ•°ä¸º $k$ æ—¶ï¼Œæ‰€èƒ½æ„æˆçš„ `BST`  çš„ä¸ªæ•°**ã€‚

ä¸å¤±ä¸€èˆ¬æ€§è€ƒè™‘ $f[i]$ å¦‚ä½•è®¡ç®—ï¼Œä»ç”¨ $[1, i]$ ä¸­å“ªä¸ªæ•°å€¼ä½œä¸ºæ ¹èŠ‚ç‚¹è¿›è¡Œè€ƒè™‘ã€‚å‡è®¾ä½¿ç”¨æ•°å€¼ $j$ ä½œä¸ºæ ¹èŠ‚ç‚¹ï¼Œåˆ™æœ‰ $f[j - 1] \times f[i - j]$ ä¸ª `BST` å¯è´¡çŒ®åˆ° $f[i]$ï¼Œè€Œ $j$ å…±æœ‰ $i$ ä¸ªå–å€¼ï¼ˆ$j \in [1, i]$ï¼‰ã€‚

å³æœ‰ï¼š
$$
f[i] = \sum_{j = 1}^{i}(f[j - 1] \times f[i - j])
$$

åŒæ—¶æœ‰åˆå§‹åŒ– $f[0] = 1$ï¼Œå«ä¹‰ä¸ºæ²¡æœ‰ä»»ä½•è¿ç»­æ•°æ—¶ï¼Œåªæœ‰â€œç©ºæ ‘â€ä¸€ç§åˆæ³•æ–¹æ¡ˆã€‚

Java ä»£ç ï¼š
```Java
class Solution {
    public int numTrees(int n) {
        int[] f = new int[n + 10];
        f[0] = 1;
        for (int i = 1; i <= n; i++) {
            for (int j = 1; j <= i; j++) {
                f[i] += f[j - 1] * f[i - j];
            }
        }
        return f[n];
    }
}
```
C++ ä»£ç ï¼š
```C++
class Solution {
public:
    int numTrees(int n) {
        vector<int> f(n + 10, 0);
        f[0] = 1;
        for (int i = 1; i <= n; i++) {
            for (int j = 1; j <= i; j++) {
                f[i] += f[j - 1] * f[i - j];
            }
        }
        return f[n];
    }
};
```
Python ä»£ç ï¼š
```Python
class Solution:
    def numTrees(self, n: int) -> int:
        f = [0] * (n + 10)
        f[0] = 1
        for i in range(1, n + 1):
            for j in range(1, i + 1):
                f[i] += f[j - 1] * f[i - j]
        return f[n]
```
TypeScript ä»£ç ï¼š
```TypeScript
function numTrees(n: number): number {
    const f = new Array(n + 10).fill(0);
    f[0] = 1;
    for (let i = 1; i <= n; i++) {
        for (let j = 1; j <= i; j++) {
            f[i] += f[j - 1] * f[i - j];
        }
    }
    return f[n];
};
```
* æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

---

### æ•°å­¦ - å¡ç‰¹å…°æ•°

åœ¨ã€ŒåŒºé—´ DPï¼ˆä¼˜åŒ–ï¼‰ã€ä¸­çš„é€’æ¨è¿‡ç¨‹ï¼Œæ­£æ˜¯â€œå¡ç‰¹å…°æ•°â€çš„ $O(n^2)$ é€’æ¨è¿‡ç¨‹ã€‚é€šè¿‡å¯¹å¸¸è§„ã€ŒåŒºé—´ DPã€çš„ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¾—è¯ [95. ä¸åŒçš„äºŒå‰æœç´¢æ ‘ II](https://www.acoier.com/2022/12/09/95.%20%E4%B8%8D%E5%90%8C%E7%9A%84%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%20II%EF%BC%88%E4%B8%AD%E7%AD%89%EF%BC%89/) ä¸­ã€Œç»™å®š $n$ ä¸ªèŠ‚ç‚¹æ‰€èƒ½æ„æˆçš„ `BST`  çš„ä¸ªæ•°ä¸ºå¡ç‰¹å…°æ•°ã€è¿™ä¸€ç»“è®ºã€‚

å¯¹äºç²¾ç¡®æ±‚å¡ç‰¹å…°æ•°ï¼Œå­˜åœ¨æ—¶é—´å¤æ‚åº¦ä¸º $O(n)$ çš„é€šé¡¹å…¬å¼åšæ³•ï¼Œå…¬å¼ä¸º $C_{n+1} = \frac{C_n \cdot (4n + 2)}{n + 2}$ã€‚

Java ä»£ç ï¼š

```Java
class Solution {
    public int numTrees(int n) {
        if (n <= 1) return 1;
        long ans = 1;
        for (int i = 0; i < n; i++) ans = ans * (4 * i + 2) / (i + 2);
        return (int)ans;
    }
}
```
C++ ä»£ç ï¼š
```C++
class Solution {
public:
    int numTrees(int n) {
        if (n <= 1) return 1;
        long long ans = 1;
        for (int i = 0; i < n; i++) ans = ans * (4 * i + 2) / (i + 2);
        return (int)ans;
    }
};
```
Python ä»£ç ï¼š
```Python
class Solution:
    def numTrees(self, n: int) -> int:
        if n <= 1:
            return 1
        ans = 1
        for i in range(n):
            ans = ans * (4 * i + 2) // (i + 2)
        return ans
```
TypeScript ä»£ç ï¼š
```TypeScript
function numTrees(n: number): number {
    if (n <= 1) return 1;
    let ans = 1;
    for (let i = 0; i < n; i++) ans = ans * (4 * i + 2) / (i + 2);
    return ans;
};
```
* æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$

---

### æœ€å

è¿™æ˜¯æˆ‘ä»¬ã€Œåˆ·ç©¿ LeetCodeã€ç³»åˆ—æ–‡ç« çš„ç¬¬ `No.96` ç¯‡ï¼Œç³»åˆ—å¼€å§‹äº 2021/01/01ï¼Œæˆªæ­¢äºèµ·å§‹æ—¥ LeetCode ä¸Šå…±æœ‰ 1916 é“é¢˜ç›®ï¼Œéƒ¨åˆ†æ˜¯æœ‰é”é¢˜ï¼Œæˆ‘ä»¬å°†å…ˆæŠŠæ‰€æœ‰ä¸å¸¦é”çš„é¢˜ç›®åˆ·å®Œã€‚

åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« é‡Œé¢ï¼Œé™¤äº†è®²è§£è§£é¢˜æ€è·¯ä»¥å¤–ï¼Œè¿˜ä¼šå°½å¯èƒ½ç»™å‡ºæœ€ä¸ºç®€æ´çš„ä»£ç ã€‚å¦‚æœæ¶‰åŠé€šè§£è¿˜ä¼šç›¸åº”çš„ä»£ç æ¨¡æ¿ã€‚

ä¸ºäº†æ–¹ä¾¿å„ä½åŒå­¦èƒ½å¤Ÿç”µè„‘ä¸Šè¿›è¡Œè°ƒè¯•å’Œæäº¤ä»£ç ï¼Œæˆ‘å»ºç«‹äº†ç›¸å…³çš„ä»“åº“ï¼šhttps://github.com/SharingSource/LogicStack-LeetCode ã€‚

åœ¨ä»“åº“åœ°å€é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°ç³»åˆ—æ–‡ç« çš„é¢˜è§£é“¾æ¥ã€ç³»åˆ—æ–‡ç« çš„ç›¸åº”ä»£ç ã€LeetCode åŸé¢˜é“¾æ¥å’Œå…¶ä»–ä¼˜é€‰é¢˜è§£ã€‚

