### é¢˜ç›®æè¿°

è¿™æ˜¯ LeetCode ä¸Šçš„ **[430. æ‰å¹³åŒ–å¤šçº§åŒå‘é“¾è¡¨](https://leetcode-cn.com/problems/flatten-a-multilevel-doubly-linked-list/solution/gong-shui-san-xie-yi-ti-shuang-jie-di-gu-9wfz/)** ï¼Œéš¾åº¦ä¸º **ä¸­ç­‰**ã€‚

Tag : ã€Œé“¾è¡¨ã€ã€ã€Œè¿­ä»£ã€ã€ã€Œé€’å½’ã€

å¤šçº§åŒå‘é“¾è¡¨ä¸­ï¼Œé™¤äº†æŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å’Œå‰ä¸€ä¸ªèŠ‚ç‚¹æŒ‡é’ˆä¹‹å¤–ï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªå­é“¾è¡¨æŒ‡é’ˆï¼Œå¯èƒ½æŒ‡å‘å•ç‹¬çš„åŒå‘é“¾è¡¨ã€‚è¿™äº›å­åˆ—è¡¨ä¹Ÿå¯èƒ½ä¼šæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè‡ªå·±çš„å­é¡¹ï¼Œä¾æ­¤ç±»æ¨ï¼Œç”Ÿæˆå¤šçº§æ•°æ®ç»“æ„ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤ºã€‚

ç»™ä½ ä½äºåˆ—è¡¨ç¬¬ä¸€çº§çš„å¤´èŠ‚ç‚¹ï¼Œè¯·ä½ æ‰å¹³åŒ–åˆ—è¡¨ï¼Œä½¿æ‰€æœ‰ç»“ç‚¹å‡ºç°åœ¨å•çº§åŒé“¾è¡¨ä¸­ã€‚

ç¤ºä¾‹ 1ï¼š
```
è¾“å…¥ï¼šhead = [1,2,3,4,5,6,null,null,null,7,8,9,10,null,null,11,12]

è¾“å‡ºï¼š[1,2,3,7,8,11,12,9,10,4,5,6]

è§£é‡Šï¼š
```
è¾“å…¥çš„å¤šçº§åˆ—è¡¨å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
![](https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2018/10/12/multilevellinkedlist.png)
æ‰å¹³åŒ–åçš„é“¾è¡¨å¦‚ä¸‹å›¾ï¼š
![](https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2018/10/12/multilevellinkedlistflattened.png)
ç¤ºä¾‹ 2ï¼š
```
è¾“å…¥ï¼šhead = [1,2,null,3]

è¾“å‡ºï¼š[1,3,2]

è§£é‡Šï¼š
è¾“å…¥çš„å¤šçº§åˆ—è¡¨å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

  1---2---NULL
  |
  3---NULL
```

ç¤ºä¾‹ 3ï¼š
```
è¾“å…¥ï¼šhead = []

è¾“å‡ºï¼š[]
```

---

### é€’å½’

ä¸€é“å¸¸è§„é“¾è¡¨æ¨¡æ‹Ÿé¢˜ã€‚

åˆ©ç”¨ `flatten` å‡½æ•°æœ¬èº«çš„å«ä¹‰ï¼ˆå°†é“¾è¡¨å¤´ä¸º $head$ çš„é“¾è¡¨è¿›è¡Œæ‰å¹³åŒ–ï¼Œå¹¶å°†æ‰å¹³åŒ–åçš„å¤´ç»“ç‚¹è¿›è¡Œè¿”å›ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“å†™å‡ºé€’å½’ç‰ˆæœ¬ã€‚

ä¸ºé˜²æ­¢ç©ºèŠ‚ç‚¹ç­‰è¾¹ç•Œé—®é¢˜ï¼Œèµ·å§‹æ—¶å»ºç«‹ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹ $dummy$ æŒ‡å‘ $head$ï¼Œç„¶ååˆ©ç”¨ $head$ æŒ‡é’ˆä»å‰å¾€åå¤„ç†é“¾è¡¨ï¼š

* å½“å‰èŠ‚ç‚¹ $head$ æ²¡æœ‰ $child$ èŠ‚ç‚¹ï¼šç›´æ¥è®©æŒ‡é’ˆåå³å¯ï¼Œå³ $head = head.next$ï¼›
* å½“å‰èŠ‚ç‚¹ $head$ æœ‰ $child$ èŠ‚ç‚¹ï¼šå°† $head.child$ ä¼ å…¥ `flatten` å‡½æ•°é€’å½’å¤„ç†ï¼Œæ‹¿åˆ°æ™®éåŒ–åçš„å¤´ç»“ç‚¹ $chead$ï¼Œç„¶åå°† $head$ å’Œ $chead$ å»ºç«‹â€œç›¸é‚»â€å…³ç³»ï¼ˆæ³¨æ„è¦å…ˆå­˜èµ·æ¥åŸæœ¬çš„ $tmp = head.next$ ä»¥åŠå°† $head.child$ ç½®ç©ºï¼‰ï¼Œç„¶åç»§ç»­å¾€åå¤„ç†ï¼Œç›´åˆ°æ‰å¹³åŒ–çš„ $chead$ é“¾è¡¨çš„å°¾éƒ¨ï¼Œå°†å…¶ä¸ $tmp$ å»ºç«‹â€œç›¸é‚»â€å…³ç³»ã€‚

é‡å¤ä¸Šè¿°è¿‡ç¨‹ï¼Œç›´åˆ°æ•´æ¡é“¾è¡¨è¢«å¤„ç†å®Œã€‚

![image.png](https://pic.leetcode-cn.com/1632439438-NXVGYC-image.png)

ä»£ç ï¼š
```Java
class Solution {
    public Node flatten(Node head) {
        Node dummy = new Node(0);
        dummy.next = head;
        while (head != null) {
            if (head.child == null) {
                head = head.next;
            } else {
                Node tmp = head.next;
                Node chead = flatten(head.child);
                head.next = chead;
                chead.prev = head;
                head.child = null;
                while (head.next != null) head = head.next;
                head.next = tmp;
                if (tmp != null) tmp.prev = head;
                head = tmp;
            }
        }
        return dummy.next;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šæœ€åæƒ…å†µä¸‹ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¼šè¢«è®¿é—® $h$ æ¬¡ï¼ˆ$h$ ä¸ºé€’å½’æ·±åº¦ï¼Œæœ€åæƒ…å†µä¸‹ $h = n$ï¼‰ã€‚æ•´ä½“å¤æ‚åº¦ä¸º $O(n^2)$
* ç©ºé—´å¤æ‚åº¦ï¼šæœ€åæƒ…å†µä¸‹æ‰€æœ‰èŠ‚ç‚¹éƒ½åˆ†å¸ƒåœ¨ `child` ä¸­ï¼Œæ­¤æ—¶é€’å½’æ·±åº¦ä¸º $n$ã€‚å¤æ‚åº¦ä¸º $O(n)$

---

### é€’å½’ï¼ˆä¼˜åŒ–ï¼‰

åœ¨ä¸Šè¿°è§£æ³•ä¸­ï¼Œç”±äºæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ `flatten` ä½œä¸ºé€’å½’å‡½æ•°ï¼Œå¯¼è‡´é€’å½’å¤„ç† $head.child$ åä¸å¾—ä¸å†è¿›è¡Œéå†æ¥æ‰¾å½“å‰å±‚çš„â€œå°¾ç»“ç‚¹â€ï¼Œè¿™å¯¼è‡´ç®—æ³•å¤æ‚åº¦ä¸º $O(n^2)$ã€‚

ä¸€ä¸ªå¯è¡Œçš„ä¼˜åŒ–æ˜¯ï¼Œé¢å¤–è®¾è®¡ä¸€ä¸ªé€’å½’å‡½æ•° `dfs` ç”¨äºè¿”å›æ‰å¹³åŒ–åçš„é“¾è¡¨â€œå°¾ç»“ç‚¹â€ï¼Œä»è€Œç¡®ä¿æˆ‘ä»¬æ‰¾å°¾ç»“ç‚¹çš„åŠ¨ä½œä¸ä¼šåœ¨æ¯å±‚å‘ç”Ÿã€‚

![image.png](https://pic.leetcode-cn.com/1632439410-oXoxbn-image.png)

ä»£ç ï¼š
```Java
class Solution {
    public Node flatten(Node head) {
        dfs(head);
        return head;
    }
    Node dfs(Node head) {
        Node last = head;
        while (head != null) {
            if (head.child == null) {
                last = head;
                head = head.next;
            } else {
                Node tmp = head.next;
                Node childLast = dfs(head.child);
                head.next = head.child;
                head.child.prev = head;
                head.child = null;
                if (childLast != null) childLast.next = tmp;
                if (tmp != null) tmp.prev = childLast;
                last = head;
                head = childLast;
            }
        }
        return last;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$
* ç©ºé—´å¤æ‚åº¦ï¼šæœ€åæƒ…å†µä¸‹æ‰€æœ‰èŠ‚ç‚¹éƒ½åˆ†å¸ƒåœ¨ `child` ä¸­ï¼Œæ­¤æ—¶é€’å½’æ·±åº¦ä¸º $n$ã€‚å¤æ‚åº¦ä¸º $O(n)$

---

### è¿­ä»£

è‡ªç„¶ä¹Ÿèƒ½å¤Ÿä½¿ç”¨è¿­ä»£è¿›è¡Œæ±‚è§£ã€‚

ä¸ã€Œé€’å½’ã€ä¸åŒçš„æ˜¯ï¼Œã€Œè¿­ä»£ã€æ˜¯ä»¥â€œæ®µâ€ä¸ºå•ä½è¿›è¡Œæ‰å¹³åŒ–ï¼Œè€Œã€Œé€’å½’ã€æ˜¯ä»¥æ·±åº¦ï¼ˆæ–¹å‘ï¼‰è¿›è¡Œæ‰å¹³åŒ–ï¼Œè¿™å°±å¯¼è‡´äº†ä¸¤ç§æ–¹å¼å¯¹æ¯ä¸ªæ‰å¹³èŠ‚ç‚¹çš„å¤„ç†é¡ºåºä¸åŒã€‚

å·²æ ·ä¾‹ $1$ ä¸º ğŸŒ°ã€‚

é€’å½’çš„å¤„ç†èŠ‚ç‚¹ï¼ˆæ–°çš„ $next$ æŒ‡é’ˆçš„æ„å»ºï¼‰é¡ºåºä¸ºï¼š

![image.png](https://pic.leetcode-cn.com/1632439764-FsOwel-image.png)

è¿­ä»£çš„å¤„ç†èŠ‚ç‚¹ï¼ˆæ–°çš„ $next$ æŒ‡é’ˆçš„æ„å»ºï¼‰é¡ºåºä¸ºï¼š

![image.png](https://pic.leetcode-cn.com/1632439844-egvBMX-image.png)

ä½†ç”±äºé“¾è¡¨æœ¬èº«ä¸å­˜åœ¨ç¯ï¼Œã€Œè¿­ä»£ã€çš„æ„å»ºé¡ºåºå‘ç”Ÿè°ƒæ•´ï¼Œä»ç„¶å¯ä»¥ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹è¢«è®¿é—®çš„æ¬¡æ•°ä¸ºå¸¸æ•°æ¬¡ã€‚

![image.png](https://pic.leetcode-cn.com/1632439410-oXoxbn-image.png)

ä»£ç ï¼š
```Java
class Solution {
    public Node flatten(Node head) {
        Node dummy = new Node(0);
        dummy.next = head;
        for (; head != null; ) {
            if (head.child == null) {
                head = head.next;
            } else {
                Node tmp = head.next;
                Node child = head.child;
                head.next = child;
                child.prev = head;
                head.child = null;
                Node last = head;
                while (last.next != null) last = last.next;
                last.next = tmp;
                if (tmp != null) tmp.prev = last;
                head = head.next;   
            }
        }
        return dummy.next;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šå¯ä»¥å‘ç°ï¼Œè¿­ä»£å†™æ³•çš„æ‰å¹³åŒ–è¿‡ç¨‹å¹¶ä¸ä¸éå†æ–¹å‘ä¿æŒä¸€è‡´ï¼ˆä»¥æ®µä¸ºå•ä½è¿›è¡Œæ‰å¹³åŒ–ï¼Œè€Œéåƒé€’å½’é‚£æ ·æ€»æ˜¯å¾€éå†æ–¹å‘è¿›è¡Œæ‰å¹³åŒ–ï¼‰ï¼Œä½†æ¯ä¸ªèŠ‚ç‚¹è¢«è®¿é—®çš„æ¬¡æ•°ä»ä¸ºå¸¸æ•°æ¬¡ã€‚å¤æ‚åº¦ä¸º $O(n)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$

---

### æœ€å

è¿™æ˜¯æˆ‘ä»¬ã€Œåˆ·ç©¿ LeetCodeã€ç³»åˆ—æ–‡ç« çš„ç¬¬ `No.430` ç¯‡ï¼Œç³»åˆ—å¼€å§‹äº 2021/01/01ï¼Œæˆªæ­¢äºèµ·å§‹æ—¥ LeetCode ä¸Šå…±æœ‰ 1916 é“é¢˜ç›®ï¼Œéƒ¨åˆ†æ˜¯æœ‰é”é¢˜ï¼Œæˆ‘ä»¬å°†å…ˆæŠŠæ‰€æœ‰ä¸å¸¦é”çš„é¢˜ç›®åˆ·å®Œã€‚

åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« é‡Œé¢ï¼Œé™¤äº†è®²è§£è§£é¢˜æ€è·¯ä»¥å¤–ï¼Œè¿˜ä¼šå°½å¯èƒ½ç»™å‡ºæœ€ä¸ºç®€æ´çš„ä»£ç ã€‚å¦‚æœæ¶‰åŠé€šè§£è¿˜ä¼šç›¸åº”çš„ä»£ç æ¨¡æ¿ã€‚

ä¸ºäº†æ–¹ä¾¿å„ä½åŒå­¦èƒ½å¤Ÿç”µè„‘ä¸Šè¿›è¡Œè°ƒè¯•å’Œæäº¤ä»£ç ï¼Œæˆ‘å»ºç«‹äº†ç›¸å…³çš„ä»“åº“ï¼šhttps://github.com/SharingSource/LogicStack-LeetCodeã€‚

åœ¨ä»“åº“åœ°å€é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°ç³»åˆ—æ–‡ç« çš„é¢˜è§£é“¾æ¥ã€ç³»åˆ—æ–‡ç« çš„ç›¸åº”ä»£ç ã€LeetCode åŸé¢˜é“¾æ¥å’Œå…¶ä»–ä¼˜é€‰é¢˜è§£ã€‚

