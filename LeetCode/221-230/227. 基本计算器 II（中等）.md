### é¢˜ç›®æè¿°

è¿™æ˜¯ LeetCode ä¸Šçš„ **[227. åŸºæœ¬è®¡ç®—å™¨ II](https://leetcode-cn.com/problems/basic-calculator-ii/solution/shi-yong-shuang-zhan-jie-jue-jiu-ji-biao-c65k/)** ï¼Œéš¾åº¦ä¸º **ä¸­ç­‰**ã€‚

Tag : ã€Œè¡¨è¾¾å¼è®¡ç®—ã€



ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨è¾¾å¼ s ï¼Œè¯·ä½ å®ç°ä¸€ä¸ªåŸºæœ¬è®¡ç®—å™¨æ¥è®¡ç®—å¹¶è¿”å›å®ƒçš„å€¼ã€‚

æ•´æ•°é™¤æ³•ä»…ä¿ç•™æ•´æ•°éƒ¨åˆ†ã€‚



ç¤ºä¾‹ 1ï¼š
```
è¾“å…¥ï¼šs = "3+2*2"
è¾“å‡ºï¼š7
```
ç¤ºä¾‹ 2ï¼š
```
è¾“å…¥ï¼šs = " 3/2 "
è¾“å‡ºï¼š1
```
ç¤ºä¾‹ 3ï¼š
```
è¾“å…¥ï¼šs = " 3+5 / 2 "
è¾“å‡ºï¼š5
```

æç¤ºï¼š
* 1 <= s.length <= 3 * $10^5$
* s ç”±æ•´æ•°å’Œç®—ç¬¦ ('+', '-', '*', '/') ç»„æˆï¼Œä¸­é—´ç”±ä¸€äº›ç©ºæ ¼éš”å¼€
* s è¡¨ç¤ºä¸€ä¸ª æœ‰æ•ˆè¡¨è¾¾å¼
* è¡¨è¾¾å¼ä¸­çš„æ‰€æœ‰æ•´æ•°éƒ½æ˜¯éè´Ÿæ•´æ•°ï¼Œä¸”åœ¨èŒƒå›´ [0, $2^{31}$ - 1] å†…
* é¢˜ç›®æ•°æ®ä¿è¯ç­”æ¡ˆæ˜¯ä¸€ä¸ª 32-bit æ•´æ•°

---

### åŒæ ˆè§£æ³•

å¦‚æœä½ æœ‰çœ‹è¿™ç¯‡ [é¢˜è§£](https://leetcode-cn.com/problems/basic-calculator/solution/shuang-zhan-jie-jue-tong-yong-biao-da-sh-olym/) çš„è¯ï¼Œä»Šå¤©è¿™é“é¢˜å°±æ˜¯é“ç»ƒä¹ é¢˜ã€‚

å¸®ä½ å·©å›º **åŒæ ˆè§£å†³ã€Œé€šç”¨è¡¨è¾¾å¼ã€é—®é¢˜çš„é€šç”¨è§£æ³•** ã€‚

**äº‹å®ä¸Šï¼Œæˆ‘æä¾›è¿™å¥—è§£å†³æ–¹æ¡ˆä¸ä»…ä»…èƒ½è§£å†³åªæœ‰ `+ - ( )`ï¼ˆ[224. åŸºæœ¬è®¡ç®—å™¨](https://leetcode-cn.com/problems/basic-calculator/)ï¼‰ æˆ–è€… `+ - * /`([227. åŸºæœ¬è®¡ç®—å™¨ II](https://leetcode-cn.com/problems/basic-calculator-ii/solution/)) çš„è¡¨è¾¾å¼é—®é¢˜ï¼Œè¿˜èƒ½è§£å†³ `+ - * / ^ % ( )` çš„å®Œå…¨è¡¨è¾¾å¼é—®é¢˜ã€‚**

ç”šè‡³æ”¯æŒè‡ªå®šä¹‰è¿ç®—ç¬¦ï¼Œåªè¦åœ¨è¿ç®—ä¼˜å…ˆçº§ä¸Šè¿›è¡Œç»´æŠ¤å³å¯ã€‚

**å¯¹äºã€Œè¡¨è¾¾å¼è®¡ç®—ã€è¿™ä¸€ç±»é—®é¢˜ï¼Œä½ éƒ½å¯ä»¥ä½¿ç”¨è¿™å¥—æ€è·¯è¿›è¡Œè§£å†³ã€‚æˆ‘ååˆ†å»ºè®®ä½ åŠ å¼ºç†è§£è¿™å¥—å¤„ç†é€»è¾‘ã€‚**

å¯¹äºã€Œä»»ä½•è¡¨è¾¾å¼ã€è€Œè¨€ï¼Œæˆ‘ä»¬éƒ½ä½¿ç”¨ä¸¤ä¸ªæ ˆ `nums` å’Œ `ops`ï¼š
* `nums` ï¼š å­˜æ”¾æ‰€æœ‰çš„æ•°å­—
* `ops` ï¼šå­˜æ”¾æ‰€æœ‰çš„æ•°å­—ä»¥å¤–çš„æ“ä½œ

ç„¶åä»å‰å¾€ååšï¼Œå¯¹éå†åˆ°çš„å­—ç¬¦åšåˆ†æƒ…å†µè®¨è®ºï¼š
* ç©ºæ ¼ : è·³è¿‡
* `(` : ç›´æ¥åŠ å…¥ `ops` ä¸­ï¼Œç­‰å¾…ä¸ä¹‹åŒ¹é…çš„ `)`
* `)` : ä½¿ç”¨ç°æœ‰çš„ `nums` å’Œ `ops` è¿›è¡Œè®¡ç®—ï¼Œç›´åˆ°é‡åˆ°å·¦è¾¹æœ€è¿‘çš„ä¸€ä¸ªå·¦æ‹¬å·ä¸ºæ­¢ï¼Œè®¡ç®—ç»“æœæ”¾åˆ° `nums`
* æ•°å­— : ä»å½“å‰ä½ç½®å¼€å§‹ç»§ç»­å¾€åå–ï¼Œå°†æ•´ä¸€ä¸ªè¿ç»­æ•°å­—æ•´ä½“å–å‡ºï¼ŒåŠ å…¥ `nums`
* `+ - * / ^ %` : éœ€è¦å°†æ“ä½œæ”¾å…¥ `ops` ä¸­ã€‚**åœ¨æ”¾å…¥ä¹‹å‰å…ˆæŠŠæ ˆå†…å¯ä»¥ç®—çš„éƒ½ç®—æ‰ï¼ˆåªæœ‰ã€Œæ ˆå†…è¿ç®—ç¬¦ã€æ¯”ã€Œå½“å‰è¿ç®—ç¬¦ã€ä¼˜å…ˆçº§é«˜/åŒç­‰ï¼Œæ‰è¿›è¡Œè¿ç®—ï¼‰**ï¼Œä½¿ç”¨ç°æœ‰çš„ `nums` å’Œ `ops` è¿›è¡Œè®¡ç®—ï¼Œç›´åˆ°æ²¡æœ‰æ“ä½œæˆ–è€…é‡åˆ°å·¦æ‹¬å·ï¼Œè®¡ç®—ç»“æœæ”¾åˆ° `nums`

æˆ‘ä»¬å¯ä»¥é€šè¿‡ ğŸŒ° æ¥ç†è§£ **åªæœ‰ã€Œæ ˆå†…è¿ç®—ç¬¦ã€æ¯”ã€Œå½“å‰è¿ç®—ç¬¦ã€ä¼˜å…ˆçº§é«˜/åŒç­‰ï¼Œæ‰è¿›è¡Œè¿ç®—** æ˜¯ä»€ä¹ˆæ„æ€ï¼š

å› ä¸ºæˆ‘ä»¬æ˜¯ä»å‰å¾€ååšçš„ï¼Œå‡è®¾æˆ‘ä»¬å½“å‰å·²ç»æ‰«æåˆ° `2 + 1` äº†ï¼ˆæ­¤æ—¶æ ˆå†…çš„æ“ä½œä¸º `+` ï¼‰ã€‚

1. å¦‚æœåé¢å‡ºç°çš„ `+ 2` æˆ–è€… `- 1` çš„è¯ï¼Œæ»¡è¶³ã€Œæ ˆå†…è¿ç®—ç¬¦ã€æ¯”ã€Œå½“å‰è¿ç®—ç¬¦ã€ä¼˜å…ˆçº§é«˜/åŒç­‰ï¼Œå¯ä»¥å°† `2 + 1` ç®—æ‰ï¼ŒæŠŠç»“æœæ”¾åˆ° `nums` ä¸­ï¼›
2. å¦‚æœåé¢å‡ºç°çš„æ˜¯ `* 2` æˆ–è€… `/ 1` çš„è¯ï¼Œä¸æ»¡è¶³ã€Œæ ˆå†…è¿ç®—ç¬¦ã€æ¯”ã€Œå½“å‰è¿ç®—ç¬¦ã€ä¼˜å…ˆçº§é«˜/åŒç­‰ï¼Œè¿™æ—¶å€™ä¸èƒ½è®¡ç®— `2 + 1`ã€‚

ä¸€äº›ç»†èŠ‚ï¼š

* ç”±äºç¬¬ä¸€ä¸ªæ•°å¯èƒ½æ˜¯è´Ÿæ•°ï¼Œä¸ºäº†å‡å°‘è¾¹ç•Œåˆ¤æ–­ã€‚ä¸€ä¸ªå°æŠ€å·§æ˜¯å…ˆå¾€ `nums` æ·»åŠ ä¸€ä¸ª 0
* ä¸ºé˜²æ­¢ () å†…å‡ºç°çš„é¦–ä¸ªå­—ç¬¦ä¸ºè¿ç®—ç¬¦ï¼Œå°†æ‰€æœ‰çš„ç©ºæ ¼å»æ‰ï¼Œå¹¶å°† `(-` æ›¿æ¢ä¸º `(0-`ï¼Œ`(+` æ›¿æ¢ä¸º `(0+`ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ä¸è¿›è¡Œè¿™æ ·çš„é¢„å¤„ç†ï¼Œå°†è¿™ä¸ªå¤„ç†é€»è¾‘æ”¾åˆ°å¾ªç¯é‡Œå»åšï¼‰
* ä»ç†è®ºä¸Šåˆ†æï¼Œ`nums` æœ€å¥½å­˜æ”¾çš„æ˜¯ `long`ï¼Œè€Œä¸æ˜¯ `int`ã€‚å› ä¸ºå¯èƒ½å­˜åœ¨ `å¤§æ•° + å¤§æ•° + å¤§æ•° + â€¦ - å¤§æ•° - å¤§æ•°` çš„è¡¨è¾¾å¼å¯¼è‡´ä¸­é—´ç»“æœæº¢å‡ºï¼Œæœ€ç»ˆç­”æ¡ˆä¸æº¢å‡ºçš„æƒ…å†µ

ä»£ç ï¼š

```Java
class Solution {
    // ä½¿ç”¨ map ç»´æŠ¤ä¸€ä¸ªè¿ç®—ç¬¦ä¼˜å…ˆçº§
    // è¿™é‡Œçš„ä¼˜å…ˆçº§åˆ’åˆ†æŒ‰ç…§ã€Œæ•°å­¦ã€è¿›è¡Œåˆ’åˆ†å³å¯
    Map<Character, Integer> map = new HashMap<>(){{
        put('-', 1);
        put('+', 1);
        put('*', 2);
        put('/', 2);
        put('%', 2);
        put('^', 3);
    }};
    public int calculate(String s) {
        // å°†æ‰€æœ‰çš„ç©ºæ ¼å»æ‰
        s = s.replaceAll(" ", "");
        char[] cs = s.toCharArray();
        int n = s.length();
        // å­˜æ”¾æ‰€æœ‰çš„æ•°å­—
        Deque<Integer> nums = new ArrayDeque<>();
        // ä¸ºäº†é˜²æ­¢ç¬¬ä¸€ä¸ªæ•°ä¸ºè´Ÿæ•°ï¼Œå…ˆå¾€ nums åŠ ä¸ª 0
        nums.addLast(0);
        // å­˜æ”¾æ‰€æœ‰ã€Œéæ•°å­—ä»¥å¤–ã€çš„æ“ä½œ
        Deque<Character> ops = new ArrayDeque<>();
        for (int i = 0; i < n; i++) {
            char c = cs[i];
            if (c == '(') {
                ops.addLast(c);
            } else if (c == ')') {
                // è®¡ç®—åˆ°æœ€è¿‘ä¸€ä¸ªå·¦æ‹¬å·ä¸ºæ­¢
                while (!ops.isEmpty()) {
                    if (ops.peekLast() != '(') {
                        calc(nums, ops);
                    } else {
                        ops.pollLast();
                        break;
                    }
                }
            } else {
                if (isNumber(c)) {
                    int u = 0;
                    int j = i;
                    // å°†ä» i ä½ç½®å¼€å§‹åé¢çš„è¿ç»­æ•°å­—æ•´ä½“å–å‡ºï¼ŒåŠ å…¥ nums
                    while (j < n && isNumber(cs[j])) u = u * 10 + (cs[j++] - '0');
                    nums.addLast(u);
                    i = j - 1;
                } else {
                    if (i > 0 && (cs[i - 1] == '(' || cs[i - 1] == '+' || cs[i - 1] == '-')) {
                        nums.addLast(0);
                    }
                    // æœ‰ä¸€ä¸ªæ–°æ“ä½œè¦å…¥æ ˆæ—¶ï¼Œå…ˆæŠŠæ ˆå†…å¯ä»¥ç®—çš„éƒ½ç®—äº† 
                    // åªæœ‰æ»¡è¶³ã€Œæ ˆå†…è¿ç®—ç¬¦ã€æ¯”ã€Œå½“å‰è¿ç®—ç¬¦ã€ä¼˜å…ˆçº§é«˜/åŒç­‰ï¼Œæ‰è¿›è¡Œè¿ç®—
                    while (!ops.isEmpty() && ops.peekLast() != '(') {
                        char prev = ops.peekLast();
                        if (map.get(prev) >= map.get(c)) {
                            calc(nums, ops);
                        } else {
                            break;
                        }
                    }
                    ops.addLast(c);
                }
            }
        }
        // å°†å‰©ä½™çš„è®¡ç®—å®Œ
        while (!ops.isEmpty()) calc(nums, ops);
        return nums.peekLast();
    }
    void calc(Deque<Integer> nums, Deque<Character> ops) {
        if (nums.isEmpty() || nums.size() < 2) return;
        if (ops.isEmpty()) return;
        int b = nums.pollLast(), a = nums.pollLast();
        char op = ops.pollLast();
        int ans = 0;
        if (op == '+') ans = a + b;
        else if (op == '-') ans = a - b;
        else if (op == '*') ans = a * b;
        else if (op == '/')  ans = a / b;
        else if (op == '^') ans = (int)Math.pow(a, b);
        else if (op == '%') ans = a % b;
        nums.addLast(ans);
    }
    boolean isNumber(char c) {
        return Character.isDigit(c);
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

***

### æ€»ç»“

è¿˜è®°å¾—æˆ‘åœ¨ [é¢˜è§£](https://leetcode-cn.com/problems/basic-calculator/solution/shuang-zhan-jie-jue-tong-yong-biao-da-sh-olym/) ç•™çš„ã€Œè¿›é˜¶ã€å†…å®¹ï¼Ÿ

1. å¦‚æœ `+ -` åŸºç¡€ä¸Šï¼Œå†è€ƒè™‘ `*` å’Œ `/`ï¼Œéœ€è¦å¢åŠ ä»€ä¹ˆè€ƒè™‘ï¼Ÿå¦‚ä½•ç»´æŠ¤è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§ï¼Ÿ

è¿™ä¸ªè¿›é˜¶é—®é¢˜å°±å¯¹åº”äº† LeetCode ä¸Šçš„ä¸¤é“é¢˜ï¼š

* [227. åŸºæœ¬è®¡ç®—å™¨ II](https://leetcode-cn.com/problems/basic-calculator-ii/) ï¼šæœ¬é¢˜ï¼ŒåŒ…å«ç¬¦å· `+ - * /`
* [772. åŸºæœ¬è®¡ç®—å™¨ III](https://leetcode-cn.com/problems/basic-calculator-iii/) ï¼šæœ‰é”é¢˜ï¼ŒåŒ…å«ç¬¦å· `+ - * / ( )`

2. åœ¨ã€Œé—®é¢˜1ã€çš„åŸºç¡€ä¸Šï¼Œå¦‚æœè€ƒè™‘æ”¯æŒè‡ªå®šä¹‰ç¬¦å·ï¼Œä¾‹å¦‚ a / func(a, b) * (c + d)ï¼Œéœ€è¦åšå‡ºä»€ä¹ˆè°ƒæ•´ï¼Ÿ

è¿™ä¸ªè¿›é˜¶é—®é¢˜ï¼Œåœ¨ LeetCode ä¸Šä¹Ÿæœ‰ç±»ä¼¼çš„é¢˜ç›®ï¼š

* [770. åŸºæœ¬è®¡ç®—å™¨ IV](https://leetcode-cn.com/problems/basic-calculator-iv/) ï¼š åŒ…å«è‡ªå®šä¹‰å‡½æ•°ç¬¦å·

**ç»¼ä¸Šï¼Œä½¿ç”¨ä¸‰å¶æä¾›çš„è¿™å¥—ã€ŒåŒæ ˆé€šç”¨è§£å†³æ–¹æ¡ˆã€ï¼Œå¯ä»¥è§£å†³æ‰€æœ‰çš„ã€Œè¡¨è¾¾å¼è®¡ç®—ã€é—®é¢˜ã€‚å› ä¸ºè¿™å¥—ã€Œè¡¨è¾¾å¼è®¡ç®—ã€å¤„ç†é€»è¾‘ï¼Œæœ¬è´¨ä¸Šæ¨¡æ‹Ÿäº†äººè„‘çš„å¤„ç†é€»è¾‘ï¼šæ ¹æ®ä¸‹ä¸€ä½çš„è¿ç®—ç¬¦ä¼˜å…ˆçº§å†³å®šå½“å‰è¿ç®—ç¬¦æ˜¯å¦å¯ä»¥é©¬ä¸Šè®¡ç®—ã€‚**

---

### æœ€å

è¿™æ˜¯æˆ‘ä»¬ã€Œåˆ·ç©¿ LeetCodeã€ç³»åˆ—æ–‡ç« çš„ç¬¬ `No.227` ç¯‡ï¼Œç³»åˆ—å¼€å§‹äº 2021/01/01ï¼Œæˆªæ­¢äºèµ·å§‹æ—¥ LeetCode ä¸Šå…±æœ‰ 1916 é“é¢˜ç›®ï¼Œéƒ¨åˆ†æ˜¯æœ‰é”é¢˜ï¼Œæˆ‘ä»¬å°†å…ˆæŠŠæ‰€æœ‰ä¸å¸¦é”çš„é¢˜ç›®åˆ·å®Œã€‚

åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« é‡Œé¢ï¼Œé™¤äº†è®²è§£è§£é¢˜æ€è·¯ä»¥å¤–ï¼Œè¿˜ä¼šå°½å¯èƒ½ç»™å‡ºæœ€ä¸ºç®€æ´çš„ä»£ç ã€‚å¦‚æœæ¶‰åŠé€šè§£è¿˜ä¼šç›¸åº”çš„ä»£ç æ¨¡æ¿ã€‚

ä¸ºäº†æ–¹ä¾¿å„ä½åŒå­¦èƒ½å¤Ÿç”µè„‘ä¸Šè¿›è¡Œè°ƒè¯•å’Œæäº¤ä»£ç ï¼Œæˆ‘å»ºç«‹äº†ç›¸å…³çš„ä»“åº“ï¼šhttps://github.com/SharingSource/LogicStack-LeetCode ã€‚

åœ¨ä»“åº“åœ°å€é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°ç³»åˆ—æ–‡ç« çš„é¢˜è§£é“¾æ¥ã€ç³»åˆ—æ–‡ç« çš„ç›¸åº”ä»£ç ã€LeetCode åŸé¢˜é“¾æ¥å’Œå…¶ä»–ä¼˜é€‰é¢˜è§£ã€‚

