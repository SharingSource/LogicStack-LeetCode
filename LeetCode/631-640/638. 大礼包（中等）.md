### é¢˜ç›®æè¿°

è¿™æ˜¯ LeetCode ä¸Šçš„ **[638. å¤§ç¤¼åŒ…](https://leetcode-cn.com/problems/shopping-offers/solution/gong-shui-san-xie-yi-ti-shuang-jie-zhuan-qgk1/)** ï¼Œéš¾åº¦ä¸º **ä¸­ç­‰**ã€‚

Tag : ã€Œå®Œå…¨èƒŒåŒ…ã€ã€ã€ŒèƒŒåŒ…é—®é¢˜ã€ã€ã€ŒDFSã€



åœ¨ LeetCode å•†åº—ä¸­ï¼Œ æœ‰ `n` ä»¶åœ¨å”®çš„ç‰©å“ã€‚æ¯ä»¶ç‰©å“éƒ½æœ‰å¯¹åº”çš„ä»·æ ¼ã€‚ç„¶è€Œï¼Œä¹Ÿæœ‰ä¸€äº›å¤§ç¤¼åŒ…ï¼Œæ¯ä¸ªå¤§ç¤¼åŒ…ä»¥ä¼˜æƒ çš„ä»·æ ¼æ†ç»‘é”€å”®ä¸€ç»„ç‰©å“ã€‚

ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `price` è¡¨ç¤ºç‰©å“ä»·æ ¼ï¼Œå…¶ä¸­ `price[i]` æ˜¯ç¬¬ `i` ä»¶ç‰©å“çš„ä»·æ ¼ã€‚å¦æœ‰ä¸€ä¸ªæ•´æ•°æ•°ç»„ `needs` è¡¨ç¤ºè´­ç‰©æ¸…å•ï¼Œå…¶ä¸­ `needs[i]` æ˜¯éœ€è¦è´­ä¹°ç¬¬ `i` ä»¶ç‰©å“çš„æ•°é‡ã€‚

è¿˜æœ‰ä¸€ä¸ªæ•°ç»„ special è¡¨ç¤ºå¤§ç¤¼åŒ…ï¼Œ`special[i]` çš„é•¿åº¦ä¸º `n + 1` ï¼Œå…¶ä¸­ `special[i][j]` è¡¨ç¤ºç¬¬ `i` ä¸ªå¤§ç¤¼åŒ…ä¸­å†…å«ç¬¬ `j` ä»¶ç‰©å“çš„æ•°é‡ï¼Œä¸” `special[i][n]` ï¼ˆä¹Ÿå°±æ˜¯æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªæ•´æ•°ï¼‰ä¸ºç¬¬ `i` ä¸ªå¤§ç¤¼åŒ…çš„ä»·æ ¼ã€‚

è¿”å› ç¡®åˆ‡ æ»¡è¶³è´­ç‰©æ¸…å•æ‰€éœ€èŠ±è´¹çš„æœ€ä½ä»·æ ¼ï¼Œä½ å¯ä»¥å……åˆ†åˆ©ç”¨å¤§ç¤¼åŒ…çš„ä¼˜æƒ æ´»åŠ¨ã€‚ä½ ä¸èƒ½è´­ä¹°è¶…å‡ºè´­ç‰©æ¸…å•æŒ‡å®šæ•°é‡çš„ç‰©å“ï¼Œå³ä½¿é‚£æ ·ä¼šé™ä½æ•´ä½“ä»·æ ¼ã€‚ä»»æ„å¤§ç¤¼åŒ…å¯æ— é™æ¬¡è´­ä¹°ã€‚

ç¤ºä¾‹ 1ï¼š
```
è¾“å…¥ï¼šprice = [2,5], special = [[3,0,5],[1,2,10]], needs = [3,2]

è¾“å‡ºï¼š14

è§£é‡Šï¼šæœ‰ A å’Œ B ä¸¤ç§ç‰©å“ï¼Œä»·æ ¼åˆ†åˆ«ä¸º Â¥2 å’Œ Â¥5 ã€‚ 
å¤§ç¤¼åŒ… 1 ï¼Œä½ å¯ä»¥ä»¥ Â¥5 çš„ä»·æ ¼è´­ä¹° 3A å’Œ 0B ã€‚ 
å¤§ç¤¼åŒ… 2 ï¼Œä½ å¯ä»¥ä»¥ Â¥10 çš„ä»·æ ¼è´­ä¹° 1A å’Œ 2B ã€‚ 
éœ€è¦è´­ä¹° 3 ä¸ª A å’Œ 2 ä¸ª B ï¼Œ æ‰€ä»¥ä»˜ Â¥10 è´­ä¹° 1A å’Œ 2Bï¼ˆå¤§ç¤¼åŒ… 2ï¼‰ï¼Œä»¥åŠ Â¥4 è´­ä¹° 2A ã€‚
```
ç¤ºä¾‹ 2ï¼š
```
è¾“å…¥ï¼šprice = [2,3,4], special = [[1,1,0,4],[2,2,1,9]], needs = [1,2,1]

è¾“å‡ºï¼š11

è§£é‡Šï¼šA ï¼ŒB ï¼ŒC çš„ä»·æ ¼åˆ†åˆ«ä¸º Â¥2 ï¼ŒÂ¥3 ï¼ŒÂ¥4 ã€‚
å¯ä»¥ç”¨ Â¥4 è´­ä¹° 1A å’Œ 1B ï¼Œä¹Ÿå¯ä»¥ç”¨ Â¥9 è´­ä¹° 2A ï¼Œ2B å’Œ 1C ã€‚ 
éœ€è¦ä¹° 1A ï¼Œ2B å’Œ 1C ï¼Œæ‰€ä»¥ä»˜ Â¥4 ä¹° 1A å’Œ 1Bï¼ˆå¤§ç¤¼åŒ… 1ï¼‰ï¼Œä»¥åŠ Â¥3 è´­ä¹° 1B ï¼Œ Â¥4 è´­ä¹° 1C ã€‚ 
ä¸å¯ä»¥è´­ä¹°è¶…å‡ºå¾…è´­æ¸…å•çš„ç‰©å“ï¼Œå°½ç®¡è´­ä¹°å¤§ç¤¼åŒ… 2 æ›´åŠ ä¾¿å®œã€‚
```

æç¤ºï¼š
* n == price.length
* n == needs.length
* 1 <= n <= 6
* 0 <= price[i] <= 10
* 0 <= needs[i] <= 10
* 1 <= special.length <= 100
* special[i].length == n + 1
* 0 <= special[i][j] <= 50

---

### è½¬æ¢ DFSï¼ˆè½¬æ¢ä¸ºç¤¼åŒ…å¤„ç†ï¼‰

å¯¹äºæŸä¸ª $need[i]$ è€Œè¨€ï¼Œæ—¢å¯ä»¥ã€Œå•ä¹°ã€ä¹Ÿå¯ä»¥ä½¿ç”¨ã€Œç¤¼åŒ…å½¢å¼è´­ä¹°ã€ï¼ŒåŒæ—¶ä¸¤ç§è´­ä¹°æ–¹å¼éƒ½å­˜åœ¨å¯¹ã€Œä»½æ•°ã€çš„å†³ç­–ï¼ˆå•ä¹°å¤šå°‘ä»½/ä¹°å¤šå°‘ä¸ªç›¸åº”çš„ç¤¼åŒ…ï¼‰ã€‚

åˆ©ç”¨ç‰©å“æ•°é‡å’Œç¤¼åŒ…æ•°é‡æ•°æ®èŒƒå›´éƒ½è¾ƒå°‘ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå¯¹ã€Œå•ä¹°ã€æƒ…å†µè¿›è¡Œé¢„å¤„ç†ï¼Œå°†å…¶è½¬æ¢ä¸ºã€Œç¤¼åŒ…ã€å½¢å¼ã€‚è‹¥ $price[0] = 100$ï¼Œåˆ™ä½¿ç”¨ç¤¼åŒ… $[1, 0, 0, ...,0, 100]$ æ¥ä»£æŒ‡ã€‚

ç„¶åå†é¢„å¤„ç†æ¯ä¸ªç¤¼åŒ…æœ€å¤šé€‰å¤šå°‘ä¸ªï¼Œå¹¶ä½¿ç”¨å“ˆå¸Œè¡¨è¿›è¡Œå­˜å‚¨ã€‚

æœ€åä½¿ç”¨ `DFS` å¯¹æ¯ä¸ªã€Œç¤¼åŒ…ã€å¦‚ä½•é€‰æ‹©è¿›è¡Œçˆ†æœå³å¯ã€‚

ä»£ç ï¼š
```Java
class Solution {
    int ans = 0x3f3f3f3f;
    List<Integer> price, needs;
    List<List<Integer>> special;
    Map<Integer, Integer> map = new HashMap<>();
    int n, m;
    public int shoppingOffers(List<Integer> _price, List<List<Integer>> _special, List<Integer> _needs) {
        price = _price; special = _special; needs = _needs;
        n = price.size();
        List<Integer> temp = new ArrayList<>();
        for (int i = 0; i < n; i++) temp.add(0);
        for (int i = 0; i < n; i++) {
            List<Integer> clone = new ArrayList<>(temp);
            clone.set(i, 1);
            clone.add(price.get(i));
            special.add(clone);
        }
        m = special.size();
        for (int i = 0; i < m; i++) {
            List<Integer> x = special.get(i);
            int max = 0;
            for (int j = 0; j < n; j++) {
                int a = x.get(j), b = needs.get(j);
                if (a == 0 || b == 0) continue;
                max = Math.max(max, (int)Math.ceil(b / a));
            }
            map.put(i, max);
        }
        dfs(0, needs, 0);
        return ans;
    }
    void dfs(int u, List<Integer> list, int cur) {
        if (cur >= ans) return ;
        if (u == m) {
            for (int i = 0; i < n; i++) {
                if (list.get(i) != 0) return ;
            }
            ans = Math.min(ans, cur);
            return ;
        }
        List<Integer> x = special.get(u);
        out:for (int k = 0; k <= map.get(u); k++) {
            List<Integer> clist = new ArrayList<>(list);
            for (int i = 0; i < n; i++) {
                int a = x.get(i), b = clist.get(i);
                if (a * k > b) break out;
                clist.set(i, b - a * k);
            }
            dfs(u + 1, clist, cur + k * x.get(n));
        }
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šä»¤ç‰©å“æ•°é‡ä¸º $n$ï¼ŒåŸç¤¼åŒ…æ•°é‡ä¸º $m$ã€‚å°†ã€Œå•ä¹°ã€é¢„å¤„ç†æˆã€Œç¤¼åŒ…ã€ï¼Œå…±æœ‰ $n$ ä¸­ã€Œå•ä¹°ã€æƒ…å†µéœ€è¦è½¬æ¢ï¼ŒåŒæ—¶æ¯ä¸ªè½¬æ¢éœ€è¦å¯¹æ•°ç»„è¿›è¡Œå¤åˆ¶ï¼Œå¤æ‚åº¦ä¸º $O(n^2)$ï¼Œé¢„å¤„ç†å®Œåï¼Œå…±æœ‰ $n + m$ ä¸ªç¤¼åŒ…ï¼›é¢„å¤„ç†æ¯ä¸ªç¤¼åŒ…æ‰€èƒ½é€‰çš„æœ€å¤§æ•°é‡ï¼Œå¤æ‚åº¦ä¸º $O((n * m) * n)$ï¼›å¯¹ç¤¼åŒ…çš„é€‰æ‹©æ–¹æ¡ˆè¿›è¡Œå†³ç­–ï¼Œä¸€ä¸ªç¤¼åŒ…æœ€å¤šé€‰æ‹© $k = \max(needs[i]) = 10$ ä¸ªï¼Œå¤æ‚åº¦ä¸º $O(k ^ {n + m})$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(k ^ {n + m})$

---

### å®Œå…¨èƒŒåŒ…

è¿™è¿˜æ˜¯ä¸€é“å¾ˆæœ‰æ„æ€çš„ã€Œå®Œå…¨èƒŒåŒ…ã€é—®é¢˜ã€‚

ä¸äº†è§£ã€Œå®Œå…¨èƒŒåŒ…ã€çš„åŒå­¦ï¼Œå¯ä»¥å…ˆçœ‹å‰ç½®ğŸ§€ï¼š[å®Œå…¨èƒŒåŒ…](https://mp.weixin.qq.com/s?__biz=MzU4NDE3MTEyMA==&mid=2247486107&idx=1&sn=e5fa523008fc5588737b7ed801caf4c3&chksm=fd9ca184caeb28926959c0987208a3932ed9c965267ed366b5b82a6fc16d42f1ff40c29db5f1&scene=178&cur_album_id=1751702161341628417#rd)ã€‚ç›®å‰[ã€ŒèƒŒåŒ…é—®é¢˜ã€ä¸“é¢˜](https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU4NDE3MTEyMA==&action=getalbum&album_id=1751702161341628417&scene=173&from_msgid=2247486107&from_itemidx=1&count=3&nolastread=1#wechat_redirect) å·²ç»è®²äº† $21$ ç¯‡ï¼Œå¤§æ¦‚è¿˜æœ‰ $2$ - $4$ ç¯‡å½»åº•è®²å®Œï¼Œå®Œå…¨è¦†ç›–äº†æ‰€æœ‰çš„ã€ŒèƒŒåŒ…é—®é¢˜ã€ã€‚

èƒŒåŒ…é—®é¢˜éš¾ç‚¹åœ¨äºå¯¹ã€Œæˆæœ¬ã€å’Œã€Œä»·å€¼ã€çš„æŠ½è±¡ã€‚

å¯¹äºæœ¬é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ **$f[i, j_0, j_1, j_2, ... , j_{n - 1}]$ ä¸ºè€ƒè™‘å‰ $i$ ä¸ªå¤§ç¤¼åŒ…ï¼Œè´­ä¹° $j_0$ ä»¶ç‰©å“ $0$ï¼Œè´­ä¹° $j_1$ ä»¶ç‰©å“ $1$ï¼Œ....ï¼Œè´­ä¹° $j_{n - 1}$ ä»¶ç‰©å“ $n - 1$ æ—¶çš„æœ€å°èŠ±è´¹ã€‚**

åŒæ—¶ï¼Œæˆ‘ä»¬æœ‰åˆå§‹åŒ–æ¡ä»¶ $f[0, 0, 0, ... , 0] = 0$ï¼ˆå…¶ä½™ $f[0, x_0, x_1, x_2, ..., x_n]$ ä¸ºæ­£æ— ç©·ï¼‰çš„åˆå§‹åŒ–æ¡ä»¶ï¼Œæœ€ç»ˆç­”æ¡ˆä¸º $f[m - 1, need[0], need[1], ..., need[n - 1]]$ã€‚

è¿™æ ·çš„æœ´ç´ å®Œå…¨èƒŒåŒ…åšæ³•å¤æ‚åº¦è¿‡é«˜ï¼Œæ ¹æ®æˆ‘ä»¬çš„å‰ç½®ğŸ§€ [å®Œå…¨èƒŒåŒ…](https://mp.weixin.qq.com/s?__biz=MzU4NDE3MTEyMA==&mid=2247486107&idx=1&sn=e5fa523008fc5588737b7ed801caf4c3&chksm=fd9ca184caeb28926959c0987208a3932ed9c965267ed366b5b82a6fc16d42f1ff40c29db5f1&scene=178&cur_album_id=1751702161341628417#rd) ä¸­çš„æ•°å­¦æ¨å¯¼åˆ†æï¼Œæˆ‘ä»¬å‘ç°å®Œå…¨èƒŒåŒ…çš„ä¸€ç»´ç©ºé—´ä¼˜åŒ–ï¼Œæ˜¯å…·æœ‰ä¼˜åŒ–å¤æ‚åº¦çš„æ„ä¹‰ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ç¤¼åŒ…ç»´åº¦è¿›è¡Œä¼˜åŒ–ï¼Œä½¿ç”¨ $f[need[0], need[1], ... , need[n - 1]]$ æ¥ä½œä¸ºçŠ¶æ€è¡¨ç¤ºã€‚

ä¸å¤±ä¸€èˆ¬æ€§çš„è€ƒè™‘ $f[j_0, j_1, ... , j_{n - 1}]$ è¯¥å¦‚ä½•è½¬ç§»ï¼ˆä»¥ç‰©å“ $0$ ä¸ºä¾‹è¿›è¡Œåˆ†æï¼Œå…¶ä»–åŒç†ï¼‰ï¼š

1. ä¸é€‰æ‹©ä»»ä½•å¤§ç¤¼åŒ…ï¼Œåªè¿›è¡Œå•ä¹°ï¼š$f[j_0, j_1, ... , j_{n - 1}] = min(f[j_0, j_1, ... , j_{n - 1}], f[j_0 - 1, j_1, ..., j_{n - 1}] + price[0]$ï¼›
2. è´­ä¹°å¤§ç¤¼åŒ…ï¼š$f[j_0, j_1, ... , j_{n - 1}] = min(f[j_0, j_1, ... , j_{n - 1}], f[j_0 - special[i][0], j_1 - special[i][1],, ..., j_{n - 1} - special[i][n - 1]] + special[i][n]$

æœ€ç»ˆçš„ $f[j_0, j_1, ... , j_{n - 1}]$ ä¸ºä¸Šè¿°æ‰€æœ‰æ–¹æ¡ˆä¸­çš„æœ€å°å€¼ã€‚

>ä¸€äº›ç»†èŠ‚ï¼šå®ç°æ—¶ï¼Œä¸ºäº†é˜²æ­¢è¿‡å¤šçš„ç»´åº¦ï¼Œä»¥åŠå¯èƒ½å­˜åœ¨çš„ MLE é£é™©ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ç»´åº¦è¿›è¡Œå‹ç¼©å¤„ç†ï¼Œè€Œæœ€ç®€å•çš„æ–¹å¼å¯ä»¥é€šè¿‡ä¸æ’åˆ—æ•°å»ºç«‹æ˜ å°„å…³ç³»ã€‚

ä»£ç ï¼š
```Java
class Solution {
    public int shoppingOffers(List<Integer> price, List<List<Integer>> special, List<Integer> needs) {
        int n = price.size();
        int[] g = new int[n + 1];
        g[0] = 1;
        for (int i = 1; i <= n; i++) {
            g[i] = g[i - 1] * (needs.get(i - 1) + 1);
        }
        int mask = g[n];
        int[] f = new int[mask];
        int[] cnt = new int[n];
        for (int state = 1; state < mask; state++) {
            f[state] = 0x3f3f3f3f;
            Arrays.fill(cnt, 0);
            for (int i = 0; i < n; i++) {
                cnt[i] = state % g[i + 1] / g[i];
            }
            for (int i = 0; i < n; i++) {
                if (cnt[i] > 0) f[state] = Math.min(f[state], f[state - g[i]] + price.get(i));
            }
            out:for (List<Integer> x : special) {
                int cur = state;
                for (int i = 0; i < n; i++) {
                    if (cnt[i] < x.get(i)) continue out;
                    cur -= x.get(i) * g[i];
                }
                f[state] = Math.min(f[state], f[cur] + x.get(n));
            }
        }
        return f[mask - 1];
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šä»¤ç‰©å“æ•°é‡ä¸º $n$ï¼ŒåŸç¤¼åŒ…æ•°é‡ä¸º $m$ã€‚æ¯ä¸ªç‰©å“æœ€å¤šéœ€è¦ $k = \max(needs[i]) = 10$ ä¸ªï¼Œå…±æœ‰ $k^n$ ä¸ªçŠ¶æ€éœ€è¦è½¬ç§»ï¼Œè½¬ç§»æ—¶éœ€è¦è€ƒè™‘ã€Œå•ä¹°ã€å’Œã€Œç¤¼åŒ…ã€å†³ç­–ï¼Œå¤æ‚åº¦åˆ†åˆ«ä¸º $O(n)$ å’Œ $O(m * n)$ã€‚æ•´ä½“å¤æ‚åº¦ä¸º $O(k^n * (m * n))$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(k^n * (m * n))$

---

### æœ€å

è¿™æ˜¯æˆ‘ä»¬ã€Œåˆ·ç©¿ LeetCodeã€ç³»åˆ—æ–‡ç« çš„ç¬¬ `No.638` ç¯‡ï¼Œç³»åˆ—å¼€å§‹äº 2021/01/01ï¼Œæˆªæ­¢äºèµ·å§‹æ—¥ LeetCode ä¸Šå…±æœ‰ 1916 é“é¢˜ç›®ï¼Œéƒ¨åˆ†æ˜¯æœ‰é”é¢˜ï¼Œæˆ‘ä»¬å°†å…ˆæŠŠæ‰€æœ‰ä¸å¸¦é”çš„é¢˜ç›®åˆ·å®Œã€‚

åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« é‡Œé¢ï¼Œé™¤äº†è®²è§£è§£é¢˜æ€è·¯ä»¥å¤–ï¼Œè¿˜ä¼šå°½å¯èƒ½ç»™å‡ºæœ€ä¸ºç®€æ´çš„ä»£ç ã€‚å¦‚æœæ¶‰åŠé€šè§£è¿˜ä¼šç›¸åº”çš„ä»£ç æ¨¡æ¿ã€‚

ä¸ºäº†æ–¹ä¾¿å„ä½åŒå­¦èƒ½å¤Ÿç”µè„‘ä¸Šè¿›è¡Œè°ƒè¯•å’Œæäº¤ä»£ç ï¼Œæˆ‘å»ºç«‹äº†ç›¸å…³çš„ä»“åº“ï¼šhttps://github.com/SharingSource/LogicStack-LeetCodeã€‚

åœ¨ä»“åº“åœ°å€é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°ç³»åˆ—æ–‡ç« çš„é¢˜è§£é“¾æ¥ã€ç³»åˆ—æ–‡ç« çš„ç›¸åº”ä»£ç ã€LeetCode åŸé¢˜é“¾æ¥å’Œå…¶ä»–ä¼˜é€‰é¢˜è§£ã€‚

