### é¢˜ç›®æè¿°

è¿™æ˜¯ LeetCode ä¸Šçš„ **[752. æ‰“å¼€è½¬ç›˜é”](https://leetcode-cn.com/problems/open-the-lock/solution/gong-shui-san-xie-yi-ti-shuang-jie-shuan-wyr9/)** ï¼Œéš¾åº¦ä¸º **ä¸­ç­‰**ã€‚

Tag : ã€ŒåŒå‘ BFSã€ã€ã€Œå¯å‘å¼æœç´¢ã€ã€ã€ŒAStar ç®—æ³•ã€ã€ã€ŒIDAStar ç®—æ³•ã€



ä½ æœ‰ä¸€ä¸ªå¸¦æœ‰å››ä¸ªåœ†å½¢æ‹¨è½®çš„è½¬ç›˜é”ã€‚æ¯ä¸ªæ‹¨è½®éƒ½æœ‰10ä¸ªæ•°å­—ï¼š '0', '1', '2', '3', '4', '5', '6', '7', '8', '9' ã€‚æ¯ä¸ªæ‹¨è½®å¯ä»¥è‡ªç”±æ—‹è½¬ï¼šä¾‹å¦‚æŠŠ '9' å˜ä¸ºÂ '0'ï¼Œ'0' å˜ä¸º '9' ã€‚æ¯æ¬¡æ—‹è½¬éƒ½åªèƒ½æ—‹è½¬ä¸€ä¸ªæ‹¨è½®çš„ä¸€ä½æ•°å­—ã€‚

é”çš„åˆå§‹æ•°å­—ä¸º '0000' ï¼Œä¸€ä¸ªä»£è¡¨å››ä¸ªæ‹¨è½®çš„æ•°å­—çš„å­—ç¬¦ä¸²ã€‚

åˆ—è¡¨ deadends åŒ…å«äº†ä¸€ç»„æ­»äº¡æ•°å­—ï¼Œä¸€æ—¦æ‹¨è½®çš„æ•°å­—å’Œåˆ—è¡¨é‡Œçš„ä»»ä½•ä¸€ä¸ªå…ƒç´ ç›¸åŒï¼Œè¿™ä¸ªé”å°†ä¼šè¢«æ°¸ä¹…é”å®šï¼Œæ— æ³•å†è¢«æ—‹è½¬ã€‚

å­—ç¬¦ä¸² target ä»£è¡¨å¯ä»¥è§£é”çš„æ•°å­—ï¼Œä½ éœ€è¦ç»™å‡ºè§£é”éœ€è¦çš„æœ€å°æ—‹è½¬æ¬¡æ•°ï¼Œå¦‚æœæ— è®ºå¦‚ä½•ä¸èƒ½è§£é”ï¼Œè¿”å› -1 ã€‚

ç¤ºä¾‹ 1:
```
è¾“å…¥ï¼šdeadends = ["0201","0101","0102","1212","2002"], target = "0202"
è¾“å‡ºï¼š6
è§£é‡Šï¼š
å¯èƒ½çš„ç§»åŠ¨åºåˆ—ä¸º "0000" -> "1000" -> "1100" -> "1200" -> "1201" -> "1202" -> "0202"ã€‚
æ³¨æ„ "0000" -> "0001" -> "0002" -> "0102" -> "0202" è¿™æ ·çš„åºåˆ—æ˜¯ä¸èƒ½è§£é”çš„ï¼Œ
å› ä¸ºå½“æ‹¨åŠ¨åˆ° "0102" æ—¶è¿™ä¸ªé”å°±ä¼šè¢«é”å®šã€‚
```
ç¤ºä¾‹ 2:
```
è¾“å…¥: deadends = ["8888"], target = "0009"
è¾“å‡ºï¼š1
è§£é‡Šï¼š
æŠŠæœ€åä¸€ä½åå‘æ—‹è½¬ä¸€æ¬¡å³å¯ "0000" -> "0009"ã€‚
```
ç¤ºä¾‹ 3:
```
è¾“å…¥: deadends = ["8887","8889","8878","8898","8788","8988","7888","9888"], target = "8888"
è¾“å‡ºï¼š-1
è§£é‡Šï¼š
æ— æ³•æ—‹è½¬åˆ°ç›®æ ‡æ•°å­—ä¸”ä¸è¢«é”å®šã€‚
```
ç¤ºä¾‹ 4:
```
è¾“å…¥: deadends = ["0000"], target = "8888"
è¾“å‡ºï¼š-1
```

æç¤ºï¼š
* 1 <=Â deadends.length <= 500
* deadends[i].length == 4
* target.length == 4
* target ä¸åœ¨ deadends ä¹‹ä¸­
* target å’Œ deadends[i] ä»…ç”±è‹¥å¹²ä½æ•°å­—ç»„æˆ

---

### åŸºæœ¬åˆ†æ

é¦–å…ˆï¼Œæˆ‘å»ºè®®ä½ å…ˆåšã€Œ127. å•è¯æ¥é¾™ã€ï¼Œç„¶åå†å›è¿‡å¤´å°†æœ¬é¢˜ä½œä¸ºã€Œç»ƒä¹ é¢˜ã€ã€‚

ã€Œ127. å•è¯æ¥é¾™ã€å®šä½å›°éš¾ï¼Œè€Œæœ¬é¢˜å®šä½ä¸­ç­‰ã€‚ä¸»è¦ä½“ç°åœ¨æ•°æ®èŒƒå›´ä¸Šï¼Œæ€ç»´éš¾åº¦ä¸Šã€Œ127. å•è¯æ¥é¾™ã€å¹¶ä¸æ¯”æœ¬é¢˜éš¾ï¼Œå¤§èƒ†åšã€‚

ã€Œ127. å•è¯æ¥é¾™ã€åŸé¢˜é“¾æ¥åœ¨ [è¿™é‡Œ](https://leetcode-cn.com/problems/word-ladder/)ï¼Œç›¸å…³é¢˜è§£åœ¨ [è¿™é‡Œ](https://leetcode-cn.com/problems/word-ladder/solution/gong-shui-san-xie-ru-he-shi-yong-shuang-magjd/)ã€‚

å›åˆ°æœ¬é¢˜ï¼Œæ ¹æ®é¢˜æ„ï¼Œå¯ä»¥ç¡®å®šè¿™æ˜¯ä¸€ä¸ªã€Œæœ€çŸ­è·¯/æœ€å°æ­¥æ•°ã€é—®é¢˜ã€‚

æ­¤ç±»é—®é¢˜ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šä½¿ç”¨ã€ŒBFSã€æ±‚è§£ï¼Œä½†æœ´ç´ çš„ BFS é€šå¸¸ä¼šå¸¦æ¥æœç´¢ç©ºé—´çˆ†ç‚¸é—®é¢˜ã€‚

å› æ­¤æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸ [(é¢˜è§£)127. å•è¯æ¥é¾™](https://leetcode-cn.com/problems/word-ladder/solution/gong-shui-san-xie-ru-he-shi-yong-shuang-magjd/) ç±»ä¼¼çš„æ€è·¯è¿›è¡Œæ±‚è§£ã€‚

---

### åŒå‘ BFS

æˆ‘ä»¬çŸ¥é“ï¼Œé€’å½’æ ‘çš„å±•å¼€å½¢å¼æ˜¯ä¸€æ£µå¤šé˜¶æ ‘ã€‚

ä½¿ç”¨æœ´ç´  BFS è¿›è¡Œæ±‚è§£æ—¶ï¼Œé˜Ÿåˆ—ä¸­æœ€å¤šä¼šå­˜åœ¨â€œä¸¤å±‚â€çš„æœç´¢èŠ‚ç‚¹ã€‚

å› æ­¤æœç´¢ç©ºé—´çš„ä¸Šç•Œå–å†³äº **ç›®æ ‡èŠ‚ç‚¹æ‰€åœ¨çš„æœç´¢å±‚æ¬¡çš„æ·±åº¦æ‰€å¯¹åº”çš„å®½åº¦**ã€‚

ä¸‹å›¾å±•ç¤ºäº†æœ´ç´  BFS å¯èƒ½é¢ä¸´çš„æœç´¢ç©ºé—´çˆ†ç‚¸é—®é¢˜ï¼š

![image.png](https://pic.leetcode-cn.com/1623894968-XELIvK-image.png)

**åœ¨æœ´ç´ çš„ BFS å®ç°ä¸­ï¼Œç©ºé—´çš„ç“¶é¢ˆä¸»è¦å–å†³äºæœç´¢ç©ºé—´ä¸­çš„æœ€å¤§å®½åº¦ã€‚**

é‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•è®©æˆ‘ä»¬ä¸ä½¿ç”¨è¿™ä¹ˆå®½çš„æœç´¢ç©ºé—´ï¼ŒåŒæ—¶åˆèƒ½ä¿è¯æœç´¢åˆ°ç›®æ ‡ç»“æœå‘¢ï¼Ÿ

ã€ŒåŒå‘ BFSã€ å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼š

**åŒæ—¶ä»ä¸¤ä¸ªæ–¹å‘å¼€å§‹æœç´¢ï¼Œä¸€æ—¦æœç´¢åˆ°ç›¸åŒçš„å€¼ï¼Œæ„å‘³ç€æ‰¾åˆ°äº†ä¸€æ¡è”é€šèµ·ç‚¹å’Œç»ˆç‚¹çš„æœ€çŸ­è·¯å¾„ã€‚**

å¯¹äºã€Œæœ‰è§£ã€ã€ã€Œæœ‰ä¸€å®šæ•°æ®èŒƒå›´ã€åŒæ—¶ã€Œå±‚çº§èŠ‚ç‚¹æ•°é‡ä»¥å€æ•°æˆ–è€…æŒ‡æ•°çº§åˆ«å¢é•¿ã€çš„æƒ…å†µï¼Œã€ŒåŒå‘ BFSã€çš„æœç´¢ç©ºé—´é€šå¸¸åªæœ‰ã€Œæœ´ç´  BFSã€çš„ç©ºé—´æ¶ˆè€—çš„å‡ ç™¾åˆ†ä¹‹ä¸€ï¼Œç”šè‡³å‡ åƒåˆ†ä¹‹ä¸€ã€‚

![image.png](https://pic.leetcode-cn.com/1623894976-CCMljJ-image.png)

ã€ŒåŒå‘ BFSã€çš„åŸºæœ¬å®ç°æ€è·¯å¦‚ä¸‹ï¼š

1. åˆ›å»ºã€Œä¸¤ä¸ªé˜Ÿåˆ—ã€åˆ†åˆ«ç”¨äºä¸¤ä¸ªæ–¹å‘çš„æœç´¢ï¼›
2. åˆ›å»ºã€Œä¸¤ä¸ªå“ˆå¸Œè¡¨ã€ç”¨äºã€Œè§£å†³ç›¸åŒèŠ‚ç‚¹é‡å¤æœç´¢ã€å’Œã€Œè®°å½•è½¬æ¢æ¬¡æ•°ã€ï¼›
3. ä¸ºäº†å°½å¯èƒ½è®©ä¸¤ä¸ªæœç´¢æ–¹å‘â€œå¹³å‡â€ï¼Œæ¯æ¬¡ä»é˜Ÿåˆ—ä¸­å–å€¼è¿›è¡Œæ‰©å±•æ—¶ï¼Œå…ˆåˆ¤æ–­å“ªä¸ªé˜Ÿåˆ—å®¹é‡è¾ƒå°‘ï¼›
4. å¦‚æœåœ¨æœç´¢è¿‡ç¨‹ä¸­ã€Œæœç´¢åˆ°å¯¹æ–¹æœç´¢è¿‡çš„èŠ‚ç‚¹ã€ï¼Œè¯´æ˜æ‰¾åˆ°äº†æœ€çŸ­è·¯å¾„ã€‚

ã€ŒåŒå‘ BFSã€åŸºæœ¬æ€è·¯å¯¹åº”çš„ä¼ªä»£ç å¤§è‡´å¦‚ä¸‹ï¼š

```Java []
d1ã€d2 ä¸ºä¸¤ä¸ªæ–¹å‘çš„é˜Ÿåˆ—
m1ã€m2 ä¸ºä¸¤ä¸ªæ–¹å‘çš„å“ˆå¸Œè¡¨ï¼Œè®°å½•æ¯ä¸ªèŠ‚ç‚¹è·ç¦»èµ·ç‚¹çš„
    
// åªæœ‰ä¸¤ä¸ªé˜Ÿåˆ—éƒ½ä¸ç©ºï¼Œæ‰æœ‰å¿…è¦ç»§ç»­å¾€ä¸‹æœç´¢
// å¦‚æœå…¶ä¸­ä¸€ä¸ªé˜Ÿåˆ—ç©ºäº†ï¼Œè¯´æ˜ä»æŸä¸ªæ–¹å‘æœåˆ°åº•éƒ½æœä¸åˆ°è¯¥æ–¹å‘çš„ç›®æ ‡èŠ‚ç‚¹
while(!d1.isEmpty() && !d2.isEmpty()) {
    if (d1.size() < d2.size()) {
        update(d1, m1, m2);
    } else {
        update(d2, m2, m1);
    }
}

// update ä¸ºä»é˜Ÿåˆ— d ä¸­å–å‡ºä¸€ä¸ªå…ƒç´ è¿›è¡Œã€Œä¸€æ¬¡å®Œæ•´æ‰©å±•ã€çš„é€»è¾‘
void update(Deque d, Map cur, Map other) {}
```


å›åˆ°æœ¬é¢˜ï¼Œæˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ã€ŒåŒå‘ BFSã€è¿›è¡Œæ±‚è§£ã€‚

ä¼°è®¡ä¸å°‘åŒå­¦æ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦ã€ŒåŒå‘ BFSã€ï¼Œå› æ­¤è¿™æ¬¡æˆ‘å†™äº†å¤§é‡æ³¨é‡Šã€‚

å»ºè®®å¤§å®¶å¸¦ç€å¯¹ã€ŒåŒå‘ BFSã€çš„åŸºæœ¬ç†è§£å»é˜…è¯»ã€‚

![image.png](https://pic.leetcode-cn.com/1624587495-LZeqtj-image.png)

ä»£ç ï¼š
```Java []
class Solution {
    String t, s;
    Set<String> set = new HashSet<>();
    public int openLock(String[] _ds, String _t) {
        s = "0000";
        t = _t;
        if (s.equals(t)) return 0;
        for (String d : _ds) set.add(d);
        if (set.contains(s)) return -1;
        int ans = bfs();
        return ans;
    }
    int bfs() {
        // d1 ä»£è¡¨ä»èµ·ç‚¹ s å¼€å§‹æœç´¢ï¼ˆæ­£å‘ï¼‰
        // d2 ä»£è¡¨ä»ç»“å°¾ t å¼€å§‹æœç´¢ï¼ˆåå‘ï¼‰
        Deque<String> d1 = new ArrayDeque<>(), d2 = new ArrayDeque<>();
        /*
         * m1 å’Œ m2 åˆ†åˆ«è®°å½•ä¸¤ä¸ªæ–¹å‘å‡ºç°çš„çŠ¶æ€æ˜¯ç»è¿‡å¤šå°‘æ¬¡è½¬æ¢è€Œæ¥
         * e.g
         * m1 = {"1000":1} ä»£è¡¨ "1000" ç”± s="0000" æ›¿æ¢ 1 æ¬¡å­—ç¬¦è€Œæ¥
         * m2 = {"9999":3} ä»£è¡¨ "9999" ç”± t="9996" æ›¿æ¢ 3 æ¬¡å­—ç¬¦è€Œæ¥
         */
        Map<String, Integer> m1 = new HashMap<>(), m2 = new HashMap<>();
        d1.addLast(s);
        m1.put(s, 0);
        d2.addLast(t);
        m2.put(t, 0);

        /*
         * åªæœ‰ä¸¤ä¸ªé˜Ÿåˆ—éƒ½ä¸ç©ºï¼Œæ‰æœ‰å¿…è¦ç»§ç»­å¾€ä¸‹æœç´¢
         * å¦‚æœå…¶ä¸­ä¸€ä¸ªé˜Ÿåˆ—ç©ºäº†ï¼Œè¯´æ˜ä»æŸä¸ªæ–¹å‘æœåˆ°åº•éƒ½æœä¸åˆ°è¯¥æ–¹å‘çš„ç›®æ ‡èŠ‚ç‚¹
         * e.g. 
         * ä¾‹å¦‚ï¼Œå¦‚æœ d1 ä¸ºç©ºäº†ï¼Œè¯´æ˜ä» s æœç´¢åˆ°åº•éƒ½æœç´¢ä¸åˆ° tï¼Œåå‘æœç´¢ä¹Ÿæ²¡å¿…è¦è¿›è¡Œäº†
         */
        while (!d1.isEmpty() && !d2.isEmpty()) {
            int t = -1;
            if (d1.size() <= d2.size()) {
                t = update(d1, m1, m2);
            } else {
                t = update(d2, m2, m1);
            }
            if (t != -1) return t;
        }
        return -1;       
    }
    int update(Deque<String> deque, Map<String, Integer> cur, Map<String, Integer> other) {
        String poll = deque.pollFirst();
        char[] pcs = poll.toCharArray();
        int step = cur.get(poll);
        // æšä¸¾æ›¿æ¢å“ªä¸ªå­—ç¬¦
        for (int i = 0; i < 4; i++) {
            // èƒ½ã€Œæ­£å‘è½¬ã€ä¹Ÿèƒ½ã€Œåå‘è½¬ã€ï¼Œè¿™é‡Œç›´æ¥æšä¸¾åç§»é‡ [-1,1] ç„¶åè·³è¿‡ 0
            for (int j = -1; j <= 1; j++) {
                if (j == 0) continue;

                // æ±‚å¾—æ›¿æ¢å­—ç¬¦ä¸² str
                int origin = pcs[i] - '0';
                int next = (origin + j) % 10;
                if (next == -1) next = 9;

                char[] clone = pcs.clone();
                clone[i] = (char)(next + '0');
                String str = String.valueOf(clone);

                if (set.contains(str)) continue;
                if (cur.containsKey(str)) continue;

                // å¦‚æœåœ¨ã€Œå¦ä¸€æ–¹å‘ã€æ‰¾åˆ°è¿‡ï¼Œè¯´æ˜æ‰¾åˆ°äº†æœ€çŸ­è·¯ï¼Œå¦åˆ™åŠ å…¥é˜Ÿåˆ—
                if (other.containsKey(str)) { 
                    return step + 1 + other.get(str);
                } else {
                    deque.addLast(str);
                    cur.put(str, step + 1);
                }
            }
        }
        return -1;
    }
}
```

---

### AStar ç®—æ³•

å¯ä»¥ç›´æ¥æ ¹æ®æœ¬é¢˜è§„åˆ™æ¥è®¾è®¡ A* çš„ã€Œå¯å‘å¼å‡½æ•°ã€ã€‚

æ¯”å¦‚å¯¹äºä¸¤ä¸ªçŠ¶æ€ `a` å’Œ `b` å¯ç›´æ¥è®¡ç®—å‡ºã€Œç†è®ºæœ€å°è½¬æ¢æ¬¡æ•°ã€ï¼š**ä¸åŒå­—ç¬¦çš„è½¬æ¢æˆæœ¬ä¹‹å’Œ** ã€‚

**éœ€è¦æ³¨æ„çš„æ˜¯ï¼šç”±äºæˆ‘ä»¬è¡¡é‡æŸä¸ªå­—ç¬¦ `str` çš„ä¼°å€¼æ˜¯ä»¥ç›®æ ‡å­—ç¬¦ä¸² `target` ä¸ºåŸºå‡†ï¼Œå› æ­¤æˆ‘ä»¬åªèƒ½ç¡®ä¿ `target` å‡ºé˜Ÿæ—¶ä¸ºã€Œè·ç¦»æœ€çŸ­ã€ï¼Œè€Œä¸èƒ½ç¡®ä¿ä¸­é—´èŠ‚ç‚¹å‡ºé˜Ÿæ—¶ã€Œè·ç¦»æœ€çŸ­ã€ï¼Œå› æ­¤æˆ‘ä»¬ä¸èƒ½å•çº¯æ ¹æ®æŸä¸ªèŠ‚ç‚¹æ˜¯å¦ã€Œæ›¾ç»å…¥é˜Ÿã€è€Œå†³å®šæ˜¯å¦å…¥é˜Ÿï¼Œè¿˜è¦ç»“åˆå½“å‰èŠ‚ç‚¹çš„ã€Œæœ€å°è·ç¦»ã€æ˜¯å¦è¢«æ›´æ–°è€Œå†³å®šæ˜¯å¦å…¥é˜Ÿã€‚**

è¿™ä¸€ç‚¹ååˆ†å…³é”®ï¼Œåœ¨ä»£ç å±‚é¢ä¸Šä½“ç°åœ¨ `map.get(str).step > poll.step + 1` çš„åˆ¤æ–­ä¸Šã€‚

æ³¨æ„ï¼šæœ¬é¢˜ç”¨ A* è¿‡äº†ï¼Œä½†é€šå¸¸æˆ‘ä»¬éœ€è¦å…ˆã€Œç¡®ä¿æœ‰è§£ã€ï¼ŒA* çš„å¯å‘æœç´¢æ‰ä¼šå‘æŒ¥çœŸæ­£ä»·å€¼ã€‚è€Œæœ¬é¢˜ï¼Œé™¤é `t` æœ¬èº«åœ¨ `deadends` ä¸­ï¼Œå…¶ä½™æƒ…å†µæˆ‘ä»¬æ— æ³•å¾ˆå¥½æå‰åˆ¤æ–­ã€Œæ˜¯å¦æœ‰è§£ã€ã€‚å¯¹äºæ— è§£çš„æƒ…å†µ A* æ•ˆæœä¸å¦‚ã€ŒåŒå‘ BFSã€ã€‚

![image.png](https://pic.leetcode-cn.com/1624587457-HnLCBq-image.png)

ä»£ç ï¼š
```Java []
class Solution {
    class Node {
        String str;
        int val, step;
       /**
        *  str : å¯¹åº”å­—ç¬¦ä¸²
        *  val : ä¼°å€¼ï¼ˆä¸ç›®æ ‡å­—ç¬¦ä¸² target çš„æœ€å°è½¬æ¢æˆæœ¬ï¼‰
        *  step: å¯¹åº”å­—ç¬¦ä¸²æ˜¯ç»è¿‡å¤šå°‘æ­¥è½¬æ¢è€Œæ¥
        */
        Node(String _str, int _val, int _step) {
            str = _str;
            val = _val;
            step = _step;
        }
    }
    int f(String str) {
        int ans = 0;
        for (int i = 0; i < 4; i++) {
            int cur = str.charAt(i) - '0', target = t.charAt(i) - '0';
            int a = Math.min(cur, target), b = Math.max(cur, target);
            // åœ¨ã€Œæ­£å‘è½¬ã€å’Œã€Œåå‘è½¬ã€ä¹‹é—´å– min
            int min = Math.min(b - a, a + 10 - b);
            ans += min;
        }
        return ans;
    }
    String s, t;
    Set<String> set = new HashSet<>();
    public int openLock(String[] ds, String _t) {
        s = "0000";
        t = _t;
        if (s.equals(t)) return 0;
        for (String d : ds) set.add(d);
        if (set.contains(s)) return -1;
        
        PriorityQueue<Node> q = new PriorityQueue<>((a,b)->a.val-b.val);
        Map<String, Node> map = new HashMap<>();
        Node root = new Node(s, f(s), 0);
        q.add(root);
        map.put(s, root);
        while (!q.isEmpty()) {
            Node poll = q.poll();
            char[] pcs = poll.str.toCharArray();
            int step = poll.step;
            if (poll.str.equals(t)) return step;
            for (int i = 0; i < 4; i++) {
                for (int j = -1; j <= 1; j++) {
                    if (j == 0) continue;
                    int cur = pcs[i] - '0';
                    int next = (cur + j) % 10;
                    if (next == -1) next = 9;

                    char[] clone = pcs.clone();
                    clone[i] = (char)(next + '0');
                    String str = String.valueOf(clone);

                    if (set.contains(str)) continue;
                    // å¦‚æœ str è¿˜æ²¡æœç´¢è¿‡ï¼Œæˆ–è€… str çš„ã€Œæœ€çŸ­è·ç¦»ã€è¢«æ›´æ–°ï¼Œåˆ™å…¥é˜Ÿ
                    if (!map.containsKey(str) || map.get(str).step > step + 1) {
                        Node node = new Node(str, step + 1 + f(str), step + 1);
                        map.put(str, node);
                        q.add(node);
                    }
                }
            }
        }
        return -1;
    }
}
```

---

### IDA* ç®—æ³•

åŒæ ·æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŸºäº `DFS` çš„å¯å‘å¼ IDA* ç®—æ³•ï¼š

* ä»ç„¶ä½¿ç”¨ `f()` ä½œä¸ºä¼°å€¼å‡½æ•°
* åˆ©ç”¨æ—‹è½¬æ¬¡æ•°æœ‰é™ï¼šæ€»æ—‹è½¬æ¬¡æ•°ä¸ä¼šè¶…è¿‡æŸä¸ªé˜ˆå€¼ $\max$ã€‚ 
* åˆ©ç”¨ã€Œè¿­ä»£åŠ æ·±ã€çš„æ€è·¯æ‰¾åˆ°æœ€çŸ­è·ç¦»

ç†æƒ³æƒ…å†µä¸‹ï¼Œç”±äºå­˜åœ¨æ­£å‘æ—‹è½¬å’Œåå‘æ—‹è½¬ï¼Œæ¯ä¸€ä½è½¬è½®ä»ä»»æ„æ•°å­—å¼€å§‹åˆ°è¾¾ä»»æ„æ•°å­—ï¼Œæ¶ˆè€—æ¬¡æ•°ä¸ä¼šè¶…è¿‡ $5$ æ¬¡ï¼Œå› æ­¤ç†æƒ³æƒ…å†µä¸‹å¯ä»¥è®¾å®š $\max = 5 * 4$ ã€‚

ä½†è€ƒè™‘ `deadends` çš„å­˜åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å°† $\max$ å®šä¹‰å¾—æ›´åŠ ä¿å®ˆä¸€äº›ï¼š$\max = 10 * 4$ ã€‚

**ä½†è¿™æ ·çš„é˜ˆå€¼è®¾å®šï¼ŒåŠ ä¸Š IDA\* ç®—æ³•æ¯æ¬¡ä¼šé‡å¤éå†ã€Œè·ç¦»å°äºä¸ç›®æ ‡èŠ‚ç‚¹è·ç¦»ã€çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œä¼šæœ‰å¾ˆå¤§çš„ TLE é£é™©ã€‚**

**å› æ­¤æˆ‘ä»¬éœ€è¦ä½¿ç”¨åŠ¨æ€é˜ˆå€¼ï¼šä¸å†ä½¿ç”¨å›ºå®šçš„é˜ˆå€¼ï¼Œè€Œæ˜¯åˆ©ç”¨ `target` è®¡ç®—å‡ºã€Œæœ€å¤§çš„è½¬ç§»æˆæœ¬ã€ä½œä¸ºæˆ‘ä»¬çš„ã€Œæœ€æ·±æ•°é‡çº§ã€ã€‚**

PS. ä¸Šè¿°çš„é˜ˆå€¼åˆ†ææ˜¯ç§‘å­¦åšæ³•ã€‚å¯¹äºæœ¬é¢˜å¯ä»¥åˆ©ç”¨æ•°æ®å¼±ï¼Œç›´æ¥ä½¿ç”¨ $\max = 5 * 4$ ä¹Ÿå¯ä»¥é€šè¿‡ï¼Œå¹¶ä¸”æ•ˆæœä¸é”™ã€‚

ä½†å¿…é¡»æ¸…æ¥š $\max = 5 * 4$ å¯èƒ½æ˜¯ä¸€ä¸ªé”™è¯¯çš„é˜ˆå€¼ï¼Œæœ¬é¢˜èµ·ç‚¹ä¸º `0000`ï¼Œè€ƒè™‘å°†æ‰€æœ‰æ­£å‘è½¬æ¢çš„çŠ¶æ€éƒ½æ”¾å…¥ `deadends` ä¸­ï¼Œ`target` ä¸º `2222`ã€‚è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥åªé™å®š `0000` å…ˆå˜ä¸º `9999` å†å¾€å›å˜ä¸º `2222` çš„é€šè·¯ä¸åœ¨ `deadends` ä¸­ã€‚

è¿™æ—¶å€™ä½¿ç”¨ $\max = 5 * 4$ å°±ä¸å¯¹ï¼Œä½†æœ¬é¢˜æ•°æ®å¼±ï¼Œå¯ä»¥é€šè¿‡ï¼ˆæƒ³æäº¤é”™è¯¯æ•°æ®æ‹¿ç§¯åˆ†å—ï¼Ÿåˆ«è¯•äº†ï¼Œæˆ‘å·²ç»æäº¤äº† ğŸ¤£

![image.png](https://pic.leetcode-cn.com/1624601384-QgVZah-image.png)

ä»£ç ï¼š
```Java []
class Solution {
    String s, t;
    String cur;
    Set<String> set = new HashSet<>();
    Map<String, Integer> map = new HashMap<>();
    public int openLock(String[] ds, String _t) {
        s = "0000";
        t = _t;
        if (s.equals(t)) return 0;
        for (String d : ds) set.add(d);
        if (set.contains(s)) return -1;   

        int depth = 0, max = getMax();
        cur = s;
        map.put(cur, 0);
        while (depth <= max && !dfs(0, depth)) {
            map.clear();
            cur = s;
            map.put(cur, 0);
            depth++;
        }
        return depth > max ? -1 : depth;
    }
    int getMax() {
        int ans = 0;
        for (int i = 0; i < 4; i++) {
            int origin = s.charAt(i) - '0', next = t.charAt(i) - '0';
            int a = Math.min(origin, next), b = Math.max(origin, next);
            int max = Math.max(b - a, a + 10 - b);
            ans += max;
        }
        return ans;
    }
    int f() {
        int ans = 0;
        for (int i = 0; i < 4; i++) {
            int origin = cur.charAt(i) - '0', next = t.charAt(i) - '0';
            int a = Math.min(origin, next), b = Math.max(origin, next);
            int min = Math.min(b - a, a + 10 - b);
            ans += min;
        }
        return ans;
    }
    boolean dfs(int u, int max) {
        if (u + f() > max) return false;
        if (f() == 0) return true;
        String backup = cur;
        char[] cs = cur.toCharArray();
        for (int i = 0; i < 4; i++) {
            for (int j = -1; j <= 1; j++) {
                if (j == 0) continue;
                int origin = cs[i] - '0';
                int next = (origin + j) % 10;
                if (next == -1) next = 9;
                char[] clone = cs.clone();
                clone[i] = (char)(next + '0');
                String str = String.valueOf(clone);  
                if (set.contains(str)) continue;
                if (!map.containsKey(str) || map.get(str) > u + 1) {
                    cur = str;
                    map.put(str, u + 1);
                    if (dfs(u + 1, max)) return true;
                    cur = backup;
                }
            }
        }
        return false;
    }
}
```

---

### æœ€å

è¿™æ˜¯æˆ‘ä»¬ã€Œåˆ·ç©¿ LeetCodeã€ç³»åˆ—æ–‡ç« çš„ç¬¬ `No.751` ç¯‡ï¼Œç³»åˆ—å¼€å§‹äº 2021/01/01ï¼Œæˆªæ­¢äºèµ·å§‹æ—¥ LeetCode ä¸Šå…±æœ‰ 1916 é“é¢˜ç›®ï¼Œéƒ¨åˆ†æ˜¯æœ‰é”é¢˜ï¼Œæˆ‘ä»¬å°†å…ˆå°†æ‰€æœ‰ä¸å¸¦é”çš„é¢˜ç›®åˆ·å®Œã€‚

åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« é‡Œé¢ï¼Œé™¤äº†è®²è§£è§£é¢˜æ€è·¯ä»¥å¤–ï¼Œè¿˜ä¼šå°½å¯èƒ½ç»™å‡ºæœ€ä¸ºç®€æ´çš„ä»£ç ã€‚å¦‚æœæ¶‰åŠé€šè§£è¿˜ä¼šç›¸åº”çš„ä»£ç æ¨¡æ¿ã€‚

ä¸ºäº†æ–¹ä¾¿å„ä½åŒå­¦èƒ½å¤Ÿç”µè„‘ä¸Šè¿›è¡Œè°ƒè¯•å’Œæäº¤ä»£ç ï¼Œæˆ‘å»ºç«‹äº†ç›¸å…³çš„ä»“åº“ï¼šhttps://github.com/SharingSource/LogicStack-LeetCode ã€‚

åœ¨ä»“åº“åœ°å€é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°ç³»åˆ—æ–‡ç« çš„é¢˜è§£é“¾æ¥ã€ç³»åˆ—æ–‡ç« çš„ç›¸åº”ä»£ç ã€LeetCode åŸé¢˜é“¾æ¥å’Œå…¶ä»–ä¼˜é€‰é¢˜è§£ã€‚

