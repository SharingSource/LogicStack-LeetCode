### é¢˜ç›®æè¿°

è¿™æ˜¯ LeetCode ä¸Šçš„ **[1239. ä¸²è”å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦](https://leetcode-cn.com/problems/maximum-length-of-a-concatenated-string-with-unique-characters/solution/gong-shui-san-xie-yi-ti-san-jie-jian-zhi-nfeb/)** ï¼Œéš¾åº¦ä¸º **ä¸­ç­‰**ã€‚

Tag : ã€ŒDFSã€ã€ã€ŒäºŒè¿›åˆ¶æšä¸¾ã€ã€ã€Œæ¨¡æ‹Ÿé€€ç«ã€ã€ã€ŒéšæœºåŒ–ã€



ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ `arr`ï¼Œå­—ç¬¦ä¸² `s` æ˜¯å°† `arr` æŸä¸€å­åºåˆ—å­—ç¬¦ä¸²è¿æ¥æ‰€å¾—çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœ `s` ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦éƒ½åªå‡ºç°è¿‡ä¸€æ¬¡ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªå¯è¡Œè§£ã€‚

è¯·è¿”å›æ‰€æœ‰å¯è¡Œè§£ `s` ä¸­æœ€é•¿é•¿åº¦ã€‚


ç¤ºä¾‹ 1ï¼š
```
è¾“å…¥ï¼šarr = ["un","iq","ue"]

è¾“å‡ºï¼š4

è§£é‡Šï¼šæ‰€æœ‰å¯èƒ½çš„ä¸²è”ç»„åˆæ˜¯ "","un","iq","ue","uniq" å’Œ "ique"ï¼Œæœ€å¤§é•¿åº¦ä¸º 4ã€‚
```
ç¤ºä¾‹ 2ï¼š
```
è¾“å…¥ï¼šarr = ["cha","r","act","ers"]

è¾“å‡ºï¼š6

è§£é‡Šï¼šå¯èƒ½çš„è§£ç­”æœ‰ "chaers" å’Œ "acters"ã€‚
```
ç¤ºä¾‹ 3ï¼š
```
è¾“å…¥ï¼šarr = ["abcdefghijklmnopqrstuvwxyz"]

è¾“å‡ºï¼š26
```

æç¤ºï¼š
* $1 <= arr.length <= 16$
* $1 <= arr[i].length <= 26$
* `arr[i]`Â ä¸­åªå«æœ‰å°å†™è‹±æ–‡å­—æ¯

---

### åŸºæœ¬åˆ†æ

æ ¹æ®é¢˜æ„ï¼Œå¯ä»¥å°†æœ¬é¢˜çœ‹åšä¸€ç±»ç‰¹æ®Šçš„ã€Œæ•°ç‹¬é—®é¢˜ã€ï¼šåœ¨ç»™å®šçš„ `arr` å­—ç¬¦æ•°ç»„ä¸­é€‰æ‹©ï¼Œå°½å¯èƒ½å¤šçš„è¦†ç›–ä¸€ä¸ª $1 * 26$ çš„çŸ©é˜µã€‚

å¯¹äºæ­¤ç±»ã€Œç²¾ç¡®è¦†ç›–ã€é—®é¢˜ï¼Œæ¢ä¸ªè§’åº¦ä¹Ÿå¯ä»¥çœ‹åšã€Œç»„åˆé—®é¢˜ã€ã€‚

é€šå¸¸æœ‰å‡ ç§åšæ³•ï¼š`DFS`ã€å‰ªæ `DFS`ã€äºŒè¿›åˆ¶æšä¸¾ã€æ¨¡æ‹Ÿé€€ç«ã€`DLX`ã€‚

å…¶ä¸­ä¸€å¤´ä¸€å°¾è§£æ³•è¿‡äºç®€å•å’Œå›°éš¾ï¼Œæœ‰å…´è¶£çš„åŒå­¦è‡ªè¡Œäº†è§£ä¸å®ç°ã€‚

---

### åŸºæœ¬åˆ†æ

æ ¹æ®é¢˜æ„ï¼Œå¯ä»¥å°†æœ¬é¢˜çœ‹åšä¸€ç±»ç‰¹æ®Šçš„ã€Œæ•°ç‹¬é—®é¢˜ã€ï¼šåœ¨ç»™å®šçš„ `arr` å­—ç¬¦æ•°ç»„ä¸­é€‰æ‹©ï¼Œå°½å¯èƒ½å¤šçš„è¦†ç›–ä¸€ä¸ª $1 * 26$ çš„çŸ©é˜µã€‚

å¯¹äºæ­¤ç±»ã€Œç²¾ç¡®è¦†ç›–ã€é—®é¢˜ï¼Œæ¢ä¸ªè§’åº¦ä¹Ÿå¯ä»¥çœ‹åšã€Œç»„åˆé—®é¢˜ã€ã€‚

é€šå¸¸æœ‰å‡ ç§åšæ³•ï¼š`DFS`ã€å‰ªæ `DFS`ã€äºŒè¿›åˆ¶æšä¸¾ã€æ¨¡æ‹Ÿé€€ç«ã€`DLX`ã€‚

å…¶ä¸­ä¸€å¤´ä¸€å°¾è§£æ³•è¿‡äºç®€å•å’Œå›°éš¾ï¼Œæœ‰å…´è¶£çš„åŒå­¦è‡ªè¡Œäº†è§£ä¸å®ç°ã€‚

---

### å‰ªæ DFS

æ ¹æ®é¢˜æ„ï¼Œå¯ä»¥æœ‰å¦‚ä¸‹çš„å‰ªæç­–ç•¥ï¼š

1. é¢„å¤„ç†æ‰ã€Œæœ¬èº«å…·æœ‰é‡å¤å­—ç¬¦ã€çš„æ— æ•ˆå­—ç¬¦ä¸²ï¼Œå¹¶å»é‡ï¼›
2. ç”±äºåªå…³å¿ƒæŸä¸ªå­—ç¬¦æ˜¯å¦å‡ºç°ï¼Œè€Œä¸å…³å¿ƒæŸä¸ªå­—ç¬¦åœ¨åŸå­—ç¬¦ä¸²çš„ä½ç½®ï¼Œå› æ­¤å¯ä»¥å°†å­—ç¬¦ä¸²ä½¿ç”¨ `int` è¿›è¡Œè¡¨ç¤ºï¼›
3. ç”±äºä½¿ç”¨ `int` è¿›è¡Œè¡¨ç¤ºï¼Œå› è€Œå¯ä»¥ä½¿ç”¨ã€Œä½è¿ç®—ã€æ¥åˆ¤æ–­æŸä¸ªå­—ç¬¦æ˜¯å¦å¯ä»¥è¢«è¿½åŠ åˆ°å½“å‰çŠ¶æ€ä¸­ï¼›
4. `DFS` è¿‡ç¨‹ä¸­ç»´æŠ¤ä¸€ä¸ª `total`ï¼Œä»£è¡¨åç»­æœªç»å¤„ç†çš„å­—ç¬¦ä¸²æ‰€å‰©ä½™çš„â€œæœ€å¤§ä»·å€¼â€æ˜¯å¤šå°‘ï¼Œä»è€Œå®ç°å‰ªæï¼›
5. ä½¿ç”¨ `lowbit` è®¡ç®—æŸä¸ªçŠ¶æ€å¯¹åº”çš„å­—ç¬¦é•¿åº¦æ˜¯å¤šå°‘ï¼›
6. ä½¿ç”¨ã€Œå…¨å±€å“ˆå¸Œè¡¨ã€è®°å½•æŸä¸ªçŠ¶æ€å¯¹åº”çš„å­—ç¬¦é•¿åº¦æ˜¯å¤šå°‘ï¼ˆä½¿ç”¨ `static` ä¿®é¥°ï¼Œç¡®ä¿æŸä¸ªçŠ¶æ€åœ¨æ‰€æœ‰æµ‹è¯•æ•°æ®ä¸­åªä¼šè¢«è®¡ç®—ä¸€æ¬¡ï¼‰ï¼›
7. ã€æœªåº”ç”¨ã€‘ç”±äºå­˜åœ¨ç¬¬ $4$ ç‚¹è¿™æ ·çš„ã€Œæ›´ä¼˜æ€§å‰ªæã€ï¼Œç†è®ºä¸Šæˆ‘ä»¬å¯ä»¥æ ¹æ®ã€Œå­—ç¬¦ä¸²æ‰€åŒ…å«å­—ç¬¦æ•°é‡ã€è¿›è¡Œä»å¤§åˆ°å°æ’åºï¼Œç„¶åå†è¿›è¡Œ `DFS` è¿™æ ·æ•ˆæœç†è®ºä¸Šä¼šæ›´å¥½ã€‚æƒ³è±¡ä¸€ä¸‹å¦‚æœå­˜åœ¨ä¸€ä¸ªåŒ…å«æ‰€æœ‰å­—æ¯çš„å­—ç¬¦ä¸²ï¼Œå…ˆé€‰æ‹©è¯¥å­—ç¬¦ä¸²ï¼Œåç»­æ‰€æœ‰å­—ç¬¦ä¸²å°†ä¸èƒ½è¢«æ·»åŠ ï¼Œé‚£ä¹ˆç”±å®ƒå‡ºå‘çš„åˆ†æ”¯æ•°é‡ä¸º $0$ï¼›è€Œå¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²åªåŒ…å«å•ä¸ªå­—æ¯ï¼Œå…ˆå†³ç­–é€‰æ‹©è¯¥å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆç”±å®ƒå‡ºå‘çš„åˆ†æ”¯æ•°é‡å¿…ç„¶å¤§äº $0$ã€‚ä½†è¯¥ç­–ç•¥å®æµ‹æ•ˆæœä¸å¥½ï¼Œæ²¡æœ‰æ·»åŠ åˆ°ä»£ç ä¸­ã€‚

![image.png](https://pic.leetcode-cn.com/1624068553-ggjqyc-image.png)

ä»£ç ï¼š
```Java
class Solution {
    // æœ¬æ¥æƒ³ä½¿ç”¨å¦‚ä¸‹é€»è¾‘å°†ã€Œæ‰€æœ‰å¯èƒ½ç”¨åˆ°çš„çŠ¶æ€ã€æ‰“è¡¨ï¼Œå®ç° O(1) æŸ¥è¯¢æŸä¸ªçŠ¶æ€æœ‰å¤šå°‘ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯è¢«å¡äº†
    // static int N = 26, M = (1 << N);
    // static int[] cnt = new int[M];
    // static {
    //     for (int i = 0; i < M; i++) {
    //         for (int j = 0; j < 26; j++) {
    //             if (((i >> j) & 1) == 1) cnt[i]++;
    //         }
    //     }
    // }

    static Map<Integer, Integer> map = new HashMap<>();
    int get(int cur) {
        if (map.containsKey(cur)) {
            return map.get(cur);
        }
        int ans = 0;
        for (int i = cur; i > 0; i -= lowbit(i)) ans++;
        map.put(cur, ans);
        return ans;
    }
    int lowbit(int x) {
        return x & -x;
    }

    int n;
    int ans = Integer.MIN_VALUE;
    int[] hash;
    public int maxLength(List<String> _ws) {
        n = _ws.size();
        HashSet<Integer> set = new HashSet<>();
        for (String s : _ws) {
            int val = 0;
            for (char c : s.toCharArray()) {
                int t = (int)(c - 'a');
                if (((val >> t) & 1) != 0) {
                    val = -1;
                    break;
                } 
                val |= (1 << t);
            }
            if (val != -1) set.add(val);
        }

        n = set.size();
        if (n == 0) return 0;
        hash = new int[n];

        int idx = 0;
        int total = 0;
        for (Integer i : set) {
            hash[idx++] = i;
            total |= i;
        }
        dfs(0, 0, total);
        return ans;
    }
    void dfs(int u, int cur, int total) {
        if (get(cur | total) <= ans) return;
        if (u == n) {
            ans = Math.max(ans, get(cur));
            return;
        }
        // åœ¨åŸæœ‰åŸºç¡€ä¸Šï¼Œé€‰æ‹©è¯¥æ•°å­—ï¼ˆå¦‚æœå¯ä»¥ï¼‰
        if ((hash[u] & cur) == 0) {
            dfs(u + 1, hash[u] | cur, total - (total & hash[u]));
        }
        // ä¸é€‰æ‹©è¯¥æ•°å­—
        dfs(u + 1, cur, total);
    }
}
```

---

### äºŒè¿›åˆ¶æšä¸¾

é¦–å…ˆè¿˜æ˜¯å¯¹æ‰€æœ‰å­—ç¬¦ä¸²è¿›è¡Œé¢„å¤„ç†ã€‚

ç„¶åä½¿ç”¨ã€ŒäºŒè¿›åˆ¶æšä¸¾ã€çš„æ–¹å¼ï¼Œæšä¸¾æŸä¸ªå­—ç¬¦ä¸²æ˜¯å¦è¢«é€‰æ‹©ã€‚

ä¸¾ä¸ªğŸŒ°ï¼Œ$(110)_{2}$ ä»£è¡¨é€‰æ‹©å‰ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œ$(011)_{2}$ ä»£è¡¨é€‰æ‹©åä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™æ ·æˆ‘ä»¬ä¾¿å¯ä»¥æšä¸¾å‡ºæ‰€æœ‰ç»„åˆæ–¹æ¡ˆã€‚

![image.png](https://pic.leetcode-cn.com/1624066961-hQLRLR-image.png)

ä»£ç ï¼š
```Java
class Solution {
    static Map<Integer, Integer> map = new HashMap<>();
    int get(int cur) {
        if (map.containsKey(cur)) {
            return map.get(cur);
        }
        int ans = 0;
        for (int i = cur; i > 0; i -= lowbit(i)) ans++;
        map.put(cur, ans);
        return ans;
    }
    int lowbit(int x) {
        return x & -x;
    }

    int n;
    int ans = Integer.MIN_VALUE;
    Integer[] hash;
    public int maxLength(List<String> _ws) {
        n = _ws.size();
        HashSet<Integer> set = new HashSet<>();
        for (String s : _ws) {
            int val = 0;
            for (char c : s.toCharArray()) {
                int t = (int)(c - 'a');
                if (((val >> t) & 1) != 0) {
                    val = -1;
                    break;
                } 
                val |= (1 << t);
            }
            if (val != -1) set.add(val);
        }

        n = set.size();
        if (n == 0) return 0;
        hash = new Integer[n];
        int idx = 0;
        for (Integer i : set) hash[idx++] = i;

        for (int i = 0; i < (1 << n); i++) {
            int cur = 0, val = 0;
            for (int j = 0; j < n; j++) {
                if (((i >> j) & 1) == 1) {
                    if ((cur & hash[j]) == 0) {
                        cur |= hash[j];
                        val += get(hash[j]);
                    } else {
                        cur = -1;
                        break;
                    }
                }
            }
            if (cur != -1) ans = Math.max(ans, val);
        }
        return ans;
    }
}
```

---

### æ¨¡æ‹Ÿé€€ç«

äº‹å®ä¸Šï¼Œå¯ä»¥å°†åŸé—®é¢˜çœ‹ä½œæ±‚ã€Œæœ€ä¼˜å‰ç¼€åºåˆ—ã€é—®é¢˜ï¼Œä»è€Œä½¿ç”¨ã€Œæ¨¡æ‹Ÿé€€ç«ã€è¿›è¡Œæ±‚è§£ã€‚

å…·ä½“çš„ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ã€Œæœ€ä¼˜å‰ç¼€åºåˆ—ã€ä¸º **ç»„æˆæœ€ä¼˜è§£æ‰€ç”¨åˆ°çš„å­—ç¬¦ä¸²å‡å‡ºç°åœ¨æ’åˆ—çš„å‰é¢ã€‚**

ä¸¾ä¸ªğŸŒ°ï¼Œå‡å¦‚æ„æˆæœ€ä¼˜è§£ä½¿ç”¨åˆ°çš„å­—ç¬¦ä¸²é›†åˆä¸º `[a,b,c]`ï¼Œé‚£ä¹ˆå¯¹åº” `[a,b,c,...]`ã€`[a,c,b,...]` å‡ç§°ä¸ºã€Œæœ€ä¼˜å‰ç¼€åºåˆ—ã€ã€‚

ä¸éš¾å‘ç°ï¼Œç­”æ¡ˆä¸æœ€ä¼˜å‰ç¼€åºåˆ—æ˜¯ä¸€å¯¹å¤šå…³ç³»ï¼Œè¿™æŒ‡å¯¼æˆ‘ä»¬å¯ä»¥å°†ã€Œå‚æ•°ã€è°ƒå¾—å®½æ¾ä¸€äº›ã€‚

**å…·æœ‰ã€Œä¸€å¯¹å¤šã€å…³ç³»çš„é—®é¢˜ååˆ†é€‚åˆä½¿ç”¨ã€Œæ¨¡æ‹Ÿé€€ç«ã€ï¼Œä½¿ç”¨ã€Œæ¨¡æ‹Ÿé€€ç«ã€å¯ä»¥è½»æ¾å°†æœ¬é¢˜ `arr.length` æ•°æ®èŒƒå›´ä¸Šå‡åˆ° $60$ ç”šè‡³ä»¥ä¸Šã€‚**

è°ƒæ•´æˆæ¯”è¾ƒå®½æ¾çš„å‚æ•°å¯ä»¥è·‘èµ¢ã€ŒäºŒè¿›åˆ¶æšä¸¾ã€ï¼Œä½†ä¸ºäº†ä»¥åå¢åŠ æ•°æ®ä¸å®¹æ˜“è¢« hackï¼Œè¿˜æ˜¯ä½¿ç”¨ `N=400` & `fa=0.90` çš„æ­é…ã€‚

ã€Œæ¨¡æ‹Ÿé€€ç«ã€çš„å‡ ä¸ªå‚æ•°çš„ä½œç”¨åœ¨ [è¿™é‡Œ](https://leetcode-cn.com/problems/find-minimum-time-to-finish-all-jobs/solution/gong-shui-san-xie-yi-ti-shuang-jie-jian-4epdd/) è¯´è¿‡äº†ï¼Œä¸å†èµ˜è¿°ã€‚

![image.png](https://pic.leetcode-cn.com/1624067037-soNiWI-image.png)

ä»£ç ï¼š
```Java
class Solution {
    static Map<Integer, Integer> map = new HashMap<>();
    int get(int cur) {
        if (map.containsKey(cur)) {
            return map.get(cur);
        }
        int ans = 0;
        for (int i = cur; i > 0; i -= lowbit(i)) ans++;
        map.put(cur, ans);
        return ans;
    }
    int lowbit(int x) {
        return x & -x;
    }

    int n;
    int ans = Integer.MIN_VALUE;    
    Random random = new Random(20210619);
    double hi = 1e4, lo = 1e-4, fa = 0.90; 
    int N = 400; 
    int calc() {
        int mix = 0, cur = 0;
        for (int i = 0; i < n; i++) {
            int hash = ws[i];
            if ((mix & hash) == 0) {
                mix |= hash;
                cur += get(hash);
            } else {
                break;
            }
        }
        ans = Math.max(ans, cur);
        return cur;
    }
    void shuffle(int[] nums) {
        for (int i = n; i > 0; i--) {
            int idx = random.nextInt(i);
            swap(nums, idx, i - 1);
        }
    }
    void swap(int[] nums, int a, int b) {
        int c = nums[a];
        nums[a] = nums[b];
        nums[b] = c;
    }
    void sa() {
        shuffle(ws);
        for (double t = hi; t > lo; t *= fa) {
            int a = random.nextInt(n), b = random.nextInt(n);
            int prev = calc(); 
            swap(ws, a, b);
            int cur = calc(); 
            int diff = cur - prev;
            if (Math.log(-diff / t) > random.nextDouble()) swap(ws, a, b);
        }
    }
    int[] ws;
    public int maxLength(List<String> _ws) {
        // é¢„å¤„ç†å­—ç¬¦ä¸²ï¼šå»é‡ï¼Œå‰”é™¤æ— æ•ˆå­—ç¬¦
        // ç»“æœè¿™ä¸€æ­¥åï¼šN å¯ä»¥ä¸‹é™åˆ° 100ï¼›fa å¯ä»¥ä¸‹é™åˆ° 0.70ï¼Œè€—æ—¶çº¦ä¸º 78 ms
        // ä¸ºäº†é¢„ç•™å°†æ¥æ·»åŠ æµ‹è¯•æ•°æ®ï¼Œé¢˜è§£è¿˜æ˜¯ä¿æŒ N = 400 & fa = 0.90 çš„é…ç½®
        n = _ws.size();
        HashSet<Integer> set = new HashSet<>();
        for (String s : _ws) {
            int val = 0;
            for (char c : s.toCharArray()) {
                int t = (int)(c - 'a');
                if (((val >> t) & 1) != 0) {
                    val = -1;
                    break;
                } 
                val |= (1 << t);
            }
            if (val != -1) set.add(val);
        }

        n = set.size();
        if (n == 0) return 0;
        ws = new int[n];
        int idx = 0;
        for (Integer i : set) ws[idx++] = i;

        while (N-- > 0) sa();
        return ans;
    }
}
```

---

### æœ€å

è¿™æ˜¯æˆ‘ä»¬ã€Œåˆ·ç©¿ LeetCodeã€ç³»åˆ—æ–‡ç« çš„ç¬¬ `No.1239` ç¯‡ï¼Œç³»åˆ—å¼€å§‹äº 2021/01/01ï¼Œæˆªæ­¢äºèµ·å§‹æ—¥ LeetCode ä¸Šå…±æœ‰ 1916 é“é¢˜ç›®ï¼Œéƒ¨åˆ†æ˜¯æœ‰é”é¢˜ï¼Œæˆ‘ä»¬å°†å…ˆæŠŠæ‰€æœ‰ä¸å¸¦é”çš„é¢˜ç›®åˆ·å®Œã€‚

åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« é‡Œé¢ï¼Œé™¤äº†è®²è§£è§£é¢˜æ€è·¯ä»¥å¤–ï¼Œè¿˜ä¼šå°½å¯èƒ½ç»™å‡ºæœ€ä¸ºç®€æ´çš„ä»£ç ã€‚å¦‚æœæ¶‰åŠé€šè§£è¿˜ä¼šç›¸åº”çš„ä»£ç æ¨¡æ¿ã€‚

ä¸ºäº†æ–¹ä¾¿å„ä½åŒå­¦èƒ½å¤Ÿç”µè„‘ä¸Šè¿›è¡Œè°ƒè¯•å’Œæäº¤ä»£ç ï¼Œæˆ‘å»ºç«‹äº†ç›¸å…³çš„ä»“åº“ï¼šhttps://github.com/SharingSource/LogicStack-LeetCode ã€‚

åœ¨ä»“åº“åœ°å€é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°ç³»åˆ—æ–‡ç« çš„é¢˜è§£é“¾æ¥ã€ç³»åˆ—æ–‡ç« çš„ç›¸åº”ä»£ç ã€LeetCode åŸé¢˜é“¾æ¥å’Œå…¶ä»–ä¼˜é€‰é¢˜è§£ã€‚

