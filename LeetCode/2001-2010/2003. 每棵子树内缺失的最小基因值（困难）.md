### é¢˜ç›®æè¿°

è¿™æ˜¯ LeetCode ä¸Šçš„ **[2003. æ¯æ£µå­æ ‘å†…ç¼ºå¤±çš„æœ€å°åŸºå› å€¼](https://leetcode.cn/problems/smallest-missing-genetic-value-in-each-subtree/solutions/2505877/gong-shui-san-xie-tu-jie-san-da-jie-lun-mxjrn/)** ï¼Œéš¾åº¦ä¸º **å›°éš¾**ã€‚

Tag : ã€ŒDFSã€ã€ã€Œå›¾ã€ã€ã€Œè„‘ç­‹æ€¥è½¬å¼¯ã€



æœ‰ä¸€æ£µæ ¹èŠ‚ç‚¹ä¸º `0` çš„ å®¶æ—æ ‘ ï¼Œæ€»å…±åŒ…å« `n` ä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ç¼–å·ä¸º `0` åˆ° `n - 1`ã€‚

ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» `0` å¼€å§‹çš„æ•´æ•°æ•°ç»„ `parents`ï¼Œå…¶ä¸­ $parents[i]$ æ˜¯èŠ‚ç‚¹ `i` çš„çˆ¶èŠ‚ç‚¹ã€‚ç”±äºèŠ‚ç‚¹ `0` æ˜¯æ ¹ ï¼Œæ‰€ä»¥ $parents[0] = -1$ã€‚

æ€»å…±æœ‰ $10^5$ ä¸ªåŸºå› å€¼ï¼Œæ¯ä¸ªåŸºå› å€¼éƒ½ç”¨ é—­åŒºé—´ $[1, 10^5]$ ä¸­çš„ä¸€ä¸ªæ•´æ•°è¡¨ç¤ºã€‚

ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» `0` å¼€å§‹çš„æ•´æ•°æ•°ç»„ `nums`ï¼Œå…¶ä¸­ $nums[i]$ æ˜¯èŠ‚ç‚¹ `i` çš„åŸºå› å€¼ï¼Œä¸”åŸºå› å€¼ äº’ä¸ç›¸åŒ ã€‚

è¯·ä½ è¿”å›ä¸€ä¸ªæ•°ç»„ `ans`ï¼Œé•¿åº¦ä¸º `n`ï¼Œå…¶ä¸­ $ans[i]$ æ˜¯ä»¥èŠ‚ç‚¹ `i` ä¸ºæ ¹çš„å­æ ‘å†…ç¼ºå¤±çš„æœ€å°åŸºå› å€¼ã€‚

èŠ‚ç‚¹ `x` ä¸ºæ ¹çš„å­æ ‘åŒ…å«èŠ‚ç‚¹ `x` å’Œå®ƒæ‰€æœ‰çš„åä»£èŠ‚ç‚¹ã€‚

ç¤ºä¾‹ 1ï¼š
![](https://assets.leetcode.com/uploads/2021/08/23/case-1.png)

```
è¾“å…¥ï¼šparents = [-1,0,0,2], nums = [1,2,3,4]

è¾“å‡ºï¼š[5,1,1,1]

è§£é‡Šï¼šæ¯ä¸ªå­æ ‘ç­”æ¡ˆè®¡ç®—ç»“æœå¦‚ä¸‹ï¼š
- 0ï¼šå­æ ‘åŒ…å«èŠ‚ç‚¹ [0,1,2,3] ï¼ŒåŸºå› å€¼åˆ†åˆ«ä¸º [1,2,3,4] ã€‚5 æ˜¯ç¼ºå¤±çš„æœ€å°åŸºå› å€¼ã€‚
- 1ï¼šå­æ ‘åªåŒ…å«èŠ‚ç‚¹ 1 ï¼ŒåŸºå› å€¼ä¸º 2 ã€‚1 æ˜¯ç¼ºå¤±çš„æœ€å°åŸºå› å€¼ã€‚
- 2ï¼šå­æ ‘åŒ…å«èŠ‚ç‚¹ [2,3] ï¼ŒåŸºå› å€¼åˆ†åˆ«ä¸º [3,4] ã€‚1 æ˜¯ç¼ºå¤±çš„æœ€å°åŸºå› å€¼ã€‚
- 3ï¼šå­æ ‘åªåŒ…å«èŠ‚ç‚¹ 3 ï¼ŒåŸºå› å€¼ä¸º 4 ã€‚1æ˜¯ç¼ºå¤±çš„æœ€å°åŸºå› å€¼ã€‚
```
ç¤ºä¾‹ 2ï¼š
![](https://assets.leetcode.com/uploads/2021/08/23/case-2.png)
```
è¾“å…¥ï¼šparents = [-1,0,1,0,3,3], nums = [5,4,6,2,1,3]

è¾“å‡ºï¼š[7,1,1,4,2,1]

è§£é‡Šï¼šæ¯ä¸ªå­æ ‘ç­”æ¡ˆè®¡ç®—ç»“æœå¦‚ä¸‹ï¼š
- 0ï¼šå­æ ‘å†…åŒ…å«èŠ‚ç‚¹ [0,1,2,3,4,5] ï¼ŒåŸºå› å€¼åˆ†åˆ«ä¸º [5,4,6,2,1,3] ã€‚7 æ˜¯ç¼ºå¤±çš„æœ€å°åŸºå› å€¼ã€‚
- 1ï¼šå­æ ‘å†…åŒ…å«èŠ‚ç‚¹ [1,2] ï¼ŒåŸºå› å€¼åˆ†åˆ«ä¸º [4,6] ã€‚ 1 æ˜¯ç¼ºå¤±çš„æœ€å°åŸºå› å€¼ã€‚
- 2ï¼šå­æ ‘å†…åªåŒ…å«èŠ‚ç‚¹ 2 ï¼ŒåŸºå› å€¼ä¸º 6 ã€‚1 æ˜¯ç¼ºå¤±çš„æœ€å°åŸºå› å€¼ã€‚
- 3ï¼šå­æ ‘å†…åŒ…å«èŠ‚ç‚¹ [3,4,5] ï¼ŒåŸºå› å€¼åˆ†åˆ«ä¸º [2,1,3] ã€‚4 æ˜¯ç¼ºå¤±çš„æœ€å°åŸºå› å€¼ã€‚
- 4ï¼šå­æ ‘å†…åªåŒ…å«èŠ‚ç‚¹ 4 ï¼ŒåŸºå› å€¼ä¸º 1 ã€‚2 æ˜¯ç¼ºå¤±çš„æœ€å°åŸºå› å€¼ã€‚
- 5ï¼šå­æ ‘å†…åªåŒ…å«èŠ‚ç‚¹ 5 ï¼ŒåŸºå› å€¼ä¸º 3 ã€‚1 æ˜¯ç¼ºå¤±çš„æœ€å°åŸºå› å€¼ã€‚
```
ç¤ºä¾‹ 3ï¼š
```
è¾“å…¥ï¼šparents = [-1,2,3,0,2,4,1], nums = [2,3,4,5,6,7,8]

è¾“å‡ºï¼š[1,1,1,1,1,1,1]

è§£é‡Šï¼šæ‰€æœ‰å­æ ‘éƒ½ç¼ºå¤±åŸºå› å€¼ 1 ã€‚
```

æç¤ºï¼š
* $n = parents.length = nums.length$
* $2 <= n <= 10^5$
* å¯¹äº `i != 0`ï¼Œæ»¡è¶³ $0 <= parents[i] <= n - 1$
* $parents[0] = -1$
* `parents` è¡¨ç¤ºä¸€æ£µåˆæ³•çš„æ ‘ã€‚
* $1 <= nums[i] <= 10^5$
* `nums[i]` äº’ä¸ç›¸åŒã€‚

---

### DFS

#### ç ´é¢˜

å…ˆç”¨å‡ å¥è¯ç ´é¢˜ã€‚

å…±ç”± $n$ ä¸ªèŠ‚ç‚¹ç»„æˆä¸€æ£µæ ‘ï¼ˆèŠ‚ç‚¹ç¼–å·ä» $0$ åˆ° $n - 1$ï¼‰ï¼Œ`parents` æè¿°äº†è¯¥æ ‘çš„å½¢æ€ï¼ŒåŒæ—¶æ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸€ä¸ªåŸºå› å€¼ $nums[i]$ã€‚

é¢˜ç›®è¦æˆ‘ä»¬æ±‚ï¼š**ä»¥æ¯ä¸ªèŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘ä¸­ï¼Œæƒé‡é›†åˆåœ¨ $[1, n + 1]$ èŒƒå›´å†…ç¼ºå¤±çš„æœ€å°æ•°**ã€‚

> éœ€è¦é‡ç‚¹æ³¨æ„ï¼šæ˜¯æƒé‡é›†åˆåœ¨ $[1, n + 1]$ èŒƒå›´å†…ç¼ºå¤±çš„æœ€å°æ•°ï¼Œè€Œä¸æ˜¯åœ¨ `nums` ä¸­ç¼ºå¤±çš„æœ€å°æ•°ã€‚

ä¸¾ä¸ª ğŸŒ°ï¼Œå‡è®¾ç”± $4$ ä¸ªèŠ‚ç‚¹ç»„æˆæ ‘ï¼ŒåŸºå› å€¼ `nums = [2,3,4,5]`ï¼Œé‚£ä¹ˆå¯¹åº”çš„ `ans = [1,1,1,1]`ã€‚

å†æ¬¡å¼ºè°ƒï¼šæˆ‘ä»¬æ±‚çš„æ˜¯æ¯ä¸ªèŠ‚ç‚¹ä¸ºæ ¹çš„å­æ ‘ä¸­ï¼Œæƒé‡é›†åˆåœ¨ $[1, n + 1]$ èŒƒå›´å†…çš„æœ€å°ç¼ºå¤±å€¼ï¼Œè€Œéåœ¨ `nums` ä¸­çš„ç¼ºå¤±å€¼ã€‚

![image.png](https://pic.leetcode.cn/1698712419-FAerJq-image.png)

#### ç»“è®ºä¸€ï¼šå½“`nums` ä¸­æ²¡æœ‰ $1$ï¼Œæ‰€æœ‰èŠ‚ç‚¹ç­”æ¡ˆä¸º $1$

ç”±äºæˆ‘ä»¬æ˜¯æ±‚ $[1, n + 1]$ èŒƒå›´å†…çš„æœ€å°ç¼ºå¤±å€¼ï¼Œå½“ `nums` ä¸­ä¸å­˜åœ¨ $1$ æ—¶ï¼Œæ‰€æœ‰èŠ‚ç‚¹ç¼ºå¤±çš„æœ€å°å€¼ä¸º $1$ã€‚

![image.png](https://pic.leetcode.cn/1698712436-xpbMiU-image.png)

#### ç»“è®ºäºŒï¼š`nums` æœ‰ $1$ï¼Œæ‰€æœ‰è¯¥èŠ‚ç‚¹çš„â€œéç¥–å…ˆâ€èŠ‚ç‚¹ï¼Œç­”æ¡ˆä¸º $1$

åŸºå› å€¼äº’ä¸ç›¸åŒï¼ŒåŒæ—¶ç»Ÿè®¡çš„æ˜¯ï¼Œä»¥æ¯ä¸ªèŠ‚ç‚¹ä¸ºâ€œæ ¹â€æ—¶ï¼Œå­æ ‘çš„æƒå€¼æƒ…å†µï¼Œå› æ­¤èŠ‚ç‚¹ $1$ åªä¼šå¯¹å…¶â€œç¥–å…ˆâ€äº§ç”Ÿå½±å“ã€‚

![image.png](https://pic.leetcode.cn/1698712449-WJDZBv-image.png)

#### ç»“è®ºä¸‰ï¼šä»ã€Œ$1$ èŠ‚ç‚¹ã€åˆ°ã€Œæ ¹èŠ‚ç‚¹ã€çš„è·¯å¾„ä¸­ï¼Œç­”æ¡ˆå¿…ç„¶æ»¡è¶³â€œéé€’å‡â€æ€§è´¨

è¿™ä¸ªç»“è®ºä¸æ˜æ˜¾ï¼Œä½†ä¸éš¾ç†è§£ã€‚

å…ˆå‡è®¾å­˜åœ¨æŸä¸ªèŠ‚ç‚¹ `X`ï¼Œå…¶æœ€å°ç¼ºå¤±å€¼ä¸º $k$ï¼š

![image.png](https://pic.leetcode.cn/1698712465-jeBMZQ-image.png)

å†é€šè¿‡èŠ‚ç‚¹ `X` çš„æœ€å°ç¼ºå¤±å€¼ï¼Œæ¨ç†å‡ºçˆ¶èŠ‚ç‚¹ `Fa` çš„æƒ…å†µï¼š

![image.png](https://pic.leetcode.cn/1698712478-NJulbT-image.png)

ç»¼ä¸Šï¼Œæˆ‘ä»¬åªéœ€è¦è€ƒè™‘ã€ŒèŠ‚ç‚¹ $1$ã€åˆ°ã€Œæ ¹èŠ‚ç‚¹ã€è¿™ä¸€èŠ‚ç‚¹ç­”æ¡ˆå³å¯ã€‚

å¹¶ä¸”ç”±äºä»ä¸‹å¾€ä¸Šï¼Œç­”æ¡ˆéé€’å‡ï¼Œæˆ‘ä»¬é‡‡å–ã€Œå…ˆç®—å­èŠ‚ç‚¹ï¼Œå†ç®—çˆ¶èŠ‚ç‚¹ã€çš„æ–¹å¼ã€‚

å…·ä½“çš„ï¼Œç”¨å˜é‡ `cur` ä»£æŒ‡å½“å‰èŠ‚ç‚¹ï¼Œä½¿ç”¨ `ne` ä»£æŒ‡å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼Œ`vis` æ•°ç»„è®°å½•åœ¨å­æ ‘ä¸­å‡ºç°è¿‡çš„åŸºå› å€¼ï¼Œ`val` ä»£è¡¨å½“å‰çš„èŠ‚ç‚¹çš„æœ€å°ç¼ºå¤±å€¼ã€‚

![image.png](https://pic.leetcode.cn/1698713932-dOhNnj-image.png)

![image.png](https://pic.leetcode.cn/1698714024-DXkyqd-image.png)

![image.png](https://pic.leetcode.cn/1698714082-JlLNrj-image.png)

ä¸€äº›ç»†èŠ‚ï¼šç”±äºé¢˜ç›®åªè¯´äº† $1 \leq nums[i] \leq 1e5$ï¼Œæ²¡è¯´ $nums[i]$ ä¸ $n$ çš„å…³ç³»ï¼Œå› æ­¤æˆ‘ä»¬å¼€è¾Ÿ `vis` æ•°ç»„æ—¶éœ€è¦å¼€åˆ° $100010$ï¼Œæˆ–æ˜¯å¹²è„†ä½¿ç”¨ `Set` å……å½“ `vis`ã€‚

Java ä»£ç ï¼š

```Java
class Solution {
    // è€ƒè™‘åˆ°æœ‰ä¸æ‡‚ã€Œé“¾å¼å‰å‘æ˜Ÿã€çš„åŒå­¦, è¿™é‡Œä½¿ç”¨æœ€ç®€å•çš„å­˜å›¾æ–¹å¼ {1: [2, 3]} ä»£è¡¨èŠ‚ç‚¹ä¸€æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ 2 å’Œ 3
    Map<Integer, List<Integer>> g = new HashMap<>();
    public int[] smallestMissingValueSubtree(int[] parents, int[] nums) {
        int n = nums.length, cur = -1;
        int[] ans = new int[n];
        Arrays.fill(ans, 1);
        // æ‰¾èŠ‚ç‚¹ 1, å»ºå›¾
        for (int i = 0; i < n; i++) {
            if (nums[i] == 1) cur = i;
            List<Integer> list = g.getOrDefault(parents[i], new ArrayList<>());
            list.add(i);
            g.put(parents[i], list);
        }

        // è‹¥ nums ä¸­æ²¡ 1, å¯¹åº”ç»“è®ºä¸€
        if (cur == -1) return ans;

        boolean[] vis = new boolean[100010];
        // ä»èŠ‚ç‚¹ 1 å¼€å§‹å¾€æ ¹æ‰¾ï¼ˆä»æ·±åˆ°æµ…ï¼‰, idx ä»£è¡¨å½“å‰èŠ‚ç‚¹, ne ä»£è¡¨ cur åœ¨è¯¥é“¾è·¯ä¸‹çš„å­èŠ‚ç‚¹
        int ne = cur, val = 1;
        while (cur != -1) {
            // æ¯æ¬¡å¯¹å½“å‰èŠ‚ç‚¹æ‰€åœ¨å­æ ‘çš„è¿›è¡Œæ ‡è®°
            dfs(cur, ne, nums, vis);
            // åœ¨ [val, n+1] èŒƒå›´å†…æ‰¾ç¬¬ä¸€ä¸ªæœªè¢«æ ‡è®°åŸºå› å€¼
            for (int i = val; i <= n + 1; i++) {
                if (vis[i]) continue;
                ans[cur] = val = i;
                break;
            }
            ne = cur; cur = parents[cur]; // æŒ‡é’ˆä¸Šç§»
        }
        return ans;
    }
    void dfs(int idx, int block, int[] nums, boolean[] vis) {
        vis[nums[idx]] = true;
        List<Integer> list = g.getOrDefault(idx, new ArrayList<>());
        for (int x : list) {
            if (x == block) continue;
            dfs(x, block, nums, vis);
        }
    }
}
```
C++ ä»£ç ï¼š
```C++
class Solution {
public:
    // è€ƒè™‘åˆ°æœ‰ä¸æ‡‚ã€Œé“¾å¼å‰å‘æ˜Ÿã€çš„åŒå­¦, è¿™é‡Œä½¿ç”¨æœ€ç®€å•çš„å­˜å›¾æ–¹å¼ {1: [2, 3]} ä»£è¡¨èŠ‚ç‚¹ä¸€æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ 2 å’Œ 3
    unordered_map<int, vector<int>> g;
    vector<int> smallestMissingValueSubtree(std::vector<int>& parents, std::vector<int>& nums) {
        int n = nums.size(), cur = -1;
        vector<int> ans(n, 1);
        // æ‰¾èŠ‚ç‚¹ 1, å»ºå›¾
        for (int i = 0; i < n; i++) {
            if (nums[i] == 1) cur = i;
            g[parents[i]].push_back(i);
        }
        
        // è‹¥ nums ä¸­æ²¡ 1, å¯¹åº”ç»“è®ºä¸€
        if (cur == -1) return ans;
        
        unordered_set<int> vis;
        // ä»èŠ‚ç‚¹ 1 å¼€å§‹å¾€æ ¹æ‰¾ï¼ˆä»æ·±åˆ°æµ…ï¼‰, idx ä»£è¡¨å½“å‰èŠ‚ç‚¹, ne ä»£è¡¨ cur åœ¨è¯¥é“¾è·¯ä¸‹çš„å­èŠ‚ç‚¹
        int ne = cur, val = 1;
        while (cur != -1) {
            // æ¯æ¬¡å¯¹å½“å‰èŠ‚ç‚¹æ‰€åœ¨å­æ ‘çš„è¿›è¡Œæ ‡è®°
            dfs(cur, ne, nums, vis);
            // åœ¨ [val, n+1] èŒƒå›´å†…æ‰¾ç¬¬ä¸€ä¸ªæœªè¢«æ ‡è®°åŸºå› å€¼
            for (int i = val; i <= n + 1; i++) {
                if (vis.count(i)) continue;
                ans[cur] = val = i;
                break;
            }
            ne = cur; cur = parents[cur]; // æŒ‡é’ˆä¸Šç§»
        }
        return ans;
    }
    void dfs(int idx, int block, vector<int>& nums, unordered_set<int>& vis) {
        vis.insert(nums[idx]);
        for (int x : g[idx]) {
            if (x == block) continue;
            dfs(x, block, nums, vis);
        }
    }
};
```
Python ä»£ç ï¼š
```Python
class Solution:
    def smallestMissingValueSubtree(self, parents: List[int], nums: List[int]) -> List[int]:
        # è™‘åˆ°æœ‰ä¸æ‡‚ã€Œé“¾å¼å‰å‘æ˜Ÿã€çš„åŒå­¦, è¿™é‡Œä½¿ç”¨æœ€ç®€å•çš„å­˜å›¾æ–¹å¼ {1: [2, 3]} ä»£è¡¨èŠ‚ç‚¹ 1 æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ 2 å’Œ 3
        g = defaultdict(list)

        def dfs(idx, block):
            nonlocal val
            vis.add(nums[idx])
            for x in g[idx]:
                if x == block:
                    continue
                dfs(x, block)
        
        n, cur = len(nums), -1
        ans = [1] * n
        # æ‰¾èŠ‚ç‚¹ 1, å»ºå›¾
        for i in range(n):
            if nums[i] == 1:
                cur = i
            g[parents[i]].append(i)
        
        # è‹¥ nums ä¸­æ²¡ 1, å¯¹åº”ç»“è®ºä¸€
        if cur == -1:
            return ans
        
        vis = set()
        # ä»èŠ‚ç‚¹ 1 å¼€å§‹å¾€æ ¹æ‰¾ï¼ˆä»æ·±åˆ°æµ…ï¼‰, idx ä»£è¡¨å½“å‰èŠ‚ç‚¹, ne ä»£è¡¨ cur åœ¨è¯¥é“¾è·¯ä¸‹çš„å­èŠ‚ç‚¹
        ne, val = cur, 1
        while cur != -1:
            # æ¯æ¬¡å¯¹å½“å‰èŠ‚ç‚¹æ‰€åœ¨å­æ ‘çš„è¿›è¡Œæ ‡è®°
            dfs(cur, ne)
            # åœ¨ [val, n+1] èŒƒå›´å†…æ‰¾ç¬¬ä¸€ä¸ªæœªè¢«æ ‡è®°åŸºå› å€¼
            for i in range(val, n + 2):
                if i in vis:
                    continue
                ans[cur] = val = i
                break
            ne, cur = cur, parents[cur]  # æŒ‡é’ˆä¸Šç§»

        return ans
```
TypeScript ä»£ç ï¼š
```TypeScript
function smallestMissingValueSubtree(parents: number[], nums: number[]): number[] {
    // è€ƒè™‘åˆ°æœ‰ä¸æ‡‚ã€Œé“¾å¼å‰å‘æ˜Ÿã€çš„åŒå­¦, è¿™é‡Œä½¿ç”¨æœ€ç®€å•çš„å­˜å›¾æ–¹å¼ {1: [2, 3]} ä»£è¡¨èŠ‚ç‚¹ 1 æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ 2 å’Œ 3
    const g = {};

    const dfs = function (g: { [key: number]: number[] }, idx: number, block: number, nums: number[], vis: Set<number>): void {
        vis.add(nums[idx]);
        if (Array.isArray(g[idx])) {
            for (let x of g[idx]) {
                if (x == block) continue;
                dfs(g, x, block, nums, vis);
            }
        }
    }

    let n = nums.length, cur = -1;
    const ans = new Array(n).fill(1);
    
    // æ‰¾èŠ‚ç‚¹ 1, å»ºå›¾
    for (let i = 0; i < n; i++) {
        if (nums[i] === 1) cur = i;
        if (!g[parents[i]]) g[parents[i]] = [];
        g[parents[i]].push(i);
    }
    
    // è‹¥ nums ä¸­æ²¡ 1, å¯¹åº”ç»“è®ºä¸€
    if (cur == -1) return ans;
    
    const vis = new Set<number>();
    // ä»èŠ‚ç‚¹ 1 å¼€å§‹å¾€æ ¹æ‰¾ï¼ˆä»æ·±åˆ°æµ…ï¼‰, idx ä»£è¡¨å½“å‰èŠ‚ç‚¹, ne ä»£è¡¨ cur åœ¨è¯¥é“¾è·¯ä¸‹çš„å­èŠ‚ç‚¹
    let ne = cur, val = 1;    
    while (cur !== -1) {
        // æ¯æ¬¡å¯¹å½“å‰èŠ‚ç‚¹æ‰€åœ¨å­æ ‘çš„è¿›è¡Œæ ‡è®°
        dfs(g, cur, ne, nums, vis);
        // åœ¨ [val, n+1] èŒƒå›´å†…æ‰¾ç¬¬ä¸€ä¸ªæœªè¢«æ ‡è®°åŸºå› å€¼
        for (let i = val; i <= n + 1; i++) {
            if (vis.has(i)) continue;
            ans[cur] = val = i;
            break;
        }
        ne = cur; cur = parents[cur];  // æŒ‡é’ˆä¸Šç§»
    }
    
    return ans;
}
```
Java ä»£ç ï¼ˆé“¾å¼å‘å‰æ˜Ÿï¼Œä½¿ç”¨ `Set` å……å½“ `vis`ï¼‰ï¼š
```Java
class Solution {
    int N = 100010, M = N, idx = 1;
    int[] he = new int[N], e = new int[M], ne = new int[M];
    void add(int a, int b) {
        e[idx] = b;
        ne[idx] = he[a];
        he[a] = idx++;
    }
    public int[] smallestMissingValueSubtree(int[] parents, int[] nums) {
        Arrays.fill(he, -1);
        int n = parents.length, cur = -1, val = 1;
        int[] ans = new int[n];
        Arrays.fill(ans, 1);
        for (int i = 0; i < n; i++) {
            if (i >= 1) add(parents[i], i);
            if (nums[i] == 1) cur = i;
        }
        if (cur == -1) return ans;
        Set<Integer> vis = new HashSet();
        while (cur != -1) {
            dfs(cur, vis, nums);
            for (int i = val; i <= n + 1; i++) {
                if (vis.contains(i)) continue;
                ans[cur] = val = i;
                break;
            }
            cur = parents[cur];
        }
        return ans;
    }
    void dfs(int u, Set<Integer> vis, int[] nums) {
        vis.add(nums[u]);
        for (int i = he[u]; i != -1; i = ne[i]) {
            int j = e[i];
            if (vis.contains(nums[j])) continue;
            dfs(j, vis, nums);
        }
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šæ‰¾ $1$ å’Œå»ºå›¾çš„å¤æ‚åº¦ä¸º $O(n)$ï¼›æ„é€ ä»æ ¹èŠ‚ç‚¹åˆ° $1$èŠ‚ç‚¹çš„é“¾æ¡ç­”æ¡ˆæ—¶ï¼Œä¼šå¯¹å­æ ‘èŠ‚ç‚¹è¿›è¡Œæ ‡è®°ï¼ŒåŒæ—¶æ¯ä¸ªèŠ‚ç‚¹çš„ç­”æ¡ˆä¼šä» $[val, n + 1]$ èŒƒå›´å†…æ‰¾ç¼ºå¤±å€¼ï¼Œå¤æ‚åº¦ä¸º $O(n)$ã€‚ æ•´ä½“å¤æ‚åº¦ä¸º $O(n)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

---

### æœ€å

è¿™æ˜¯æˆ‘ä»¬ã€Œåˆ·ç©¿ LeetCodeã€ç³»åˆ—æ–‡ç« çš„ç¬¬ `No.2003` ç¯‡ï¼Œç³»åˆ—å¼€å§‹äº 2021/01/01ï¼Œæˆªæ­¢äºèµ·å§‹æ—¥ LeetCode ä¸Šå…±æœ‰ 1916 é“é¢˜ç›®ï¼Œéƒ¨åˆ†æ˜¯æœ‰é”é¢˜ï¼Œæˆ‘ä»¬å°†å…ˆæŠŠæ‰€æœ‰ä¸å¸¦é”çš„é¢˜ç›®åˆ·å®Œã€‚

åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« é‡Œé¢ï¼Œé™¤äº†è®²è§£è§£é¢˜æ€è·¯ä»¥å¤–ï¼Œè¿˜ä¼šå°½å¯èƒ½ç»™å‡ºæœ€ä¸ºç®€æ´çš„ä»£ç ã€‚å¦‚æœæ¶‰åŠé€šè§£è¿˜ä¼šç›¸åº”çš„ä»£ç æ¨¡æ¿ã€‚

ä¸ºäº†æ–¹ä¾¿å„ä½åŒå­¦èƒ½å¤Ÿç”µè„‘ä¸Šè¿›è¡Œè°ƒè¯•å’Œæäº¤ä»£ç ï¼Œæˆ‘å»ºç«‹äº†ç›¸å…³çš„ä»“åº“ï¼šhttps://github.com/SharingSource/LogicStack-LeetCode ã€‚

åœ¨ä»“åº“åœ°å€é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°ç³»åˆ—æ–‡ç« çš„é¢˜è§£é“¾æ¥ã€ç³»åˆ—æ–‡ç« çš„ç›¸åº”ä»£ç ã€LeetCode åŸé¢˜é“¾æ¥å’Œå…¶ä»–ä¼˜é€‰é¢˜è§£ã€‚

