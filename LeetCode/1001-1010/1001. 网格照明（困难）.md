### é¢˜ç›®æè¿°

è¿™æ˜¯ LeetCode ä¸Šçš„ **[1001. ç½‘æ ¼ç…§æ˜](https://leetcode-cn.com/problems/grid-illumination/solution/gong-shui-san-xie-ha-xi-biao-xian-ying-s-s48d/)** ï¼Œéš¾åº¦ä¸º **å›°éš¾**ã€‚

Tag : ã€Œæ¨¡æ‹Ÿã€ã€ã€Œå“ˆå¸Œè¡¨ã€



åœ¨å¤§å°ä¸º `n x n` çš„ç½‘æ ¼ `grid` ä¸Šï¼Œæ¯ä¸ªå•å…ƒæ ¼éƒ½æœ‰ä¸€ç›ç¯ï¼Œæœ€åˆç¯éƒ½å¤„äº å…³é—­ çŠ¶æ€ã€‚

ç»™ä½ ä¸€ä¸ªç”±ç¯çš„ä½ç½®ç»„æˆçš„äºŒç»´æ•°ç»„Â `lamps`ï¼Œå…¶ä¸­ $lamps[i] = [row_i, col_i]$ è¡¨ç¤º æ‰“å¼€ ä½äº `grid[rowi][coli]` çš„ç¯ã€‚å³ä¾¿åŒä¸€ç›ç¯å¯èƒ½åœ¨ `lamps` ä¸­å¤šæ¬¡åˆ—å‡ºï¼Œä¸ä¼šå½±å“è¿™ç›ç¯å¤„äº æ‰“å¼€ çŠ¶æ€ã€‚

å½“ä¸€ç›ç¯å¤„äºæ‰“å¼€çŠ¶æ€ï¼Œå®ƒå°†ä¼šç…§äº® è‡ªèº«æ‰€åœ¨å•å…ƒæ ¼ ä»¥åŠåŒä¸€ è¡Œ ã€åŒä¸€ åˆ— å’Œä¸¤æ¡ å¯¹è§’çº¿ ä¸Šçš„ æ‰€æœ‰å…¶ä»–å•å…ƒæ ¼ ã€‚

å¦ç»™ä½ ä¸€ä¸ªäºŒç»´æ•°ç»„ `queries`ï¼Œå…¶ä¸­ $queries[j] = [row_j, col_j]$ ã€‚å¯¹äºç¬¬ $j$ ä¸ªæŸ¥è¯¢ï¼Œå¦‚æœå•å…ƒæ ¼ $[row_j, col_j]$ æ˜¯è¢«ç…§äº®çš„ï¼Œåˆ™æŸ¥è¯¢ç»“æœä¸º $1$ ï¼Œå¦åˆ™ä¸º $0$ ã€‚

åœ¨ç¬¬ `j` æ¬¡æŸ¥è¯¢ä¹‹å [æŒ‰ç…§æŸ¥è¯¢çš„é¡ºåº] ï¼Œå…³é—­ ä½äºå•å…ƒæ ¼ $grid[row_j][col_j]$ ä¸ŠåŠç›¸é‚» $8$ ä¸ªæ–¹å‘ä¸Šï¼ˆä¸å•å…ƒæ ¼ $grid[row_i][col_i]$ å…±äº«è§’æˆ–è¾¹ï¼‰çš„ä»»ä½•ç¯ã€‚

è¿”å›ä¸€ä¸ªæ•´æ•°æ•°ç»„ `ans` ä½œä¸ºç­”æ¡ˆï¼Œ `ans[j]` åº”ç­‰äºç¬¬ `j` æ¬¡æŸ¥è¯¢Â `queries[j]`Â çš„ç»“æœï¼Œ$1$ è¡¨ç¤ºç…§äº®ï¼Œ$0$ è¡¨ç¤ºæœªç…§äº®ã€‚

ç¤ºä¾‹ 1ï¼š
![](https://assets.leetcode.com/uploads/2020/08/19/illu_1.jpg)
```
è¾“å…¥ï¼šn = 5, lamps = [[0,0],[4,4]], queries = [[1,1],[1,0]]

è¾“å‡ºï¼š[1,0]
```
![](https://assets.leetcode.com/uploads/2020/08/19/illu_step1.jpg)
```
è§£é‡Šï¼šæœ€åˆæ‰€æœ‰ç¯éƒ½æ˜¯å…³é—­çš„ã€‚åœ¨æ‰§è¡ŒæŸ¥è¯¢ä¹‹å‰ï¼Œæ‰“å¼€ä½äº [0, 0] å’Œ [4, 4] çš„ç¯ã€‚ç¬¬ 0Â æ¬¡æŸ¥è¯¢æ£€æŸ¥ grid[1][1] æ˜¯å¦è¢«ç…§äº®ï¼ˆè“è‰²æ–¹æ¡†ï¼‰ã€‚è¯¥å•å…ƒæ ¼è¢«ç…§äº®ï¼Œæ‰€ä»¥ ans[0] = 1 ã€‚ç„¶åï¼Œå…³é—­çº¢è‰²æ–¹æ¡†ä¸­çš„æ‰€æœ‰ç¯ã€‚
```
![](https://assets.leetcode.com/uploads/2020/08/19/illu_step2.jpg)
```
ç¬¬ 1Â æ¬¡æŸ¥è¯¢æ£€æŸ¥ grid[1][0] æ˜¯å¦è¢«ç…§äº®ï¼ˆè“è‰²æ–¹æ¡†ï¼‰ã€‚è¯¥å•å…ƒæ ¼æ²¡æœ‰è¢«ç…§äº®ï¼Œæ‰€ä»¥ ans[1] = 0 ã€‚ç„¶åï¼Œå…³é—­çº¢è‰²çŸ©å½¢ä¸­çš„æ‰€æœ‰ç¯ã€‚
```
ç¤ºä¾‹ 2ï¼š
```
è¾“å…¥ï¼šn = 5, lamps = [[0,0],[4,4]], queries = [[1,1],[1,1]]

è¾“å‡ºï¼š[1,1]
```
ç¤ºä¾‹ 3ï¼š
```
è¾“å…¥ï¼šn = 5, lamps = [[0,0],[0,4]], queries = [[0,4],[0,1],[1,4]]

è¾“å‡ºï¼š[1,1,0]
```

æç¤ºï¼š
* $1 <= n <= 10^9$
* $0 <= lamps.length <= 20000$
* $0 <= queries.length <= 20000$
* $lamps[i].length == 2$
* $0 <= row_i, col_i < n$
* $queries[j].length == 2$
* $0 <= row_j, col_j < n$

---

### å“ˆå¸Œè¡¨ + çº¿æ˜ å°„

æ£‹ç›˜å¤§å°çš„æ•°æ®èŒƒå›´ä¸º $n = 10^9$ï¼Œç¡¬æ¨¡æ‹Ÿã€Œäº®ç¯ã€çš„æ“ä½œå¿…ç„¶ä¼š `TLE`ï¼Œè€Œ `lamps` å’Œ `queries` æ•°æ®èŒƒå›´ä¸º $20000$ æ˜¯ä¸€ä¸ªè¾ƒä¸ºå¸¸è§çš„çªç ´å£ã€‚

ç”±äºç‚¹äº®æ¯ä¸€ç›ç¯ï¼Œå¯ä»¥ä½¿å¾—å½“å‰ **è¡Œã€åˆ— å’Œ å¯¹è§’çº¿** çš„ä½ç½®è¢«ç…§äº®ï¼Œè¡Œåˆ—å¯ç›´æ¥ä½¿ç”¨æ£‹ç›˜åæ ‡çš„ $(x, y)$ æ¥ä»£æŒ‡ï¼Œè€Œå¯¹è§’çº¿åˆ™å¯ä»¥ä½¿ç”¨ã€Œæˆªè·ã€æ¥è¿›è¡Œä»£æŒ‡ï¼Œå³ä½¿ç”¨ $x + y$ å’Œ $x - y$ è¿›è¡Œä»£æŒ‡ã€‚

åˆ†åˆ«ä½¿ç”¨å››ä¸ªã€Œå“ˆå¸Œè¡¨ã€`row`ã€`col`ã€`left` å’Œ `right` æ¥è®°å½• **è¡Œã€åˆ— å’Œ å¯¹è§’çº¿** çš„ç‚¹äº®æƒ…å†µï¼ˆ`key` ä¸ºçº¿ç¼–å·ï¼Œ`value` ä¸ºç‚¹äº®æ¬¡æ•°ï¼‰ã€‚

è¿™æ ·æˆ‘ä»¬å¯ä»¥åœ¨ $O(1)$ çš„å¤æ‚åº¦å¤„ç†æ‰æ‰€æœ‰çš„ $lamps[i]$ï¼ŒæŸä¸ªä½ç½®è¢«ç…§äº®çš„å……è¦æ¡ä»¶ä¸ºï¼š**ã€Œå½“å‰ä½ç½®æ‰€åœ¨è¡Œè¢«ç‚¹äº®ã€æˆ–ã€Œå½“å‰ä½ç½®æ‰€åœ¨åˆ—è¢«ç‚¹äº®ã€æˆ–ã€Œå½“å‰ä½ç½®æ‰€å¤„çš„å¯¹è§’çº¿è¢«ç‚¹äº®ã€ã€‚**

åŒæ—¶ï¼Œç”±äºæ¯æ¬¡æŸ¥è¯¢åè¦è¿›è¡Œã€Œç­ç¯ã€æ“ä½œï¼ˆæ³¨æ„ï¼šç­ç¯åªèƒ½ç­æœ‰ç¯çš„ä½ç½®ï¼Œè€Œä¸æ˜¯ç­æœ‰å…‰çš„ä½ç½® ğŸ¤£ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦å¦å¤–è®°å½•æ¯ä¸ªç¯çš„ä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨åˆ©ç”¨ã€ŒäºŒç»´è½¬ä¸€ç»´ã€çš„æŠ€å·§è¿›è¡Œç¼–å·ï¼š$idx = x * n + y$ï¼Œå¹¶ä½¿ç”¨ `HashSet` è¿›è¡Œè®°å½•ï¼ˆå¿½ç•¥é‡å¤çš„ $lamps[i]$ï¼‰ã€‚

ç”±äºè¯¢é—®æ¬¡æ•°æœ€å¤šä¸º $20000$ï¼Œå› æ­¤ç›´æ¥åœ¨æŸ¥è¯¢å®Œæˆåæ¨¡æ‹Ÿã€Œç­ç¯ã€å³å¯ï¼ˆè®¿é—®è‡ªèº«åŠç›¸é‚»æ ¼å­ï¼Œå…± $9$ ä¸ªï¼‰ï¼Œè®¡ç®—é‡ä¸º $2 * 10^5$ ä»¥å†…ï¼Œå¯ä»¥æ¥å—ã€‚è‹¥æŸä¸ªä½ç½®å­˜åœ¨ç¯ï¼Œå°†å…¶ä» `HashSet` ä¸­ç§»é™¤ï¼Œå¹¶æ›´æ–°å¯¹åº”çº¿çš„ç‚¹äº®æƒ…å†µã€‚

ä»£ç ï¼š
```Java
class Solution {
    int[][] dirs = new int[][]{{0,0},{0,-1},{0,1},{-1,0},{-1,-1},{-1,1},{1,0},{1,-1},{1,1}};
    public int[] gridIllumination(int n, int[][] lamps, int[][] queries) {
        long N = n;
        Map<Integer, Integer> row = new HashMap<>(), col = new HashMap<>();
        Map<Integer, Integer> left = new HashMap<>(), right = new HashMap<>();
        Set<Long> set = new HashSet<>();
        for (int[] l : lamps) {
            int x = l[0], y = l[1];
            int a = x + y, b = x - y;
            if (set.contains(x * N + y)) continue;
            increment(row, x); increment(col, y);
            increment(left, a); increment(right, b);
            set.add(x * N + y);
        }
        int m = queries.length;
        int[] ans = new int[m];
        for (int i = 0; i < m; i++) {
            int[] q = queries[i];
            int x = q[0], y = q[1];
            int a = x + y, b = x - y;
            if (row.containsKey(x) || col.containsKey(y) || left.containsKey(a) || right.containsKey(b)) ans[i] = 1;

            for (int[] d : dirs) {
                int nx = x + d[0], ny = y + d[1];
                int na = nx + ny, nb = nx - ny;
                if (nx < 0 || nx >= n || ny < 0 || ny >= n) continue;
                if (set.contains(nx * N + ny)) {
                    set.remove(nx * N + ny);
                    decrement(row, nx); decrement(col, ny);
                    decrement(left, na); decrement(right, nb);
                }
            }
        }
        return ans;
    }
    void increment(Map<Integer, Integer> map, int key) {
        map.put(key, map.getOrDefault(key, 0) + 1);
    }
    void decrement(Map<Integer, Integer> map, int key) {
        if (map.get(key) == 1) map.remove(key);
        else map.put(key, map.get(key) - 1);
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šä»¤ $lamps$ é•¿åº¦ä¸º $a$ï¼Œ$queries$ é•¿åº¦ä¸º $b$ï¼Œå¤„ç†æ‰€æœ‰çš„ $lamp[i]$ å¤æ‚åº¦ä¸º $O(a)$ï¼Œå¤„ç†æ‰€æœ‰çš„ $queries[j]$ å¤æ‚åº¦ä¸º $O(C * b)$ï¼Œå…¶ä¸­ $C$ ä¸ºæ¨¡æ‹Ÿç­ç¯æ—¶æ‰€è”é€šçš„æ ¼å­æ•°é‡ï¼Œå›ºå®šä¸º $9$ã€‚æ•´ä½“å¤æ‚åº¦ä¸º $O(a + C * b)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(a)$

---

### æœ€å

è¿™æ˜¯æˆ‘ä»¬ã€Œåˆ·ç©¿ LeetCodeã€ç³»åˆ—æ–‡ç« çš„ç¬¬ `No.1001` ç¯‡ï¼Œç³»åˆ—å¼€å§‹äº 2021/01/01ï¼Œæˆªæ­¢äºèµ·å§‹æ—¥ LeetCode ä¸Šå…±æœ‰ 1916 é“é¢˜ç›®ï¼Œéƒ¨åˆ†æ˜¯æœ‰é”é¢˜ï¼Œæˆ‘ä»¬å°†å…ˆæŠŠæ‰€æœ‰ä¸å¸¦é”çš„é¢˜ç›®åˆ·å®Œã€‚

åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« é‡Œé¢ï¼Œé™¤äº†è®²è§£è§£é¢˜æ€è·¯ä»¥å¤–ï¼Œè¿˜ä¼šå°½å¯èƒ½ç»™å‡ºæœ€ä¸ºç®€æ´çš„ä»£ç ã€‚å¦‚æœæ¶‰åŠé€šè§£è¿˜ä¼šç›¸åº”çš„ä»£ç æ¨¡æ¿ã€‚

ä¸ºäº†æ–¹ä¾¿å„ä½åŒå­¦èƒ½å¤Ÿç”µè„‘ä¸Šè¿›è¡Œè°ƒè¯•å’Œæäº¤ä»£ç ï¼Œæˆ‘å»ºç«‹äº†ç›¸å…³çš„ä»“åº“ï¼šhttps://github.com/SharingSource/LogicStack-LeetCode ã€‚

åœ¨ä»“åº“åœ°å€é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°ç³»åˆ—æ–‡ç« çš„é¢˜è§£é“¾æ¥ã€ç³»åˆ—æ–‡ç« çš„ç›¸åº”ä»£ç ã€LeetCode åŸé¢˜é“¾æ¥å’Œå…¶ä»–ä¼˜é€‰é¢˜è§£ã€‚

