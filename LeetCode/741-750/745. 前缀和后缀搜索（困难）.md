### é¢˜ç›®æè¿°

è¿™æ˜¯ LeetCode ä¸Šçš„ **[745. å‰ç¼€å’Œåç¼€æœç´¢](https://leetcode.cn/problems/prefix-and-suffix-search/solution/by-ac_oier-ayej/)** ï¼Œéš¾åº¦ä¸º **å›°éš¾**ã€‚

Tag : ã€Œå­—å…¸æ ‘ã€



è®¾è®¡ä¸€ä¸ªåŒ…å«ä¸€äº›å•è¯çš„ç‰¹æ®Šè¯å…¸ï¼Œå¹¶èƒ½å¤Ÿé€šè¿‡å‰ç¼€å’Œåç¼€æ¥æ£€ç´¢å•è¯ã€‚

å®ç° `WordFilter` ç±»ï¼š

* `WordFilter(string[] words)` ä½¿ç”¨è¯å…¸ä¸­çš„å•è¯ `words` åˆå§‹åŒ–å¯¹è±¡ã€‚
* `f(string pref, string suff)` è¿”å›è¯å…¸ä¸­å…·æœ‰å‰ç¼€Â `prefix`Â å’Œåç¼€ `suff`Â çš„å•è¯çš„ä¸‹æ ‡ã€‚å¦‚æœå­˜åœ¨ä¸æ­¢ä¸€ä¸ªæ»¡è¶³è¦æ±‚çš„ä¸‹æ ‡ï¼Œè¿”å›å…¶ä¸­ æœ€å¤§çš„ä¸‹æ ‡ ã€‚å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å•è¯ï¼Œè¿”å› $-1$ ã€‚

ç¤ºä¾‹ï¼š
```
è¾“å…¥
["WordFilter", "f"]
[[["apple"]], ["a", "e"]]

è¾“å‡º
[null, 0]

è§£é‡Š
WordFilter wordFilter = new WordFilter(["apple"]);
wordFilter.f("a", "e"); // è¿”å› 0 ï¼Œå› ä¸ºä¸‹æ ‡ä¸º 0 çš„å•è¯ï¼šå‰ç¼€ prefix = "a" ä¸” åç¼€ suff = "e" ã€‚
```
æç¤ºï¼š
* $1 <= words.length <= 10^4$
* $1 <= words[i].length <= 7$
* $1 <= pref.length, suff.length <= 7$
* `words[i]`ã€`pref` å’Œ `suff` ä»…ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ
* æœ€å¤šå¯¹å‡½æ•° `f` æ‰§è¡Œ $10^4$ æ¬¡è°ƒç”¨

---

### åŸºæœ¬åˆ†æ

ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä»¤ `words` ä¸º `ss`ï¼Œä»¤ `pref` å’Œ `suff` åˆ†åˆ«ä¸º `a` å’Œ `b`ã€‚

æœç´¢æŸä¸ªå‰ç¼€ï¼ˆåç¼€å¯çœ‹åšæ˜¯åæ–¹å‘çš„å‰ç¼€ï¼‰å®¹æ˜“æƒ³åˆ°å­—å…¸æ ‘ï¼Œä½†å•è¯é•¿åº¦æ•°æ®èŒƒå›´åªæœ‰ $7$ï¼Œååˆ†å…·æœ‰è¿·æƒ‘æ€§ï¼Œä½¿ç”¨æš´åŠ›åšæ³•æœ€åæƒ…å†µä¸‹ä¼šæ‰«ææ‰€æœ‰çš„ $ss[i]$ï¼Œä¸è€ƒè™‘ä»»ä½•çš„å‰ªææ“ä½œçš„è¯ï¼Œè®¡ç®—é‡ä¹Ÿæ‰ä¸º $2 \times \ 7 \times 1e4 = 1.4 \times 10^5$ï¼ŒæŒ‰é“ç†æ˜¯å®Œå…¨å¯ä»¥è¿‡çš„ã€‚

ä½†ä¸è¦å¿˜è®° LC æ˜¯ä¸€ä¸ªå…·æœ‰ã€Œè®¾å®šæ¯ä¸ªæ ·ä¾‹æ—¶é•¿ï¼ŒåŒæ—¶åˆæœ‰æ€»æ—¶é•¿ã€è¿™æ ·å¥‡æ€ªæœºåˆ¶çš„ OJã€‚

---

### æš´åŠ›ï¼ˆTLE or åŒç™¾)

äºæ˜¯æœ‰äº† `Java` æ€»æ—¶é—´è¶…æ—¶ï¼Œ`TypeScripe` åŒç™¾çš„ç»“æœï¼ˆåº”è¯¥æ˜¯ `TypeScript` æäº¤ä¸å¤šï¼ŒåŒæ—¶è®¾é™å®½æ¾çš„åŸå› ï¼‰ï¼š

![image.png](https://pic.leetcode-cn.com/1657762623-sqPFIC-image.png)

Java ä»£ç ï¼š
```Java
class WordFilter {
    String[] ss;
    public WordFilter(String[] words) {
        ss = words;
    }
    public int f(String a, String b) {
        int n = a.length(), m = b.length();
        for (int k = ss.length - 1; k >= 0; k--) {
            String cur = ss[k];
            int len = cur.length();
            if (len < n || len < m) continue;
            boolean ok = true;
            for (int i = 0; i < n && ok; i++) {
                if (cur.charAt(i) != a.charAt(i)) ok = false;
            }
            for (int i = 0; i < m && ok; i++) {
                if (cur.charAt(len - 1 - i) != b.charAt(m - 1 - i)) ok = false;
            }
            if (ok) return k;
        }
        return -1;
    }
}
```
TypeScript ä»£ç ï¼š
```TypeScript
class WordFilter {
    ss: string[]
    constructor(words: string[]) {
        this.ss = words
    }
    f(a: string, b: string): number {
        const n = a.length, m = b.length
        for (let k = this.ss.length - 1; k >= 0; k--) {
            const cur = this.ss[k]
            const len = cur.length
            if (len < n || len < m) continue
            let ok = true
            for (let i = 0; i < n && ok; i++) {
                if (cur[i] != a[i]) ok = false
            }
            for (let i = m - 1; i >= 0; i--) {
                if (cur[len - 1 - i] != b[m - 1 - i]) ok = false
            }
            if (ok) return k
        }
        return -1
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šåˆå§‹åŒ–æ“ä½œå¤æ‚åº¦ä¸º $O(1)$ï¼Œæ£€ç´¢æ“ä½œå¤æ‚åº¦ä¸º $O(\sum_{i = 0}^{n - 1} ss[i].length)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(\sum_{i = 0}^{n - 1} ss[i].length)$

---

### Trie

ä½¿ç”¨å­—å…¸æ ‘ä¼˜åŒ–æ£€ç´¢è¿‡ç¨‹ä¹Ÿæ˜¯å®¹æ˜“çš„ï¼Œåˆ†åˆ«ä½¿ç”¨ä¸¤æ£µ `Trie` æ ‘æ¥è®°å½• $ss[i]$ çš„å‰åç¼€ï¼Œå³æ­£ç€å­˜åˆ° `tr1` ä¸­ï¼Œåç€å­˜åˆ° `Tr2` ä¸­ã€‚

> è¿˜ä¸äº†è§£ `Trie` çš„åŒå­¦å¯ä»¥å…ˆçœ‹å‰ç½® ğŸ§€ï¼š[ã€è®¾è®¡æ•°æ®ç»“æ„ã€‘å®ç° Trie (å‰ç¼€æ ‘)](https://mp.weixin.qq.com/s?__biz=MzU4NDE3MTEyMA==&mid=2247488490&idx=1&sn=db2998cb0e5f08684ee1b6009b974089)
å‰ç½® ğŸ§€ é€šè¿‡å›¾è§£å½¢å¼è®²è§£äº† `Trie` çš„ç»“æ„ä¸åŸç†ï¼Œä»¥åŠæä¾›äº†ä¸¤ç§å®ç° `Trie` çš„æ–¹å¼

åŒæ—¶å¯¹äºå­—å…¸æ ‘çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬ä½¿ç”¨æ•°ç»„ `idxs` è®°å½•ç»è¿‡è¯¥èŠ‚ç‚¹çš„å­—ç¬¦ä¸² $ss[i]$ æ‰€åœ¨ `ss` ä¸­çš„ä¸‹æ ‡ $i$ï¼Œè‹¥æŸä¸ªå­—å…¸æ ‘èŠ‚ç‚¹çš„ç´¢å¼•æ•°ç»„ `tr.idxs` ä¸º $[a_1, a_2, ..., a_k]$ åˆ™ä»£è¡¨ã€Œä»æ ¹èŠ‚ç‚¹åˆ° `tr` èŠ‚ç‚¹æ‰€å¯¹åº”çš„å­—ç¬¦ä¸²ã€ä¸º $ss[a_1], ss[a_2], ..., ss[a_k]$ çš„å‰ç¼€ã€‚

è¿™æ ·æˆ‘ä»¬å¯ä»¥å³å¯åœ¨æ‰«æå‰åç¼€ `a` å’Œ `b` æ—¶ï¼Œå¾—åˆ°å¯¹åº”çš„å€™é€‰ä¸‹æ ‡åˆ—è¡¨ `l1` å’Œ `l2`ï¼Œç”±äºæˆ‘ä»¬å°† $ss[i]$ æ·»åŠ åˆ°ä¸¤æ£µ `tr` ä¸­æ˜¯æŒ‰ç…§ä¸‹æ ‡ã€Œä»å°åˆ°å¤§ã€è¿›è¡Œï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨ã€ŒåŒæŒ‡é’ˆã€ç®—æ³•åˆ†åˆ«ä» `l1` å’Œ `l2` ç»“å°¾å¾€åæ‰¾åˆ°ç¬¬ä¸€ä¸ªå…±åŒå…ƒç´ å³æ˜¯ç­”æ¡ˆï¼ˆæ»¡è¶³æ¡ä»¶çš„æœ€å¤§ä¸‹æ ‡ï¼‰ã€‚

> ä½¿ç”¨ `Trie` ä¼˜åŒ–åï¼Œ`Java` ä» `TLE` åˆ° `AC`ï¼Œ`TypeScript` è€—æ—¶ä¸ºåŸæœ¬çš„ $\frac{1}{7}$ ï¼š

![image.png](https://pic.leetcode-cn.com/1657763829-NUFFNg-image.png)

Java ä»£ç ï¼š
```Java
class WordFilter {
    class TrieNode {
        TrieNode[] tns = new TrieNode[26];
        List<Integer> idxs = new ArrayList<>();
    }
    void add(TrieNode p, String s, int idx, boolean isTurn) {
        int n = s.length();
        p.idxs.add(idx);
        for (int i = isTurn ? n - 1 : 0; i >= 0 && i < n; i += isTurn ? -1 : 1) {
            int u = s.charAt(i) - 'a';
            if (p.tns[u] == null) p.tns[u] = new TrieNode();
            p = p.tns[u];
            p.idxs.add(idx);
        }
    }
    int query(String a, String b) {
        int n = a.length(), m = b.length();
        TrieNode p = tr1;
        for (int i = 0; i < n; i++) {
            int u = a.charAt(i) - 'a';
            if (p.tns[u] == null) return -1;
            p = p.tns[u];
        }
        List<Integer> l1 = p.idxs;
        p = tr2;
        for (int i = m - 1; i >= 0; i--) {
            int u = b.charAt(i) - 'a';
            if (p.tns[u] == null) return -1;
            p = p.tns[u];
        }
        List<Integer> l2 = p.idxs;
        n = l1.size(); m = l2.size();
        for (int i = n - 1, j = m - 1; i >= 0 && j >= 0; ) {
            if (l1.get(i) > l2.get(j)) i--;
            else if (l1.get(i) < l2.get(j)) j--;
            else return l1.get(i);
        }
        return -1;
    }
    TrieNode tr1 = new TrieNode(), tr2 = new TrieNode();
    public WordFilter(String[] ss) {
        int n = ss.length;
        for (int i = 0; i < n; i++) {
            add(tr1, ss[i], i, false);
            add(tr2, ss[i], i, true);
        }
    }
    public int f(String a, String b) {
        return query(a, b);
    }
}
```
TypeScript ä»£ç ï¼š
```TypeScript
class TrieNode {
    tns: TrieNode[] = new Array<TrieNode>()
    idxs: number[] = new Array<number>()
}
class WordFilter {
    add(p: TrieNode, s: string, idx: number, isTurn: boolean): void {
        const n = s.length
        p.idxs.push(idx)
        for (let i = isTurn ? n - 1 : 0; i >= 0 && i < n; i += isTurn ? -1 : 1) {
            const u = s.charCodeAt(i) - 'a'.charCodeAt(0)
            if (p.tns[u] == null) p.tns[u] = new TrieNode()
            p = p.tns[u]
            p.idxs.push(idx)
        }
    }
    query(a: string, b: string): number {
        let n = a.length, m = b.length
        let p = this.tr1
        for (let i = 0; i < n; i++) {
            const u = a.charCodeAt(i) - 'a'.charCodeAt(0)
            if (p.tns[u] == null) return -1
            p = p.tns[u]
        }
        const l1 = p.idxs
        p = this.tr2
        for (let i = m - 1; i >= 0; i--) {
            const u = b.charCodeAt(i) - 'a'.charCodeAt(0)
            if (p.tns[u] == null) return -1
            p = p.tns[u]
        }
        const l2 = p.idxs
        n = l1.length; m = l2.length
        for (let i = n - 1, j = m - 1; i >= 0 && j >= 0; ) {
            if (l1[i] < l2[j]) j--
            else if (l1[i] > l2[j]) i--
            else return l1[i]
        }
        return -1
    }
    tr1: TrieNode = new TrieNode()
    tr2: TrieNode = new TrieNode()
    constructor(ss: string[]) {
        for (let i = 0; i < ss.length; i++) {
            this.add(this.tr1, ss[i], i, false)
            this.add(this.tr2, ss[i], i, true)
        }
    }
    f(a: string, b: string): number {
        return this.query(a, b)
    }
}
```
C++ ä»£ç ï¼š
```C++
class WordFilter {
public:
    struct TrieNode {
        TrieNode* tns[26] {nullptr};
        vector<int> idxs;
    };
    
    void add(TrieNode* p, const string& s, int idx, bool isTurn) {
        int n = s.size();
        p->idxs.push_back(idx);
        for(int i = isTurn ? n - 1 : 0; i >= 0 && i < n; i += isTurn ? -1 : 1) {
            int u = s[i] - 'a';
            if(p->tns[u] == nullptr) p->tns[u] = new TrieNode();
            p = p->tns[u];
            p->idxs.push_back(idx);
        }
    }
    
    int query(const string& a, const string& b) {
        int n = a.size(), m = b.size();
        auto p = tr1;
        for(int i = 0; i < n; i++) {
            int u = a[i] - 'a';
            if(p->tns[u] == nullptr) return -1;
            p = p->tns[u];
        }
        vector<int>& l1 = p->idxs;
        p = tr2;
        for(int i = m - 1; i >= 0; i--) {
            int u = b[i] - 'a';
            if(p->tns[u] == nullptr) return -1;
            p = p->tns[u];
        }
        vector<int>& l2 = p->idxs;
        n = l1.size(), m = l2.size();
        for(int i = n - 1, j = m - 1; i >= 0 && j >= 0; ) {
            if(l1[i] > l2[j]) i--;
            else if(l1[i] < l2[j]) j--;
            else return l1[i];
        }
        return -1;
    }
    
    TrieNode* tr1 = new TrieNode, *tr2 = new TrieNode;
    WordFilter(vector<string>& ss) {
        int n = ss.size();
        for(int i = 0; i < n; i++) {
            add(tr1, ss[i], i, false);
            add(tr2, ss[i], i, true);
        }
    }
    
    int f(string a, string b) {
        return query(a, b);
    }
};
```
* æ—¶é—´å¤æ‚åº¦ï¼šåˆå§‹åŒ–æ“ä½œå¤æ‚åº¦ä¸º $O(\sum_{i = 0}^{n - 1} ss[i].length)$ï¼Œæ£€ç´¢è¿‡ç¨‹å¤æ‚åº¦ä¸º $O(a + b + n)$ï¼Œå…¶ä¸­ $a = b = 7$ ä¸ºå‰åç¼€çš„æœ€å¤§é•¿åº¦ï¼Œ$n = 1e4$ ä¸ºåˆå§‹åŒ–æ•°ç»„é•¿åº¦ï¼Œä»£è¡¨æœ€å¤šæœ‰ $n$ ä¸ªå€™é€‰ä¸‹æ ‡ï¼ˆæ³¨æ„ï¼šè¿™é‡Œçš„ $n$ åªæ˜¯ç²—ç•¥åˆ†æï¼Œå®é™…ä¸Šå¦‚æœå€™é€‰é›†é•¿åº¦è¶Šå¤§çš„è¯ï¼Œè¯´æ˜ä¸¤ä¸ªå€™é€‰é›†æ˜¯é‡åˆåº¦æ˜¯è¶Šé«˜çš„ï¼Œä»åå¾€å‰æ‰¾çš„è¿‡ç¨‹æ˜¯è¶Šå¿«ç»“æŸçš„ï¼Œå¯ä»¥é€šè¿‡æ–¹ç¨‹ç®—å‡ºä¸€ä¸ªåŒæŒ‡é’ˆçš„ç†è®ºæœ€å¤§æ¯”è¾ƒæ¬¡æ•° $k$ï¼Œå¦‚æœè¦å°† $n$ å¡æ»¡æˆ $1e4$ çš„è¯ï¼Œéœ€è¦å°†ä¸¤ä¸ªå€™é€‰é›†è®¾è®¡æˆäº¤æ›¿ä¸‹æ ‡ï¼Œæ­¤æ—¶ `f` å¦‚æœä»æ˜¯ $1e4$ æ¬¡è°ƒç”¨çš„è¯ï¼Œå¿…ç„¶ä¼šé¢ä¸´å¤§é‡çš„é‡å¤æŸ¥è¯¢ï¼Œå¯é€šè¿‡å¼•å…¥ `map` è®°å½•æŸ¥è¯¢æ¬¡æ•°æ¥è¿›è¡Œä¼˜åŒ–ï¼‰
* ç©ºé—´å¤æ‚åº¦ï¼š$O(\sum_{i = 0}^{n - 1} ss[i].length)$

---

### æœ€å

è¿™æ˜¯æˆ‘ä»¬ã€Œåˆ·ç©¿ LeetCodeã€ç³»åˆ—æ–‡ç« çš„ç¬¬ `No.745` ç¯‡ï¼Œç³»åˆ—å¼€å§‹äº 2021/01/01ï¼Œæˆªæ­¢äºèµ·å§‹æ—¥ LeetCode ä¸Šå…±æœ‰ 1916 é“é¢˜ç›®ï¼Œéƒ¨åˆ†æ˜¯æœ‰é”é¢˜ï¼Œæˆ‘ä»¬å°†å…ˆæŠŠæ‰€æœ‰ä¸å¸¦é”çš„é¢˜ç›®åˆ·å®Œã€‚

åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« é‡Œé¢ï¼Œé™¤äº†è®²è§£è§£é¢˜æ€è·¯ä»¥å¤–ï¼Œè¿˜ä¼šå°½å¯èƒ½ç»™å‡ºæœ€ä¸ºç®€æ´çš„ä»£ç ã€‚å¦‚æœæ¶‰åŠé€šè§£è¿˜ä¼šç›¸åº”çš„ä»£ç æ¨¡æ¿ã€‚

ä¸ºäº†æ–¹ä¾¿å„ä½åŒå­¦èƒ½å¤Ÿç”µè„‘ä¸Šè¿›è¡Œè°ƒè¯•å’Œæäº¤ä»£ç ï¼Œæˆ‘å»ºç«‹äº†ç›¸å…³çš„ä»“åº“ï¼šhttps://github.com/SharingSource/LogicStack-LeetCode ã€‚

åœ¨ä»“åº“åœ°å€é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°ç³»åˆ—æ–‡ç« çš„é¢˜è§£é“¾æ¥ã€ç³»åˆ—æ–‡ç« çš„ç›¸åº”ä»£ç ã€LeetCode åŸé¢˜é“¾æ¥å’Œå…¶ä»–ä¼˜é€‰é¢˜è§£ã€‚

