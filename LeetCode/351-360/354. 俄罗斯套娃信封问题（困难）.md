### é¢˜ç›®æè¿°

è¿™æ˜¯ LeetCode ä¸Šçš„ **[354. ä¿„ç½—æ–¯å¥—å¨ƒä¿¡å°é—®é¢˜](https://leetcode-cn.com/problems/russian-doll-envelopes/solution/zui-chang-shang-sheng-zi-xu-lie-bian-xin-6s8d/)** ï¼Œéš¾åº¦ä¸º **å›°éš¾**ã€‚

Tag : ã€ŒäºŒåˆ†ã€ã€ã€Œåºåˆ— DPã€




ç»™ä½ ä¸€ä¸ªäºŒç»´æ•´æ•°æ•°ç»„ `envelopes`ï¼Œå…¶ä¸­ $envelopes[i] = [w_{i}, h_{i}]$ï¼Œè¡¨ç¤ºç¬¬ `i` ä¸ªä¿¡å°çš„å®½åº¦å’Œé«˜åº¦ã€‚

å½“å¦ä¸€ä¸ªä¿¡å°çš„å®½åº¦å’Œé«˜åº¦éƒ½æ¯”è¿™ä¸ªä¿¡å°å¤§çš„æ—¶å€™ï¼Œè¿™ä¸ªä¿¡å°å°±å¯ä»¥æ”¾è¿›å¦ä¸€ä¸ªä¿¡å°é‡Œï¼Œå¦‚åŒä¿„ç½—æ–¯å¥—å¨ƒä¸€æ ·ã€‚

è¯·è®¡ç®—ã€Œæœ€å¤šèƒ½æœ‰å¤šå°‘ä¸ªã€ä¿¡å°èƒ½ç»„æˆä¸€ç»„â€œä¿„ç½—æ–¯å¥—å¨ƒâ€ä¿¡å°ï¼ˆå³å¯ä»¥æŠŠä¸€ä¸ªä¿¡å°æ”¾åˆ°å¦ä¸€ä¸ªä¿¡å°é‡Œé¢ï¼‰ã€‚

æ³¨æ„ï¼šä¸å…è®¸æ—‹è½¬ä¿¡å°ã€‚


ç¤ºä¾‹ 1ï¼š
```
è¾“å…¥ï¼šenvelopes = [[5,4],[6,4],[6,7],[2,3]]

è¾“å‡ºï¼š3

è§£é‡Šï¼šæœ€å¤šä¿¡å°çš„ä¸ªæ•°ä¸º 3, ç»„åˆä¸º: [2,3] => [5,4] => [6,7]ã€‚
```
ç¤ºä¾‹ 2ï¼š
```
è¾“å…¥ï¼šenvelopes = [[1,1],[1,1],[1,1]]

è¾“å‡ºï¼š1
```

ã€åŸæ•°æ®ç»“æ„èŒƒå›´ã€‘æç¤ºï¼š

* æ— 

ã€é¢˜ç›®æ›´æ–°åæ•°æ®èŒƒå›´ã€‘æç¤ºï¼š

* $1 <= envelopes.length <= 10^5$
* $envelopes[i].length = 2$
* $1 <= w_{i}, h_{i} <= 10^5$

---

### åŠ¨æ€è§„åˆ’

è¿™æ˜¯ä¸€é“ç»å…¸çš„ DP æ¨¡å‹é¢˜ç›®ï¼šæœ€é•¿ä¸Šå‡å­åºåˆ—ï¼ˆLISï¼‰ã€‚

é¦–å…ˆæˆ‘ä»¬å…ˆå¯¹ `envelopes` è¿›è¡Œæ’åºï¼Œç¡®ä¿ä¿¡å°æ˜¯ä»å°åˆ°å¤§è¿›è¡Œæ’åºã€‚

é—®é¢˜å°±è½¬åŒ–ä¸ºæˆ‘ä»¬ä»è¿™ä¸ªåºåˆ—ä¸­é€‰æ‹© `k` ä¸ªä¿¡å°å½¢æˆæ–°çš„åºåˆ—ï¼Œä½¿å¾—æ–°åºåˆ—ä¸­çš„æ¯ä¸ªä¿¡å°éƒ½èƒ½ä¸¥æ ¼è¦†ç›–å‰é¢çš„ä¿¡å°ï¼ˆå®½é«˜éƒ½ä¸¥æ ¼å¤§äºï¼‰ã€‚

æˆ‘ä»¬å¯ä»¥**å®šä¹‰çŠ¶æ€ $f[i]$ ä¸ºè€ƒè™‘å‰ i ä¸ªç‰©å“ï¼Œå¹¶ä»¥ç¬¬ $i$ ä¸ªç‰©å“ä¸ºç»“å°¾çš„æœ€å¤§å€¼ã€‚**

å¯¹äºæ¯ä¸ª$f[i]$ è€Œè¨€ï¼Œæœ€å°å€¼ä¸º $1$ï¼Œä»£è¡¨åªé€‰æ‹©è‡ªå·±ä¸€ä¸ªä¿¡å°ã€‚

é‚£ä¹ˆå¯¹äºä¸€èˆ¬çš„ $f[i]$ è¯¥å¦‚ä½•æ±‚è§£å‘¢ï¼Ÿå› ä¸ºç¬¬ i ä»¶ç‰©å“æ˜¯å¿…é¡»é€‰æ‹©çš„ã€‚æˆ‘ä»¬å¯ä»¥æšä¸¾å‰é¢çš„ $i - 1$ ä»¶ç‰©å“ï¼Œå“ªä¸€ä»¶å¯ä»¥ä½œä¸ºç¬¬ $i$ ä»¶ç‰©å“çš„ä¸Šä¸€ä»¶ç‰©å“ã€‚

åœ¨å‰ $i - 1$ ä»¶ç‰©å“ä¸­åªè¦æœ‰ç¬¦åˆæ¡ä»¶çš„ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨ $max(f[i], f[j] + 1)$ æ›´æ–° $f[i]$ã€‚

ç„¶ååœ¨æ‰€æœ‰æ–¹æ¡ˆä¸­å–ä¸€ä¸ª `max` å³æ˜¯ç­”æ¡ˆã€‚

> ç”±äº LC è¡¥å……äº†æ•°æ®èŒƒå›´ & æ ·ä¾‹ï¼Œè¯¥åšæ³•ç°å·² TLEã€‚

Java ä»£ç ï¼š

```Java
class Solution {
    public int maxEnvelopes(int[][] es) {
        int n = es.length, ans = 1;
        if (n == 0) return n;
        // å› ä¸ºæˆ‘ä»¬åœ¨æ‰¾ç¬¬ i ä»¶ç‰©å“çš„å‰ä¸€ä»¶ç‰©å“æ—¶ï¼Œä¼šå¯¹å‰é¢çš„ i - 1 ä»¶ç‰©å“éƒ½éå†ä¸€éï¼Œå› æ­¤ç¬¬äºŒç»´ï¼ˆé«˜åº¦ï¼‰æ’åºä¸å¦éƒ½ä¸å½±å“
        Arrays.sort(es, (a, b)->a[0]-b[0]);
        int[] f = new int[n]; // f(i) ä¸ºè€ƒè™‘å‰ i ä¸ªç‰©å“ï¼Œå¹¶ä»¥ç¬¬ i ä¸ªç‰©å“ä¸ºç»“å°¾çš„æœ€å¤§å€¼
        for (int i = 0; i < n; i++) {
            // å¯¹äºæ¯ä¸ª f[i] éƒ½æ»¡è¶³æœ€å°å€¼ä¸º 1
            f[i] = 1; 
            // æšä¸¾ç¬¬ i ä»¶ç‰©å“çš„å‰ä¸€ä»¶ç‰©å“ï¼Œ
            for (int j = i - 1; j >= 0; j--) {
                // åªè¦æœ‰æ»¡è¶³æ¡ä»¶çš„å‰ä¸€ä»¶ç‰©å“ï¼Œæˆ‘ä»¬å°±å°è¯•ä½¿ç”¨ f[j] + 1 æ›´æ–° f[i]
                if (check(es, j, i)) f[i] = Math.max(f[i], f[j] + 1);
            }
            // åœ¨æ‰€æœ‰çš„ f[i] ä¸­å– max ä½œä¸º ans
            ans = Math.max(ans, f[i]);
        }
        return ans;
    }
    boolean check(int[][] es, int mid, int i) {
        return es[mid][0] < es[i][0] && es[mid][1] < es[i][1];
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼š$O(n^2)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

---

### äºŒåˆ† + åŠ¨æ€è§„åˆ’

ä¸Šè¿°æ–¹æ¡ˆå…¶å®ç®—æ˜¯ä¸€ä¸ªæœ´ç´ æ–¹æ¡ˆï¼Œå¤æ‚åº¦æ˜¯ $O(n^2)$ çš„ï¼Œä¹Ÿæ˜¯æˆ‘æœ€å…ˆæƒ³åˆ°æ€è·¯ï¼Œä½†æ˜¯é¢˜ç›®æ²¡æœ‰ç»™å‡ºæ•°æ®èŒƒå›´ï¼Œä¹Ÿä¸çŸ¥é“èƒ½ä¸èƒ½è¿‡ã€‚

å”¯å”¯è¯ºè¯ºäº¤äº†ä¸€ä¸ªå±…ç„¶è¿‡äº†ã€‚

ä¸‹é¢è®²ä¸‹å…¶ä»–ä¼˜åŒ–è§£æ³•ã€‚

é¦–å…ˆè¿˜æ˜¯å’Œä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¤æ‚åº¦åˆ†ææ¥æƒ³ä¼˜åŒ–æ–¹å‘ã€‚

æŒ‡æ•°ç®—æ³•å¾€ä¸‹ä¼˜åŒ–å°±æ˜¯å¯¹æ•°è§£æ³•æˆ–è€…çº¿æ€§è§£æ³•ã€‚

ä»”ç»†è§‚å¯Ÿæœ´ç´ è§£æ³•ï¼Œå…¶å®å¯ä¼˜åŒ–çš„åœ°æ–¹ä¸»è¦å°±æ˜¯æ‰¾ç¬¬ $i$ ä»¶ç‰©å“çš„å‰ä¸€ä»¶ç‰©å“çš„è¿‡ç¨‹ã€‚

å¦‚æœæƒ³è¦åŠ å¿«è¿™ä¸ªæŸ¥æ‰¾è¿‡ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æŸç§æ•°æ®ç»“æ„è¿›è¡Œè®°å½•ã€‚

å¹¶ä¸”æ˜¯è¾¹è¿­ä»£è¾¹æ›´æ–°æ•°æ®ç»“æ„é‡Œé¢çš„å†…å®¹ã€‚

é¦–å…ˆå› ä¸ºæˆ‘ä»¬å¯¹ `w` è¿›è¡Œäº†æ’åºï¼ˆä»å°åˆ°å¤§ï¼‰ï¼Œç„¶åè¿­ä»£ä¹Ÿæ˜¯ä»å‰å¾€åè¿›è¡Œï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦ä¿è¯è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œå¯¹äº `w` ç›¸åŒçš„æ•°æ®ä¸æ›´æ–°ï¼Œå°±èƒ½ä¿è¯ `g` ä¸­åªä¼šå‡ºç°æ»¡è¶³ `w` æ¡ä»¶çš„ä¿¡å°ã€‚

åˆ°è¿™ä¸€æ­¥ï¼Œè¿˜éœ€è¦ç”¨åˆ°çš„ä¸œè¥¿æœ‰ä¸¤ä¸ªï¼šä¸€ä¸ªæ˜¯ `h`ï¼Œå› ä¸ºåªæœ‰ `w` å’Œ `h` éƒ½åŒæ—¶æ»¡è¶³ï¼Œæˆ‘ä»¬æ‰èƒ½åŠ å…¥ä¸Šå‡åºåˆ—ä¸­ï¼›ä¸€ä¸ªæ˜¯ä¿¡å°æ‰€å¯¹åº”çš„ä¸Šå‡åºåˆ—é•¿åº¦ï¼Œè¿™æ˜¯æˆ‘ä»¬åŠ é€ŸæŸ¥æ‰¾çš„æ ¸å¿ƒã€‚

æˆ‘ä»¬ä½¿ç”¨æ•°ç»„ `g` æ¥è®°å½•ï¼Œ$g[i]$ è¡¨ç¤ºé•¿åº¦ä¸º $i$ çš„æœ€é•¿ä¸Šå‡å­åºåˆ—çš„ä¸­çš„æœ€å°ã€Œä¿¡å°é«˜åº¦ã€ï¼ŒåŒæ—¶éœ€è¦ä½¿ç”¨ `len` è®°å½•å½“å‰è®°å½•åˆ°çš„æœ€å¤§é•¿åº¦ã€‚

è¿˜æ˜¯ä¸ç†è§£ï¼Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥çœ‹çœ‹ä»£ç ï¼Œæˆ‘æŠŠåŸºæœ¬é€»è¾‘å†™åœ¨äº†æ³¨é‡Šå½“ä¸­ï¼ˆä½ çš„é‡ç‚¹åº”è¯¥è½åœ¨å¯¹ $g[]$ æ•°ç»„çš„ç†è§£ä¸Šï¼‰ã€‚

Java ä»£ç ï¼š

```Java
class Solution {
    public int maxEnvelopes(int[][] es) {
        int n = es.length, ans = 1;
        if (n == 0) return n;
        // ç”±äºæˆ‘ä»¬ä½¿ç”¨äº† g è®°å½•é«˜åº¦ï¼Œå› æ­¤è¿™é‡Œåªéœ€å°† w ä»å°åˆ°è¾¾æ’åºå³å¯
        Arrays.sort(es, (a, b)->a[0] - b[0]);
        // f(i) ä¸ºè€ƒè™‘å‰ i ä¸ªç‰©å“ï¼Œå¹¶ä»¥ç¬¬ i ä¸ªç‰©å“ä¸ºç»“å°¾çš„æœ€å¤§å€¼
        int[] f = new int[n]; 
        // g(i) è®°å½•çš„æ˜¯é•¿åº¦ä¸º i çš„æœ€é•¿ä¸Šå‡å­åºåˆ—çš„æœ€å°ã€Œä¿¡å°é«˜åº¦ã€
        int[] g = new int[n]; 
        // å› ä¸ºè¦å– minï¼Œç”¨ä¸€ä¸ªè¶³å¤Ÿå¤§ï¼ˆä¸å¯èƒ½ï¼‰çš„é«˜åº¦åˆå§‹åŒ–
        Arrays.fill(g, Integer.MAX_VALUE); 
        g[0] = 0;
        for (int i = 0, j = 0, len = 1; i < n; i++) {
            // å¯¹äº w ç›¸åŒçš„æ•°æ®ï¼Œä¸æ›´æ–° g æ•°ç»„
            if (es[i][0] != es[j][0]) {
                // é™åˆ¶ j ä¸èƒ½è¶Šè¿‡ iï¼Œç¡®ä¿ g æ•°ç»„ä¸­åªä¼šå‡ºç°ç¬¬ i ä¸ªä¿¡å°å‰çš„ã€Œå†å²ä¿¡å°ã€
                while (j < i) {
                    int prev = f[j], cur = es[j][1];
                    if (prev == len) {
                        // ä¸å½“å‰é•¿åº¦ä¸€è‡´äº†ï¼Œè¯´æ˜ä¸Šå‡åºåˆ—å¤šå¢åŠ ä¸€ä½
                        g[len++] = cur;
                    } else {
                        // å§‹ç»ˆä¿ç•™æœ€å°çš„ã€Œä¿¡å°é«˜åº¦ã€ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿æœ‰æ›´å¤šçš„ä¿¡å°å¯ä»¥ä¸å…¶è¡Œç¨‹ä¸Šå‡åºåˆ—
                        // ä¸¾ä¾‹ï¼šåŒæ ·æ˜¯ä¸Šå‡é•¿åº¦ä¸º 5 çš„åºåˆ—ï¼Œä¿ç•™æœ€å°é«˜åº¦ä¸º 5 è®°å½•ï¼ˆè€Œä¸æ˜¯ä¿ç•™ä»»æ„çš„ï¼Œæ¯”å¦‚ 10ï¼‰ï¼Œè¿™æ ·ä¹‹åé«˜åº¦ä¸º 7 8 9 çš„ä¿¡å°éƒ½èƒ½å½¢æˆåºåˆ—ï¼›
                        g[prev] = Math.min(g[prev], cur);
                    }
                    j++;
                }
            }

            // äºŒåˆ†è¿‡ç¨‹
            // g[i] ä»£è¡¨çš„æ˜¯ä¸Šå‡å­åºåˆ—é•¿åº¦ä¸º i çš„ã€Œæœ€å°ä¿¡å°é«˜åº¦ã€
            int l = 0, r = len;
            while (l < r) {
                int mid = l + r >> 1;
                // ä»¤ check æ¡ä»¶ä¸º es[i][1] <= g[mid]ï¼ˆä»£è¡¨ w å’Œ h éƒ½ä¸¥æ ¼å°äºå½“å‰ä¿¡å°ï¼‰
                // è¿™æ ·æˆ‘ä»¬æ‰¾åˆ°çš„å°±æ˜¯æ»¡è¶³æ¡ä»¶ï¼Œæœ€é è¿‘æ•°ç»„ä¸­å¿ƒç‚¹çš„æ•°æ®ï¼ˆä¹Ÿå°±æ˜¯æ»¡è¶³ check æ¡ä»¶çš„æœ€å¤§ä¸‹æ ‡ï¼‰
                // å¯¹åº”å› g[] æ•°ç»„çš„å«ä¹‰ï¼Œå…¶å®å°±æ˜¯æ‰¾åˆ° w å’Œ h éƒ½æ»¡è¶³æ¡ä»¶çš„æœ€å¤§ä¸Šå‡é•¿åº¦
                if (es[i][1] <= g[mid]) r = mid;
                else l = mid + 1;
            }
            // æ›´æ–° f[i] ä¸ç­”æ¡ˆ
            f[i] = r;
            ans = Math.max(ans, f[i]);
        }
        return ans;
    }
}
```
C++ ä»£ç ï¼š
```C++
class Solution {
public:
    int maxEnvelopes(vector<vector<int>>& es) {
        int n = es.size(), ans = 1;
        if (n == 0) return n;
        sort(es.begin(), es.end(), [](const vector<int>& a, const vector<int>& b) {
            return a[0] < b[0];
        });
        vector<int> f(n, 0);
        vector<int> g(n, INT_MAX);
        g[0] = 0;
        for (int i = 0, j = 0, len = 1; i < n; i++) {
            if (es[i][0] != es[j][0]) {
                while (j < i) {
                    int prev = f[j], cur = es[j][1];
                    if (prev == len) {
                        g[len++] = cur;
                    } else {
                        g[prev] = min(g[prev], cur);
                    }
                    j++;
                }
            }
            int l = 0, r = len;
            while (l < r) {
                int mid = l + r >> 1;
                if (es[i][1] <= g[mid]) r = mid;
                else l = mid + 1;
            }
            f[i] = r;
            ans = max(ans, f[i]);
        }
        return ans;
    }
};
```
* æ—¶é—´å¤æ‚åº¦ï¼šå¯¹äºæ¯ä»¶ç‰©å“éƒ½æ˜¯é€šè¿‡ã€ŒäºŒåˆ†ã€æ‰¾åˆ°å…¶å‰ä¸€ä»¶ç‰©å“ã€‚å¤æ‚åº¦ä¸º $O(n\log{n})$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

---

### è¯æ˜

æˆ‘ä»¬å¯ä»¥è¿™æ ·åšçš„å‰ææ˜¯ `g` æ•°ç»„å…·æœ‰äºŒæ®µæ€§ï¼Œå¯ä»¥é€šè¿‡è¯æ˜å…¶å…·æœ‰ã€Œå•è°ƒæ€§ã€æ¥å®ç°ã€‚

å½“ç„¶è¿™é‡ŒæŒ‡çš„æ˜¯ `g` è¢«ä½¿ç”¨çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯ $[0, len - 1]$ çš„éƒ¨åˆ†ã€‚

æˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹ `g[]` æ•°ç»„çš„å®šä¹‰ï¼š**$g[i]$ è¡¨ç¤ºé•¿åº¦ä¸º $i$ çš„æœ€é•¿ä¸Šå‡å­åºåˆ—çš„ä¸­çš„æœ€å°ã€Œä¿¡å°é«˜åº¦ã€**

ä¾‹å¦‚ $g[] = [0, 3, 4, 5]$ ä»£è¡¨çš„å«ä¹‰æ˜¯ï¼š
* ä¸Šå‡åºåˆ—é•¿åº¦ä¸º 0 çš„æœ€å°å†å²ä¿¡å°é«˜åº¦ä¸º 0
* ä¸Šå‡åºåˆ—é•¿åº¦ä¸º 1 çš„æœ€å°å†å²ä¿¡å°é«˜åº¦ä¸º 3
* ä¸Šå‡åºåˆ—é•¿åº¦ä¸º 2 çš„æœ€å°å†å²ä¿¡å°é«˜åº¦ä¸º 4
* ä¸Šå‡åºåˆ—é•¿åº¦ä¸º 3 çš„æœ€å°å†å²ä¿¡å°é«˜åº¦ä¸º 5

å¯ä»¥é€šè¿‡åè¯æ³•æ¥è¯æ˜å…¶å•è°ƒæ€§:

å‡è®¾ $g[]$ ä¸å…·æœ‰å•è°ƒæ€§ï¼Œå³è‡³å°‘æœ‰ $g[i] > g[j]$ ( $i < j$ï¼Œä»¤ $a = g[i]$, $b = g[j]$)

æ˜¾ç„¶ä¸æˆ‘ä»¬çš„å¤„ç†é€»è¾‘å†²çªã€‚å› ä¸ºå¦‚æœè€ƒè™‘ä¸€ä¸ªã€Œæœ€å°é«˜åº¦ã€ä¸º `b` çš„ä¿¡å°èƒ½å¤Ÿå‡‘å‡ºé•¿åº¦ä¸º `j` çš„ä¸Šå‡åºåˆ—ï¼Œè‡ªç„¶ä¹Ÿèƒ½å‡‘å‡ºæ¯” `j` çŸ­çš„ä¸Šå‡åºåˆ—ï¼Œå¯¹å§ï¼Ÿ

ä¸¾ä¸ªğŸŒ°ï¼Œæˆ‘ä»¬æœ‰ä¿¡å°ï¼š[[1,1],[2,2],[3,3],[4,4],[5,5]]ï¼Œæˆ‘ä»¬èƒ½å‡‘å‡ºå¾ˆå¤šç§é•¿åº¦ä¸º 2 çš„ä¸Šå‡åºåˆ—æ–¹æ¡ˆï¼Œå…¶ä¸­æœ€å°çš„æ–¹æ¡ˆæ˜¯é«˜åº¦æœ€å°çš„æ–¹æ¡ˆæ˜¯ [[1,1],[2,2]]ã€‚å› æ­¤è¿™æ—¶å€™ g[2] = 2ï¼Œä»£è¡¨èƒ½å‡‘å‡ºé•¿åº¦ä¸º 2 çš„ä¸Šå‡åºåˆ—æ‰€ **å¿…é¡»ä½¿ç”¨çš„ä¿¡å°** çš„æœ€å°é«˜åº¦ä¸º 2ã€‚

è¿™æ—¶å€™åè¿‡æ¥è€ƒè™‘ï¼Œå¦‚æœä½¿ç”¨ [2,2] èƒ½å¤Ÿå‡‘å‡ºé•¿åº¦ä¸º 2 çš„ä¸Šå‡åºåˆ—ï¼Œå¿…ç„¶ä¹Ÿèƒ½å‡‘å‡ºé•¿åº¦ä¸º 1 çš„ä¸Šå‡åºåˆ—ï¼ˆåˆ é™¤å‰é¢çš„å…¶ä»–ä¿¡å°å³å¯ï¼‰ã€‚

**æ¨è€Œå¹¿ä¹‹ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ $g[j] = b$ï¼Œä¹Ÿå°±æ˜¯å‡‘æˆé•¿åº¦ä¸º `j` å¿…é¡»ä½¿ç”¨çš„æœ€å°ä¿¡å°é«˜åº¦ä¸º bã€‚é‚£ä¹ˆæˆ‘å¿…ç„¶èƒ½å¤Ÿä¿ç•™é«˜åº¦ä¸º `b` çš„ä¿¡å°ï¼Œåˆ æ‰ä¸Šå‡åºåˆ—ä¸­çš„ä¸€äº›ä¿¡å°ï¼Œå‡‘æˆä»»æ„é•¿åº¦æ¯” `j` å°çš„ä¸Šå‡åºåˆ—ã€‚**

ç»¼ä¸Šï¼Œ$g[i] > g[j]ï¼ˆi < jï¼‰$ ä¸å¤„ç†é€»è¾‘å†²çªï¼Œ$g[]$ æ•°ç»„ä¸ºä¸¥æ ¼å•è°ƒä¸Šå‡æ•°ç»„ã€‚

æ—¢ç„¶ $g[]$ å…·æœ‰å•è°ƒæ€§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ã€ŒäºŒåˆ†ã€æ‰¾åˆ°æ°æ»¡è¶³ check æ¡ä»¶çš„æœ€å¤§ä¸‹æ ‡ï¼ˆæœ€å¤§ä¸‹æ ‡è¾¾æ ‡è¡¨ç¤ºæœ€é•¿ä¸Šå‡åºåˆ—é•¿åº¦ï¼‰ã€‚

---

### æ ‘çŠ¶æ•°ç»„ + åŠ¨æ€è§„åˆ’

åœ¨ã€ŒäºŒåˆ† + åŠ¨æ€è§„åˆ’ã€çš„è§£æ³•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ã€ŒäºŒåˆ†ã€æ¥ä¼˜åŒ–æ‰¾ç¬¬ $i$ ä¸ªæ–‡ä»¶çš„å‰ä¸€ä¸ªæ–‡ä»¶è¿‡ç¨‹ã€‚

è¿™ä¸ªè¿‡ç¨‹åŒæ ·èƒ½é€šè¿‡ã€Œæ ‘çŠ¶æ•°ç»„ã€æ¥å®ç°ã€‚

é¦–å…ˆä»ç„¶æ˜¯å¯¹ `w` è¿›è¡Œæ’åºï¼Œç„¶åä½¿ç”¨ã€Œæ ‘çŠ¶æ•°ç»„ã€æ¥ç»´æŠ¤ h ç»´åº¦çš„å‰ç¼€æœ€å¤§å€¼ã€‚

å¯¹äº `h` çš„é«˜åº¦ï¼Œæˆ‘ä»¬åªå…³å¿ƒå¤šä¸ªä¿¡å°ä¹‹é—´çš„å¤§å°å…³ç³»ï¼Œè€Œä¸å…³å¿ƒå…·ä½“ç›¸å·®å¤šå°‘ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ `h` è¿›è¡Œç¦»æ•£åŒ–ã€‚

é€šå¸¸ä½¿ç”¨ã€Œæ ‘çŠ¶æ•°ç»„ã€éƒ½éœ€è¦è¿›è¡Œç¦»æ•£åŒ–ï¼Œå°¤å…¶æ˜¯è¿™é‡Œæˆ‘ä»¬æœ¬èº«å°±è¦ä½¿ç”¨ $O(n)$ çš„ç©ºé—´æ¥å­˜å‚¨ dp å€¼ã€‚

Java ä»£ç ï¼š

```java
class Solution {
    int[] tree;
    int lowbit(int x) {
        return x & -x;
    }

    public int maxEnvelopes(int[][] es) {
        int n = es.length;
        if (n == 0) return n;

        // ç”±äºæˆ‘ä»¬ä½¿ç”¨äº† g è®°å½•é«˜åº¦ï¼Œå› æ­¤è¿™é‡Œåªéœ€å°† w ä»å°åˆ°è¾¾æ’åºå³å¯
        Arrays.sort(es, (a, b)->a[0] - b[0]);

        // å…ˆå°†æ‰€æœ‰çš„ h è¿›è¡Œç¦»æ•£åŒ–
        Set<Integer> set = new HashSet<>();
        for (int i = 0; i < n; i++) set.add(es[i][1]);
        int cnt = set.size();
        int[] hs = new int[cnt];
        int idx = 0;
        for (int i : set) hs[idx++] = i;
        Arrays.sort(hs);
        for (int i = 0; i < n; i++) es[i][1] = Arrays.binarySearch(hs, es[i][1]) + 1;

        // åˆ›å»ºæ ‘çŠ¶æ•°ç»„
        tree = new int[cnt + 1];

        // f(i) ä¸ºè€ƒè™‘å‰ i ä¸ªç‰©å“ï¼Œå¹¶ä»¥ç¬¬ i ä¸ªç‰©å“ä¸ºç»“å°¾çš„æœ€å¤§å€¼
        int[] f = new int[n]; 
        int ans = 1;
        for (int i = 0, j = 0; i < n; i++) {
            // å¯¹äº w ç›¸åŒçš„æ•°æ®ï¼Œä¸æ›´æ–° tree æ•°ç»„
            if (es[i][0] != es[j][0]) {
                // é™åˆ¶ j ä¸èƒ½è¶Šè¿‡ iï¼Œç¡®ä¿ tree æ•°ç»„ä¸­åªä¼šå‡ºç°ç¬¬ i ä¸ªä¿¡å°å‰çš„ã€Œå†å²ä¿¡å°ã€
                while (j < i) {
                    for (int u = es[j][1]; u <= cnt; u += lowbit(u)) {
                        tree[u] = Math.max(tree[u], f[j]);
                    }
                    j++;
                }
            }
            f[i] = 1;
            for (int u = es[i][1] - 1; u > 0; u -= lowbit(u)) {
                f[i] = Math.max(f[i], tree[u] + 1);
            }
            ans = Math.max(ans, f[i]);
        }
        return ans;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šå¤„ç†æ¯ä¸ªç‰©å“æ—¶æ›´æ–°ã€Œæ ‘çŠ¶æ•°ç»„ã€å¤æ‚åº¦ä¸º$O(\log{n})$ã€‚æ•´ä½“å¤æ‚åº¦ä¸º $O(n\log{n})$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

---

### æœ€å

è¿™æ˜¯æˆ‘ä»¬ã€Œåˆ·ç©¿ LeetCodeã€ç³»åˆ—æ–‡ç« çš„ç¬¬ `No.354` ç¯‡ï¼Œç³»åˆ—å¼€å§‹äº 2021/01/01ï¼Œæˆªæ­¢äºèµ·å§‹æ—¥ LeetCode ä¸Šå…±æœ‰ 1916 é“é¢˜ç›®ï¼Œéƒ¨åˆ†æ˜¯æœ‰é”é¢˜ï¼Œæˆ‘ä»¬å°†å…ˆæŠŠæ‰€æœ‰ä¸å¸¦é”çš„é¢˜ç›®åˆ·å®Œã€‚

åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« é‡Œé¢ï¼Œé™¤äº†è®²è§£è§£é¢˜æ€è·¯ä»¥å¤–ï¼Œè¿˜ä¼šå°½å¯èƒ½ç»™å‡ºæœ€ä¸ºç®€æ´çš„ä»£ç ã€‚å¦‚æœæ¶‰åŠé€šè§£è¿˜ä¼šç›¸åº”çš„ä»£ç æ¨¡æ¿ã€‚

ä¸ºäº†æ–¹ä¾¿å„ä½åŒå­¦èƒ½å¤Ÿç”µè„‘ä¸Šè¿›è¡Œè°ƒè¯•å’Œæäº¤ä»£ç ï¼Œæˆ‘å»ºç«‹äº†ç›¸å…³çš„ä»“åº“ï¼šhttps://github.com/SharingSource/LogicStack-LeetCode ã€‚

åœ¨ä»“åº“åœ°å€é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°ç³»åˆ—æ–‡ç« çš„é¢˜è§£é“¾æ¥ã€ç³»åˆ—æ–‡ç« çš„ç›¸åº”ä»£ç ã€LeetCode åŸé¢˜é“¾æ¥å’Œå…¶ä»–ä¼˜é€‰é¢˜è§£ã€‚

