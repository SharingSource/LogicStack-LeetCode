### é¢˜ç›®æè¿°

è¿™æ˜¯ LeetCode ä¸Šçš„ **[686. é‡å¤å åŠ å­—ç¬¦ä¸²åŒ¹é…](https://leetcode-cn.com/problems/repeated-string-match/solution/gong-shui-san-xie-yi-ti-san-jie-qia-chan-3hbr/)** ï¼Œéš¾åº¦ä¸º **ä¸­ç­‰**ã€‚

Tag : ã€Œå­—ç¬¦ä¸²å“ˆå¸Œã€ã€ã€ŒKMPã€



ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸²Â `a` å’Œ `b`ï¼Œå¯»æ‰¾é‡å¤å åŠ å­—ç¬¦ä¸² `a` çš„æœ€å°æ¬¡æ•°ï¼Œä½¿å¾—å­—ç¬¦ä¸² `b` æˆä¸ºå åŠ åçš„å­—ç¬¦ä¸² `a` çš„å­ä¸²ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å› `-1`ã€‚

æ³¨æ„ï¼šå­—ç¬¦ä¸² `"abc"`Â é‡å¤å åŠ  `0` æ¬¡æ˜¯ `""`ï¼Œé‡å¤å åŠ  `1` æ¬¡æ˜¯Â `"abc"`ï¼Œé‡å¤å åŠ  `2` æ¬¡æ˜¯Â `"abcabc"`ã€‚

ç¤ºä¾‹ 1ï¼š
```
è¾“å…¥ï¼ša = "abcd", b = "cdabcdab"

è¾“å‡ºï¼š3

è§£é‡Šï¼ša é‡å¤å åŠ ä¸‰éåä¸º "abcdabcdabcd", æ­¤æ—¶ b æ˜¯å…¶å­ä¸²ã€‚
```
ç¤ºä¾‹ 2ï¼š
```
è¾“å…¥ï¼ša = "a", b = "aa"

è¾“å‡ºï¼š2
```
ç¤ºä¾‹ 3ï¼š
```
è¾“å…¥ï¼ša = "a", b = "a"

è¾“å‡ºï¼š1
```
ç¤ºä¾‹ 4ï¼š
```
è¾“å…¥ï¼ša = "abc", b = "wxyz"

è¾“å‡ºï¼š-1
```

æç¤ºï¼š
* $1 <= a.length <= 10^4$
* $1 <= b.length <= 10^4$
* `a` å’Œ `b` ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ

---

### åŸºæœ¬åˆ†æ

é¦–å…ˆï¼Œå¯ä»¥åˆ†æå¤åˆ¶æ¬¡æ•°çš„ã€Œä¸‹ç•Œã€å’Œã€Œä¸Šç•Œã€ä¸ºä½•å€¼ï¼š

**å¯¹äºã€Œä¸‹ç•Œã€çš„åˆ†ææ˜¯å®¹æ˜“çš„ï¼šè‡³å°‘å°† `a` å¤åˆ¶é•¿åº¦å¤§äºç­‰äº `b` çš„é•¿åº¦ï¼Œæ‰æœ‰å¯èƒ½åŒ¹é…ã€‚**

åœ¨æ˜ç¡®äº†ã€Œä¸‹ç•Œã€åï¼Œå†åˆ†æå†ç»è¿‡å¤šå°‘æ¬¡å¤åˆ¶ï¼Œèƒ½å¤Ÿæ˜ç¡®å¾—åˆ°ç­”æ¡ˆï¼Œèƒ½å¤Ÿå¾—åˆ°æ˜ç¡®ç­”æ¡ˆçš„æœ€å°å¤åˆ¶æ¬¡æ•°å³æ˜¯ä¸Šç•Œã€‚

**ç”±äºä¸»ä¸²æ˜¯ç”± `a` å¤åˆ¶å¤šæ¬¡è€Œæ¥ï¼Œå¹¶ä¸”æ˜¯ä»ä¸»ä¸²ä¸­æ‰¾åˆ°å­ä¸² `b`ï¼Œå› æ­¤å¯ä»¥æ˜ç¡®å­ä¸²çš„èµ·å§‹ä½ç½®ï¼Œä¸ä¼šè¶…è¿‡ `a` çš„é•¿åº¦ã€‚**

![image.png](https://pic.leetcode-cn.com/1640128316-fdWyyB-image.png)

å³**é•¿åº¦è¶Šè¿‡ `a` é•¿åº¦çš„èµ·å§‹åŒ¹é…ä½ç½®ï¼Œå¿…ç„¶åœ¨æ­¤å‰å·²ç»è¢«åŒ¹é…è¿‡äº†ã€‚**

ç”±æ­¤ï¼Œæˆ‘ä»¬å¯çŸ¥å¤åˆ¶æ¬¡æ•°ã€Œä¸Šç•Œã€æœ€å¤šä¸ºã€Œä¸‹ç•Œ + $1$ã€ã€‚

ä»¤ `a` çš„é•¿åº¦ä¸º $n$ï¼Œ`b` çš„é•¿åº¦ä¸º $m$ï¼Œä¸‹ç•Œæ¬¡æ•°ä¸º $c1$ï¼Œä¸Šç•Œæ¬¡æ•°ä¸º $c2 = c1 + 1$ã€‚

å› æ­¤æˆ‘ä»¬å¯ä»¥å¯¹ `a` å¤åˆ¶ $c2$ æ¬¡ï¼Œå¾—åˆ°ä¸»ä¸²ååŒ¹é… `b`ï¼Œå¦‚æœåŒ¹é…æˆåŠŸåçš„ç»“æŸä½ç½®ä¸è¶…è¿‡äº† $n * c1$ï¼Œè¯´æ˜å¤åˆ¶ $c1$ å³å¯ï¼Œè¿”å› $c1$ï¼Œè¶…è¿‡åˆ™è¿”å› $c2$ï¼›åŒ¹é…ä¸æˆåŠŸåˆ™è¿”å› $-1$ã€‚

---

### å¡å¸¸

è¿™æ˜¯æˆ‘æœ€å¼€å§‹çš„ AC ç‰ˆæœ¬ã€‚

è™½ç„¶è¿™æ˜¯é“æŒºæ˜¾ç„¶çš„å­ä¸²åŒ¹é…é—®é¢˜ï¼Œä½†æ˜¯æ˜¨æ™šæ¯”å¹³æ—¶æ™šç¡äº†ä¸€ä¸ªå¤šå°æ—¶ï¼Œæ—©ä¸Šèµ·æ¥ç²¾ç¥çŠ¶æ€ä¸æ˜¯å¾ˆå¥½ï¼Œèº«ä½“çš„æ¯ä¸ªç»†èƒéƒ½åœ¨æ‹’ç»å†™ KMP ğŸ¤£ 

å°±åŠ¨äº†æ­ªè„‘ç­‹å†™äº†ä¸ªã€Œå¡å¸¸ã€åšæ³•ã€‚

é€šè¿‡è¯¥åšæ³•å†æ¬¡å°è¯äº† LC çš„è¯„æµ‹æœºåˆ¶ååˆ†å¥‡è‘©ï¼šå±…ç„¶ä¸æ˜¯å¯¹æ¯ä¸ªç”¨ä¾‹å•ç‹¬è®¡æ—¶ï¼Œä¹Ÿä¸æ˜¯ç®—æ€»çš„ç”¨ä¾‹ç”¨æ—¶ï¼Œè€Œæ˜¯æ—¢ç®—å•ç”¨ä¾‹è€—æ—¶ï¼Œåˆç®—æ€»ç”¨æ—¶ï¼Ÿï¼Ÿ

å¯¼è‡´æˆ‘ç›´æ¥ `TLE` äº† $6$ æ¬¡æ‰é€šè¿‡ï¼ˆä» $700$ è¯•åˆ°äº† $100$ï¼‰ï¼Œå…¶ä¸­æœ‰ $4$ æ¬¡ `TLE` æ˜¯æ˜¾ç¤ºé€šè¿‡äº†æ‰€æœ‰æ ·ä¾‹ï¼Œä½†ä»ç„¶ `TLE`ï¼Œæˆ‘ä¸ç†è§£ä¸ºä»€ä¹ˆè¦è®¾ç½®è¿™æ ·è¿·æƒ‘çš„æœºåˆ¶ã€‚

å›åˆ°è¯¥åšæ³•æœ¬èº«ï¼Œé¦–å…ˆå¯¹ `a` è¿›è¡Œå¤åˆ¶ç¡®ä¿é•¿åº¦å¤§äºç­‰äº `b`ï¼Œç„¶ååœ¨ä¸€å®šæ—¶é—´å†…ï¼Œä¸æ–­çš„ã€Œå¤åˆ¶ - æ£€æŸ¥ã€ï¼Œå¦‚æœåœ¨è§„å®šæ—¶é—´å†…èƒ½å¤Ÿæ‰¾åˆ°åˆ™è¿”å›å¤åˆ¶æ¬¡æ•°ï¼Œå¦åˆ™è¿”å› `-1`ã€‚

ä»£ç ï¼š
```Java
import java.time.Clock;
class Solution {
    public int repeatedStringMatch(String a, String b) {
        StringBuilder sb = new StringBuilder();
        int ans = 0;
        while (sb.length() < b.length() && ++ans > 0) sb.append(a);
        Clock clock = Clock.systemDefaultZone();
        long start = clock.millis();
        while (clock.millis() - start < 100) {
            if (sb.indexOf(b) != -1) return ans;
            sb.append(a);
            ans++;
        }
        return -1;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼š$O(C)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(C)$

---

### ä¸Šä¸‹ç•Œæ€§è´¨

é€šè¿‡ã€ŒåŸºæœ¬åˆ†æã€åï¼Œæˆ‘ä»¬å‘ç°ã€Œä¸Šä¸‹ç•Œã€å…·æœ‰å‡†ç¡®çš„å¤§å°å…³ç³»ï¼Œå…¶å®ä¸éœ€è¦ç”¨åˆ°ã€Œå¡å¸¸ã€åšæ³•ã€‚

åªéœ€è¦è¿›è¡Œã€Œä¸Šç•Œã€æ¬¡å¤åˆ¶åï¼Œå°è¯•åŒ¹é…ï¼Œæ ¹æ®åŒ¹é…ç»“æœè¿”å›ç­”æ¡ˆå³å¯ã€‚

ä»£ç ï¼š
```Java
class Solution {
    public int repeatedStringMatch(String a, String b) {
        StringBuilder sb = new StringBuilder();
        int ans = 0;
        while (sb.length() < b.length() && ++ans > 0) sb.append(a);
        sb.append(a);
        int idx = sb.indexOf(b);
        if (idx == -1) return -1;
        return idx + b.length() > a.length() * ans ? ans + 1 : ans;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šéœ€è¦ $\left \lceil \frac{m}{n} \right \rceil + 1$ æ¬¡æ‹·è´ å’Œ ä¸€æ¬¡å­ä¸²åŒ¹é…ã€‚å¤æ‚åº¦ä¸º $O(n * (\left \lceil \frac{m}{n} \right \rceil + 1))$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n * (\left \lceil \frac{m}{n} \right \rceil + 1))$

---

### KMP

å…¶ä¸­ `indexOf` éƒ¨åˆ†å¯ä»¥é€šè¿‡ KMP/å­—ç¬¦ä¸²å“ˆå¸Œ å®ç°ï¼Œä¸ç†Ÿæ‚‰ KMP çš„åŒå­¦ï¼Œå¯ä»¥æŸ¥çœ‹ [ä¸€æ–‡è¯¦è§£ KMP ç®—æ³•](https://mp.weixin.qq.com/s?__biz=MzU4NDE3MTEyMA==&mid=2247486317&idx=1&sn=9c2ff2fa5db427133cce9c875064e7a4&chksm=fd9ca072caeb29642bf1f5c151e4d5aaff4dc10ba408b23222ea1672cfc41204a584fede5c05&token=1782709324&lang=zh_CN#rd)ï¼Œé‡Œé¢é€šè¿‡å¤§é‡é…å›¾è®²è§£äº† KMP çš„åŒ¹é…è¿‡ç¨‹ä¸æä¾›äº†å®ç”¨æ¨¡æ¿ã€‚

ä½¿ç”¨ KMP ä»£æ›¿ `indexOf` å¯ä»¥æœ‰æ•ˆåˆ©ç”¨ä¸»ä¸²æ˜¯ç”±å¤šä¸ª `a` å¤åˆ¶è€Œæ¥çš„æ€§è´¨ã€‚

ä»£ç ï¼š
```Java
class Solution {
    public int repeatedStringMatch(String a, String b) {
        StringBuilder sb = new StringBuilder();
        int ans = 0;
        while (sb.length() < b.length() && ++ans > 0) sb.append(a);
        sb.append(a);
        int idx = strStr(sb.toString(), b);
        if (idx == -1) return -1;
        return idx + b.length() > a.length() * ans ? ans + 1 : ans;
    }

    int strStr(String ss, String pp) {
        if (pp.isEmpty()) return 0;
        
        // åˆ†åˆ«è¯»å–åŸä¸²å’ŒåŒ¹é…ä¸²çš„é•¿åº¦
        int n = ss.length(), m = pp.length();
        // åŸä¸²å’ŒåŒ¹é…ä¸²å‰é¢éƒ½åŠ ç©ºæ ¼ï¼Œä½¿å…¶ä¸‹æ ‡ä» 1 å¼€å§‹
        ss = " " + ss;
        pp = " " + pp;

        char[] s = ss.toCharArray();
        char[] p = pp.toCharArray();

        // æ„å»º next æ•°ç»„ï¼Œæ•°ç»„é•¿åº¦ä¸ºåŒ¹é…ä¸²çš„é•¿åº¦ï¼ˆnext æ•°ç»„æ˜¯å’ŒåŒ¹é…ä¸²ç›¸å…³çš„ï¼‰
        int[] next = new int[m + 1];
        // æ„é€ è¿‡ç¨‹ i = 2ï¼Œj = 0 å¼€å§‹ï¼Œi å°äºç­‰äºåŒ¹é…ä¸²é•¿åº¦ ã€æ„é€  i ä» 2 å¼€å§‹ã€‘
        for (int i = 2, j = 0; i <= m; i++) {
            // åŒ¹é…ä¸æˆåŠŸçš„è¯ï¼Œj = next(j)
            while (j > 0 && p[i] != p[j + 1]) j = next[j];
            // åŒ¹é…æˆåŠŸçš„è¯ï¼Œå…ˆè®© j++
            if (p[i] == p[j + 1]) j++;
            // æ›´æ–° next[i]ï¼Œç»“æŸæœ¬æ¬¡å¾ªç¯ï¼Œi++
            next[i] = j;
        }

        // åŒ¹é…è¿‡ç¨‹ï¼Œi = 1ï¼Œj = 0 å¼€å§‹ï¼Œi å°äºç­‰äºåŸä¸²é•¿åº¦ ã€åŒ¹é… i ä» 1 å¼€å§‹ã€‘
        for (int i = 1, j = 0; i <= n; i++) {
            // åŒ¹é…ä¸æˆåŠŸ j = next(j)
            while (j > 0 && s[i] != p[j + 1]) j = next[j];
            // åŒ¹é…æˆåŠŸçš„è¯ï¼Œå…ˆè®© j++ï¼Œç»“æŸæœ¬æ¬¡å¾ªç¯å i++
            if (s[i] == p[j + 1]) j++;
            // æ•´ä¸€æ®µåŒ¹é…æˆåŠŸï¼Œç›´æ¥è¿”å›ä¸‹æ ‡
            if (j == m) return i - m;
        }
        return -1;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šéœ€è¦ $\left \lceil \frac{m}{n} \right \rceil + 1$ æ¬¡æ‹·è´ å’Œ ä¸€æ¬¡å­ä¸²åŒ¹é…ã€‚å¤æ‚åº¦ä¸º $O(n * (\left \lceil \frac{m}{n} \right \rceil + 1))$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n * (\left \lceil \frac{m}{n} \right \rceil + 1))$

---

### å­—ç¬¦ä¸²å“ˆå¸Œ

ç»“åˆã€ŒåŸºæœ¬åˆ†æã€ï¼Œæˆ‘ä»¬çŸ¥é“è¿™æœ¬è´¨æ˜¯ä¸€ä¸ªå­ä¸²åŒ¹é…é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ã€Œå­—ç¬¦ä¸²å“ˆå¸Œã€æ¥è§£å†³ã€‚

ä»¤ `a` çš„é•¿åº¦ä¸º $n$ï¼Œ`b` çš„é•¿åº¦ä¸º $m$ã€‚

ä»ç„¶æ˜¯å…ˆå°† `a` å¤åˆ¶ã€Œä¸Šç•Œã€æ¬¡ï¼Œå¾—åˆ°ä¸»ä¸² `ss`ï¼Œç›®çš„æ˜¯ä» `ss` ä¸­æ£€æµ‹æ˜¯å¦å­˜åœ¨å­ä¸²ä¸º `b`ã€‚

åœ¨å­—ç¬¦ä¸²å“ˆå¸Œä¸­ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å°† `ss` å’Œ `b` è¿›è¡Œæ‹¼æ¥ï¼Œè®¾æ‹¼æ¥åé•¿åº¦ä¸º $len$ï¼Œé‚£ä¹ˆ `b` ä¸²çš„å“ˆå¸Œå€¼ä¸º $[len - m + 1, len]$ éƒ¨åˆ†ï¼ˆä¸‹æ ‡ä» $1$ å¼€å§‹ï¼‰ï¼Œè®°ä¸º $target$ã€‚

ç„¶ååœ¨ $[1, n]$ èŒƒå›´å†…æšä¸¾èµ·ç‚¹ï¼Œå°è¯•æ‰¾é•¿åº¦ä¸º $m$ çš„å“ˆå¸Œå€¼ä¸ $target$ ç›¸åŒçš„å“ˆå¸Œå€¼ã€‚

ä»£ç ï¼š
```Java
class Solution {
    public int repeatedStringMatch(String a, String b) {
        StringBuilder sb = new StringBuilder();
        int ans = 0;
        while (sb.length() < b.length() && ++ans > 0) sb.append(a);
        sb.append(a);
        int idx = strHash(sb.toString(), b);
        if (idx == -1) return -1;
        return idx + b.length() > a.length() * ans ? ans + 1 : ans;
    }
    int strHash(String ss, String b) {
        int P = 131;
        int n = ss.length(), m = b.length();
        String str = ss + b;
        int len = str.length();
        int[] h = new int[len + 10], p = new int[len + 10];
        h[0] = 0; p[0] = 1;
        for (int i = 0; i < len; i++) {
            p[i + 1] = p[i] * P;
            h[i + 1] = h[i] * P + str.charAt(i);
        }
        int r = len, l = r - m + 1;
        int target = h[r] - h[l - 1] * p[r - l + 1]; // b çš„å“ˆå¸Œå€¼
        for (int i = 1; i <= n; i++) {
            int j = i + m - 1;
            int cur = h[j] - h[i - 1] * p[j - i + 1]; // å­ä¸²å“ˆå¸Œå€¼
            if (cur == target) return i - 1;
        }
        return -1;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šéœ€è¦ $\left \lceil \frac{m}{n} \right \rceil + 1$ æ¬¡æ‹·è´ å’Œ ä¸€æ¬¡å­ä¸²åŒ¹é…ã€‚å¤æ‚åº¦ä¸º $O(n * (\left \lceil \frac{m}{n} \right \rceil + 1))$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n * (\left \lceil \frac{m}{n} \right \rceil + 1))$

---

### æœ€å

è¿™æ˜¯æˆ‘ä»¬ã€Œåˆ·ç©¿ LeetCodeã€ç³»åˆ—æ–‡ç« çš„ç¬¬ `No.686` ç¯‡ï¼Œç³»åˆ—å¼€å§‹äº 2021/01/01ï¼Œæˆªæ­¢äºèµ·å§‹æ—¥ LeetCode ä¸Šå…±æœ‰ 1916 é“é¢˜ç›®ï¼Œéƒ¨åˆ†æ˜¯æœ‰é”é¢˜ï¼Œæˆ‘ä»¬å°†å…ˆæŠŠæ‰€æœ‰ä¸å¸¦é”çš„é¢˜ç›®åˆ·å®Œã€‚

åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« é‡Œé¢ï¼Œé™¤äº†è®²è§£è§£é¢˜æ€è·¯ä»¥å¤–ï¼Œè¿˜ä¼šå°½å¯èƒ½ç»™å‡ºæœ€ä¸ºç®€æ´çš„ä»£ç ã€‚å¦‚æœæ¶‰åŠé€šè§£è¿˜ä¼šç›¸åº”çš„ä»£ç æ¨¡æ¿ã€‚

ä¸ºäº†æ–¹ä¾¿å„ä½åŒå­¦èƒ½å¤Ÿç”µè„‘ä¸Šè¿›è¡Œè°ƒè¯•å’Œæäº¤ä»£ç ï¼Œæˆ‘å»ºç«‹äº†ç›¸å…³çš„ä»“åº“ï¼šhttps://github.com/SharingSource/LogicStack-LeetCode ã€‚

åœ¨ä»“åº“åœ°å€é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°ç³»åˆ—æ–‡ç« çš„é¢˜è§£é“¾æ¥ã€ç³»åˆ—æ–‡ç« çš„ç›¸åº”ä»£ç ã€LeetCode åŸé¢˜é“¾æ¥å’Œå…¶ä»–ä¼˜é€‰é¢˜è§£ã€‚

