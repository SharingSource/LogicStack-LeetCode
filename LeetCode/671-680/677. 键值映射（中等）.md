### é¢˜ç›®æè¿°

è¿™æ˜¯ LeetCode ä¸Šçš„ **[677. é”®å€¼æ˜ å°„](https://leetcode-cn.com/problems/map-sum-pairs/solution/gong-shui-san-xie-jie-he-dfs-de-trie-yun-i4xa/)** ï¼Œéš¾åº¦ä¸º **ä¸­ç­‰**ã€‚

Tag : ã€Œå­—å…¸æ ‘ã€ã€ã€ŒDFSã€ã€ã€Œå“ˆå¸Œè¡¨ã€



å®ç°ä¸€ä¸ª MapSum ç±»ï¼Œæ”¯æŒä¸¤ä¸ªæ–¹æ³•ï¼ŒinsertÂ å’ŒÂ sumï¼š

* `MapSum()` åˆå§‹åŒ– `MapSum` å¯¹è±¡
* `void insert(String key, int val)` æ’å…¥ `key-val` é”®å€¼å¯¹ï¼Œå­—ç¬¦ä¸²è¡¨ç¤ºé”® `key` ï¼Œæ•´æ•°è¡¨ç¤ºå€¼ `val` ã€‚å¦‚æœé”® `key` å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆåŸæ¥çš„é”®å€¼å¯¹å°†è¢«æ›¿ä»£æˆæ–°çš„é”®å€¼å¯¹ã€‚
* `int sum(string prefix)` è¿”å›æ‰€æœ‰ä»¥è¯¥å‰ç¼€ `prefix` å¼€å¤´çš„é”® `key` çš„å€¼çš„æ€»å’Œã€‚

ç¤ºä¾‹ï¼š
```
è¾“å…¥ï¼š
["MapSum", "insert", "sum", "insert", "sum"]
[[], ["apple", 3], ["ap"], ["app", 2], ["ap"]]

è¾“å‡ºï¼š
[null, null, 3, null, 5]

è§£é‡Šï¼š
MapSum mapSum = new MapSum();
mapSum.insert("apple", 3);  
mapSum.sum("ap");           // return 3 (apple = 3)
mapSum.insert("app", 2);    
mapSum.sum("ap");           // return 5 (apple + app = 3 + 2 = 5)
```

æç¤ºï¼š
* `1 <= key.length, prefix.length <= 50`
* `key` å’Œ `prefix` ä»…ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆ
* `1 <= val <= 1000`
* æœ€å¤šè°ƒç”¨ `50` æ¬¡ `insert` å’Œ `sum`

---

### Trie + DFS

ä»éœ€è¦å®ç°ã€Œå­˜å‚¨å­—ç¬¦ä¸²ï¼ˆæ˜ å°„å…³ç³»ï¼‰ã€å¹¶ã€Œæ£€ç´¢æŸä¸ªå­—ç¬¦ä¸²å‰ç¼€çš„æ€»å’Œã€æ¥çœ‹ï¼Œå¯ä»¥çŸ¥é“è¿™æ˜¯ä¸ $Trie$ ç›¸å…³çš„é¢˜ç›®ï¼Œè¿˜ä¸äº†è§£ $Trie$ çš„åŒå­¦å¯ä»¥å…ˆçœ‹å‰ç½® ğŸ§€ï¼š[å®ç° Trie (å‰ç¼€æ ‘)](https://mp.weixin.qq.com/s?__biz=MzU4NDE3MTEyMA==&mid=2247488490&idx=1&sn=db2998cb0e5f08684ee1b6009b974089&chksm=fd9cb8f5caeb31e3f7f67dba981d8d01a24e26c93ead5491edb521c988adc0798d8acb6f9e9d&token=59039721&lang=zh_CN#rd) ã€‚

è€ƒè™‘å¦‚ä½•å®ç°ä¸¤ä¸ªæ“ä½œï¼š

* `insert` ï¼šåœ¨åŸºæœ¬çš„ $Trie$ æ’å…¥æ“ä½œçš„åŸºç¡€ä¸Šè¿›è¡Œæ‹“å±•å³å¯ã€‚ä¸å¸¸è§„çš„æ’å…¥æ“ä½œçš„å”¯ä¸€åŒºåˆ«ä¸ºï¼Œä¸èƒ½ç®€å•è®°å½•å•è¯çš„ç»“æŸä½ç½®ï¼Œè¿˜è¦å­˜å‚¨ $key$ å¯¹åº”çš„ $val$ æ˜¯å¤šå°‘ã€‚å…·ä½“çš„æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `int` ç±»å‹çš„æ•°ç»„ $hash$ æ¥ä»£æ›¿åŸæœ‰çš„ `boolean` ç±»å‹çš„æ•°ç»„ $isWord$ï¼›

* `sum` ï¼š å…ˆå¯¹å…¥å‚ $prefix$ è¿›è¡Œå­—å…¸æ ‘æœç´¢ï¼Œåˆ°è¾¾å°¾éƒ¨åå†ä½¿ç”¨ `DFS` æœç´¢åé¢çš„æ‰€æœ‰æ–¹æ¡ˆï¼Œå¹¶ç´¯åŠ ç»“æœã€‚

ä»£ç ï¼ˆ`static` ä¼˜åŒ–ä»£ç è§ $P2$ï¼Œé¿å…æ¯ä¸ªæ ·ä¾‹éƒ½ `new` å¤§æ•°ç»„ï¼‰ï¼š
```Java
class MapSum {
    int[][] tr = new int[2510][26];
    int[] hash = new int[2510];
    int idx;
    public void insert(String key, int val) {
        int p = 0;
        for (int i = 0; i < key.length(); i++) {
            int u = key.charAt(i) - 'a';
            if (tr[p][u] == 0) tr[p][u] = ++idx;
            p = tr[p][u];
        }
        hash[p] = val;
    }
    public int sum(String prefix) {
        int p = 0;
        for (int i = 0; i < prefix.length(); i++) {
            int u = prefix.charAt(i) - 'a';
            if (tr[p][u] == 0) return 0;
            p = tr[p][u];
        }
        return dfs(p);
    }
    int dfs(int p) {
        int ans = hash[p];
        for (int u = 0; u < 26; u++) {
            if (tr[p][u] != 0) ans += dfs(tr[p][u]);
        }
        return ans;
    }
}
```


```Java
class MapSum {
    static int[][] tr = new int[2510][26];
    static int[] hash = new int[2510];
    static int idx;
    public MapSum() {
        for (int i = 0; i <= idx; i++) Arrays.fill(tr[i], 0);
        Arrays.fill(hash, 0);
        idx = 0;
    }
    public void insert(String key, int val) {
        int p = 0;
        for (int i = 0; i < key.length(); i++) {
            int u = key.charAt(i) - 'a';
            if (tr[p][u] == 0) tr[p][u] = ++idx;
            p = tr[p][u];
        }
        hash[p] = val;
    }
    public int sum(String prefix) {
        int p = 0;
        for (int i = 0; i < prefix.length(); i++) {
            int u = prefix.charAt(i) - 'a';
            if (tr[p][u] == 0) return 0;
            p = tr[p][u];
        }
        return dfs(p);
    }
    int dfs(int p) {
        int ans = hash[p];
        for (int u = 0; u < 26; u++) {
            if (tr[p][u] != 0) ans += dfs(tr[p][u]);
        }
        return ans;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šä»¤ $key$ çš„æœ€å¤§é•¿åº¦ä¸º $n$ï¼Œæœ€å¤§è°ƒç”¨æ¬¡æ•°ä¸º $m$ï¼Œå­—ç¬¦é›†å¤§å°ä¸º $C$ï¼ˆ æœ¬é¢˜ $C$ å›ºå®šä¸º $26$ ï¼‰ï¼Œ`insert` æ“ä½œçš„å¤æ‚åº¦ä¸º $O(n)$ï¼›ä» `DFS` çš„è§’åº¦åˆ†æï¼Œ`sum` æ“ä½œçš„å¤æ‚åº¦ä¸º $O(C^n)$ï¼Œä½†äº‹å®ä¸Šï¼Œå¯¹äºæœ¬é¢˜å…·æœ‰æ˜ç¡®çš„è®¡ç®—é‡ä¸Šç•Œï¼Œæœç´¢æ‰€æœ‰çš„æ ¼å­çš„å¤æ‚åº¦ä¸º $O(n * m * C)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n * m * C)$

---

### Trie è®°å½•å‰ç¼€å­—ç¬¦ä¸²æ€»å’Œ

ä¸ºé™ä½ `sum` æ“ä½œçš„å¤æ‚åº¦ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ `insert` æ“ä½œä¸­åŒæ—¶è®°å½•ï¼ˆç´¯åŠ ï¼‰æ¯ä¸ªå‰ç¼€çš„æ€»å’Œã€‚

ä»£ç ï¼ˆ`static` ä¼˜åŒ–ä»£ç è§ $P2$ï¼Œé¿å…æ¯ä¸ªæ ·ä¾‹éƒ½ `new` å¤§æ•°ç»„ï¼‰ï¼š
```Java
class MapSum {
    int N = 2510;
    int[][] tr = new int[N][26];
    int[] hash = new int[N];
    int idx;
    Map<String, Integer> map = new HashMap<>();
    public void insert(String key, int val) {
        int _val = val;
        if (map.containsKey(key)) val -= map.get(key);
        map.put(key, _val);
        for (int i = 0, p = 0; i < key.length(); i++) {
            int u = key.charAt(i) - 'a';
            if (tr[p][u] == 0) tr[p][u] = ++idx;
            p = tr[p][u];
            hash[p] += val;
        }
    }
    public int sum(String prefix) {
        int p = 0;
        for (int i = 0; i < prefix.length(); i++) {
            int u = prefix.charAt(i) - 'a';
            if (tr[p][u] == 0) return 0;
            p = tr[p][u];
        }
        return hash[p];
    }
}
```


```Java
class MapSum {
    static int N = 2510;
    static int[][] tr = new int[N][26];
    static int[] hash = new int[N];
    static int idx;
    static Map<String, Integer> map = new HashMap<>();
    public MapSum() {
        for (int i = 0; i <= idx; i++) Arrays.fill(tr[i], 0);
        Arrays.fill(hash, 0);
        idx = 0;
        map.clear();
    }
    public void insert(String key, int val) {
        int _val = val;
        if (map.containsKey(key)) val -= map.get(key);
        map.put(key, _val);
        for (int i = 0, p = 0; i < key.length(); i++) {
            int u = key.charAt(i) - 'a';
            if (tr[p][u] == 0) tr[p][u] = ++idx;
            p = tr[p][u];
            hash[p] += val;
        }
    }
    public int sum(String prefix) {
        int p = 0;
        for (int i = 0; i < prefix.length(); i++) {
            int u = prefix.charAt(i) - 'a';
            if (tr[p][u] == 0) return 0;
            p = tr[p][u];
        }
        return hash[p];
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šä»¤ $key$ çš„æœ€å¤§é•¿åº¦ä¸º $n$ï¼Œ`insert` æ“ä½œçš„å¤æ‚åº¦ä¸º $O(n)$ï¼›`sum` æ“ä½œçš„å¤æ‚åº¦ä¸º $O(n)$
* ç©ºé—´å¤æ‚åº¦ï¼šä»¤ $key$ çš„æœ€å¤§é•¿åº¦ä¸º $n$ï¼Œæœ€å¤§è°ƒç”¨æ¬¡æ•°ä¸º $m$ï¼Œå­—ç¬¦é›†å¤§å°ä¸º $C$ï¼ˆ æœ¬é¢˜ $C$ å›ºå®šä¸º $26$ ï¼‰ï¼Œå¤æ‚åº¦ä¸º $O(n * m * C)$

---

### æœ€å

è¿™æ˜¯æˆ‘ä»¬ã€Œåˆ·ç©¿ LeetCodeã€ç³»åˆ—æ–‡ç« çš„ç¬¬ `No.677` ç¯‡ï¼Œç³»åˆ—å¼€å§‹äº 2021/01/01ï¼Œæˆªæ­¢äºèµ·å§‹æ—¥ LeetCode ä¸Šå…±æœ‰ 1916 é“é¢˜ç›®ï¼Œéƒ¨åˆ†æ˜¯æœ‰é”é¢˜ï¼Œæˆ‘ä»¬å°†å…ˆæŠŠæ‰€æœ‰ä¸å¸¦é”çš„é¢˜ç›®åˆ·å®Œã€‚

åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« é‡Œé¢ï¼Œé™¤äº†è®²è§£è§£é¢˜æ€è·¯ä»¥å¤–ï¼Œè¿˜ä¼šå°½å¯èƒ½ç»™å‡ºæœ€ä¸ºç®€æ´çš„ä»£ç ã€‚å¦‚æœæ¶‰åŠé€šè§£è¿˜ä¼šç›¸åº”çš„ä»£ç æ¨¡æ¿ã€‚

ä¸ºäº†æ–¹ä¾¿å„ä½åŒå­¦èƒ½å¤Ÿç”µè„‘ä¸Šè¿›è¡Œè°ƒè¯•å’Œæäº¤ä»£ç ï¼Œæˆ‘å»ºç«‹äº†ç›¸å…³çš„ä»“åº“ï¼šhttps://github.com/SharingSource/LogicStack-LeetCode ã€‚

åœ¨ä»“åº“åœ°å€é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°ç³»åˆ—æ–‡ç« çš„é¢˜è§£é“¾æ¥ã€ç³»åˆ—æ–‡ç« çš„ç›¸åº”ä»£ç ã€LeetCode åŸé¢˜é“¾æ¥å’Œå…¶ä»–ä¼˜é€‰é¢˜è§£ã€‚

