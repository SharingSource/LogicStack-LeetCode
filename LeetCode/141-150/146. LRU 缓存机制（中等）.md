### é¢˜ç›®æè¿°

è¿™æ˜¯ LeetCode ä¸Šçš„ **[146. LRU ç¼“å­˜æœºåˆ¶](https://leetcode-cn.com/problems/lru-cache/solution/gong-shui-san-xie-she-ji-shu-ju-jie-gou-68hv2/)** ï¼Œéš¾åº¦ä¸º **ä¸­ç­‰**ã€‚

Tag : ã€Œè®¾è®¡ã€ã€ã€Œé“¾è¡¨ã€ã€ã€Œå“ˆå¸Œè¡¨ã€



è¿ç”¨ä½ æ‰€æŒæ¡çš„æ•°æ®ç»“æ„ï¼Œè®¾è®¡å’Œå®ç°ä¸€ä¸ªÂ  `LRU` (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜æœºåˆ¶ ã€‚
å®ç° `LRUCache` ç±»ï¼š

* `LRUCache(int capacity)` ä»¥æ­£æ•´æ•°ä½œä¸ºå®¹é‡Â `capacity` åˆå§‹åŒ– `LRU` ç¼“å­˜
* `int get(int key)` å¦‚æœå…³é”®å­— `key` å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è¿”å›å…³é”®å­—çš„å€¼ï¼Œå¦åˆ™è¿”å› $-1$ 
* `void put(int key, int value)`Â å¦‚æœå…³é”®å­—å·²ç»å­˜åœ¨ï¼Œåˆ™å˜æ›´å…¶æ•°æ®å€¼ï¼›å¦‚æœå…³é”®å­—ä¸å­˜åœ¨ï¼Œåˆ™æ’å…¥è¯¥ç»„ã€Œå…³é”®å­—-å€¼ã€ã€‚å½“ç¼“å­˜å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå®ƒåº”è¯¥åœ¨å†™å…¥æ–°æ•°æ®ä¹‹å‰åˆ é™¤æœ€ä¹…æœªä½¿ç”¨çš„æ•°æ®å€¼ï¼Œä»è€Œä¸ºæ–°çš„æ•°æ®å€¼ç•™å‡ºç©ºé—´ã€‚

è¿›é˜¶ï¼šä½ æ˜¯å¦å¯ä»¥åœ¨Â $O(1)$ æ—¶é—´å¤æ‚åº¦å†…å®Œæˆè¿™ä¸¤ç§æ“ä½œï¼Ÿ

ç¤ºä¾‹ï¼š
```
è¾“å…¥
["LRUCache", "put", "put", "get", "put", "get", "put", "get", "get", "get"]
[[2], [1, 1], [2, 2], [1], [3, 3], [2], [4, 4], [1], [3], [4]]
è¾“å‡º
[null, null, null, 1, null, -1, null, -1, 3, 4]

è§£é‡Š
LRUCache lRUCache = new LRUCache(2);
lRUCache.put(1, 1); // ç¼“å­˜æ˜¯ {1=1}
lRUCache.put(2, 2); // ç¼“å­˜æ˜¯ {1=1, 2=2}
lRUCache.get(1);    // è¿”å› 1
lRUCache.put(3, 3); // è¯¥æ“ä½œä¼šä½¿å¾—å…³é”®å­— 2 ä½œåºŸï¼Œç¼“å­˜æ˜¯ {1=1, 3=3}
lRUCache.get(2);    // è¿”å› -1 (æœªæ‰¾åˆ°)
lRUCache.put(4, 4); // è¯¥æ“ä½œä¼šä½¿å¾—å…³é”®å­— 1 ä½œåºŸï¼Œç¼“å­˜æ˜¯ {4=4, 3=3}
lRUCache.get(1);    // è¿”å› -1 (æœªæ‰¾åˆ°)
lRUCache.get(3);    // è¿”å› 3
lRUCache.get(4);    // è¿”å› 4
```

æç¤ºï¼š
* $1 <= capacity <= 3000$
* $0 <= key <= 3000$
* $0 <= value <= 10^4$
* æœ€å¤šè°ƒç”¨ $3 * 10^4$ æ¬¡ `get` å’Œ `put`

---

### åŸºæœ¬åˆ†æ

LRU æ˜¯ä¸€ç§ååˆ†å¸¸è§çš„é¡µé¢ç½®æ¢ç®—æ³•ã€‚

å°† LRU ç¿»è¯‘æˆå¤§ç™½è¯å°±æ˜¯ï¼š**å½“ä¸å¾—ä¸æ·˜æ±°æŸäº›æ•°æ®æ—¶ï¼ˆé€šå¸¸æ˜¯å®¹é‡å·²æ»¡ï¼‰ï¼Œé€‰æ‹©æœ€ä¹…æœªè¢«ä½¿ç”¨çš„æ•°æ®è¿›è¡Œæ·˜æ±°ã€‚**

**é¢˜ç›®è®©æˆ‘ä»¬å®ç°ä¸€ä¸ªå®¹é‡å›ºå®šçš„ `LRUCache` ã€‚å¦‚æœæ’å…¥æ•°æ®æ—¶ï¼Œå‘ç°å®¹å™¨å·²æ»¡æ—¶ï¼Œåˆ™å…ˆæŒ‰ç…§ LRU è§„åˆ™æ·˜æ±°ä¸€ä¸ªæ•°æ®ï¼Œå†å°†æ–°æ•°æ®æ’å…¥ï¼Œå…¶ä¸­ã€Œæ’å…¥ã€å’Œã€ŒæŸ¥è¯¢ã€éƒ½ç®—ä½œä¸€æ¬¡â€œä½¿ç”¨â€ã€‚**

å¯ä»¥é€šè¿‡ ğŸŒ° æ¥ç†è§£ï¼Œå‡è®¾æˆ‘ä»¬æœ‰å®¹é‡ä¸º $2$ çš„ `LRUCache` å’Œ æµ‹è¯•é”®å€¼å¯¹ `[1-1,2-2,3-3]` ï¼Œå°†å…¶æŒ‰ç…§é¡ºåºè¿›è¡Œæ’å…¥ & æŸ¥è¯¢ï¼š
* æ’å…¥ `1-1`ï¼Œæ­¤æ—¶æœ€æ–°çš„ä½¿ç”¨æ•°æ®ä¸º `1-1`
* æ’å…¥ `2-2`ï¼Œæ­¤æ—¶æœ€æ–°ä½¿ç”¨æ•°æ®å˜ä¸º `2-2`
* æŸ¥è¯¢ `1-1`ï¼Œæ­¤æ—¶æœ€æ–°ä½¿ç”¨æ•°æ®ä¸º `1-1`
* æ’å…¥ `3-3`ï¼Œç”±äºå®¹å™¨å·²ç»è¾¾åˆ°å®¹é‡ï¼Œéœ€è¦å…ˆæ·˜æ±°å·²æœ‰æ•°æ®æ‰èƒ½æ’å…¥ï¼Œè¿™æ—¶å€™ä¼šæ·˜æ±° `2-2`ï¼Œ`3-3` æˆä¸ºæœ€æ–°ä½¿ç”¨æ•°æ®

é”®å€¼å¯¹å­˜å‚¨æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ã€Œå“ˆå¸Œè¡¨ã€æ¥ç¡®ä¿æ’å…¥å’ŒæŸ¥è¯¢çš„å¤æ‚åº¦ä¸º $O(1)$ã€‚

å¦å¤–æˆ‘ä»¬è¿˜éœ€è¦é¢å¤–ç»´æŠ¤ä¸€ä¸ªã€Œä½¿ç”¨é¡ºåºã€åºåˆ—ã€‚

æˆ‘ä»¬æœŸæœ›å½“ã€Œæ–°æ•°æ®è¢«æ’å…¥ã€æˆ–ã€Œå‘ç”Ÿé”®å€¼å¯¹æŸ¥è¯¢ã€æ—¶ï¼Œèƒ½å¤Ÿå°†å½“å‰é”®å€¼å¯¹æ”¾åˆ°åºåˆ—å¤´éƒ¨ï¼Œè¿™æ ·å½“è§¦å‘ LRU æ·˜æ±°æ—¶ï¼Œåªéœ€è¦ä»åºåˆ—å°¾éƒ¨è¿›è¡Œæ•°æ®åˆ é™¤å³å¯ã€‚

**æœŸæœ›åœ¨ $O(1)$ å¤æ‚åº¦å†…è°ƒæ•´æŸä¸ªèŠ‚ç‚¹åœ¨åºåˆ—ä¸­çš„ä½ç½®ï¼Œå¾ˆè‡ªç„¶æƒ³åˆ°åŒå‘é“¾è¡¨ã€‚**

----

### åŒå‘é“¾è¡¨

å…·ä½“çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨å“ˆå¸Œè¡¨æ¥å­˜å‚¨ã€Œé”®å€¼å¯¹ã€ï¼Œé”®å€¼å¯¹çš„é”®ä½œä¸ºå“ˆå¸Œè¡¨çš„ Keyï¼Œè€Œå“ˆå¸Œè¡¨çš„ Value åˆ™ä½¿ç”¨æˆ‘ä»¬è‡ªå·±å°è£…çš„ `Node` ç±»ï¼Œ`Node` åŒæ—¶ä½œä¸ºåŒå‘é“¾è¡¨çš„èŠ‚ç‚¹ã€‚

* æ’å…¥ï¼šæ£€æŸ¥å½“å‰é”®å€¼å¯¹æ˜¯å¦å·²ç»å­˜åœ¨äºå“ˆå¸Œè¡¨ï¼š
	
	* å¦‚æœå­˜åœ¨ï¼Œåˆ™æ›´æ–°é”®å€¼å¯¹ï¼Œå¹¶å°†å½“å‰é”®å€¼å¯¹æ‰€å¯¹åº”çš„ `Node` èŠ‚ç‚¹è°ƒæ•´åˆ°é“¾è¡¨å¤´éƒ¨ï¼ˆ`refresh` æ“ä½œï¼‰
	
	* å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ£€æŸ¥å“ˆå¸Œè¡¨å®¹é‡æ˜¯å¦å·²ç»è¾¾åˆ°å®¹é‡ï¼š
		* æ²¡è¾¾åˆ°å®¹é‡ï¼šæ’å…¥å“ˆå¸Œè¡¨ï¼Œå¹¶å°†å½“å‰é”®å€¼å¯¹æ‰€å¯¹åº”çš„ `Node` èŠ‚ç‚¹è°ƒæ•´åˆ°é“¾è¡¨å¤´éƒ¨ï¼ˆ`refresh` æ“ä½œï¼‰
		* å·²è¾¾åˆ°å®¹é‡ï¼šå…ˆä»é“¾è¡¨å°¾éƒ¨æ‰¾åˆ°å¾…åˆ é™¤å…ƒç´ è¿›è¡Œåˆ é™¤ï¼ˆ`delete` æ“ä½œï¼‰ï¼Œç„¶åå†æ’å…¥å“ˆå¸Œè¡¨ï¼Œå¹¶å°†å½“å‰é”®å€¼å¯¹æ‰€å¯¹åº”çš„ `Node` èŠ‚ç‚¹è°ƒæ•´åˆ°é“¾è¡¨å¤´éƒ¨ï¼ˆ`refresh` æ“ä½œï¼‰

* æŸ¥è¯¢ï¼šå¦‚æœæ²¡åœ¨å“ˆå¸Œè¡¨ä¸­æ‰¾åˆ°è¯¥ Keyï¼Œç›´æ¥è¿”å› $-1$ï¼›å¦‚æœå­˜åœ¨è¯¥ Keyï¼Œåˆ™å°†å¯¹åº”çš„å€¼è¿”å›ï¼Œå¹¶å°†å½“å‰é”®å€¼å¯¹æ‰€å¯¹åº”çš„ `Node` èŠ‚ç‚¹è°ƒæ•´åˆ°é“¾è¡¨å¤´éƒ¨ï¼ˆ`refresh` æ“ä½œï¼‰

ä¸€äº›ç»†èŠ‚ï¼š ä¸ºäº†å‡å°‘åŒå‘é“¾è¡¨å·¦å³èŠ‚ç‚¹çš„ã€Œåˆ¤ç©ºã€æ“ä½œï¼Œæˆ‘ä»¬é¢„å…ˆå»ºç«‹ä¸¤ä¸ªã€Œå“¨å…µã€èŠ‚ç‚¹ `head` å’Œ `tail`ã€‚

ä»£ç ï¼š
```Java []
class LRUCache {
    class Node {
        int k, v;
        Node l, r;
        Node(int _k, int _v) {
            k = _k;
            v = _v;
        }
    }
    int n;
    Node head, tail;
    Map<Integer, Node> map;
    public LRUCache(int capacity) {
        n = capacity;
        map = new HashMap<>();
        head = new Node(-1, -1);
        tail = new Node(-1, -1);
        head.r = tail;
        tail.l = head;
    }
    
    public int get(int key) {
        if (map.containsKey(key)) {
            Node node = map.get(key);
            refresh(node);
            return node.v;
        } 
        return -1;
    }
    
    public void put(int key, int value) {
        Node node = null;
        if (map.containsKey(key)) {
            node = map.get(key);
            node.v = value;
        } else {
            if (map.size() == n) {
                Node del = tail.l;
                map.remove(del.k);
                delete(del);
            }
            node = new Node(key, value);
            map.put(key, node);
        }
        refresh(node);
    }
	
    // refresh æ“ä½œåˆ†ä¸¤æ­¥ï¼š
    // 1. å…ˆå°†å½“å‰èŠ‚ç‚¹ä»åŒå‘é“¾è¡¨ä¸­åˆ é™¤ï¼ˆå¦‚æœè¯¥èŠ‚ç‚¹æœ¬èº«å­˜åœ¨äºåŒå‘é“¾è¡¨ä¸­çš„è¯ï¼‰
    // 2. å°†å½“å‰èŠ‚ç‚¹æ·»åŠ åˆ°åŒå‘é“¾è¡¨å¤´éƒ¨
    void refresh(Node node) {
        delete(node);
        node.r = head.r;
        node.l = head;
        head.r.l = node;
        head.r = node;
    }
	
    // delete æ“ä½œï¼šå°†å½“å‰èŠ‚ç‚¹ä»åŒå‘é“¾è¡¨ä¸­ç§»é™¤
    // ç”±äºæˆ‘ä»¬é¢„å…ˆå»ºç«‹ head å’Œ tail ä¸¤ä½å“¨å…µï¼Œå› æ­¤å¦‚æœ node.l ä¸ä¸ºç©ºï¼Œåˆ™ä»£è¡¨äº† node æœ¬èº«å­˜åœ¨äºåŒå‘é“¾è¡¨ï¼ˆä¸æ˜¯æ–°èŠ‚ç‚¹ï¼‰
    void delete(Node node) {
        if (node.l != null) {
            Node left = node.l;
            left.r = node.r;
            node.r.l = left;
        }
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šå„æ“ä½œå‡ä¸º $O(1)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

---

### æœ€å

è¿™æ˜¯æˆ‘ä»¬ã€Œåˆ·ç©¿ LeetCodeã€ç³»åˆ—æ–‡ç« çš„ç¬¬ `No.146` ç¯‡ï¼Œç³»åˆ—å¼€å§‹äº 2021/01/01ï¼Œæˆªæ­¢äºèµ·å§‹æ—¥ LeetCode ä¸Šå…±æœ‰ 1916 é“é¢˜ç›®ï¼Œéƒ¨åˆ†æ˜¯æœ‰é”é¢˜ï¼Œæˆ‘ä»¬å°†å…ˆæŠŠæ‰€æœ‰ä¸å¸¦é”çš„é¢˜ç›®åˆ·å®Œã€‚

åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« é‡Œé¢ï¼Œé™¤äº†è®²è§£è§£é¢˜æ€è·¯ä»¥å¤–ï¼Œè¿˜ä¼šå°½å¯èƒ½ç»™å‡ºæœ€ä¸ºç®€æ´çš„ä»£ç ã€‚å¦‚æœæ¶‰åŠé€šè§£è¿˜ä¼šç›¸åº”çš„ä»£ç æ¨¡æ¿ã€‚

ä¸ºäº†æ–¹ä¾¿å„ä½åŒå­¦èƒ½å¤Ÿç”µè„‘ä¸Šè¿›è¡Œè°ƒè¯•å’Œæäº¤ä»£ç ï¼Œæˆ‘å»ºç«‹äº†ç›¸å…³çš„ä»“åº“ï¼šhttps://github.com/SharingSource/LogicStack-LeetCode ã€‚

åœ¨ä»“åº“åœ°å€é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°ç³»åˆ—æ–‡ç« çš„é¢˜è§£é“¾æ¥ã€ç³»åˆ—æ–‡ç« çš„ç›¸åº”ä»£ç ã€LeetCode åŸé¢˜é“¾æ¥å’Œå…¶ä»–ä¼˜é€‰é¢˜è§£ã€‚
