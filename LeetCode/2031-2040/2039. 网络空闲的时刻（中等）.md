### é¢˜ç›®æè¿°

è¿™æ˜¯ LeetCode ä¸Šçš„ **[2039. ç½‘ç»œç©ºé—²çš„æ—¶åˆ»](https://leetcode-cn.com/problems/the-time-when-the-network-becomes-idle/solution/by-ac_oier-5txs/)** ï¼Œéš¾åº¦ä¸º **ä¸­ç­‰**ã€‚

Tag : ã€ŒBFSã€



ç»™ä½ ä¸€ä¸ªæœ‰ $n$Â ä¸ªæœåŠ¡å™¨çš„è®¡ç®—æœºç½‘ç»œï¼ŒæœåŠ¡å™¨ç¼–å·ä¸ºÂ $0$Â åˆ°Â $n - 1$Â ã€‚åŒæ—¶ç»™ä½ ä¸€ä¸ªäºŒç»´æ•´æ•°æ•°ç»„Â `edges`Â ï¼Œå…¶ä¸­Â $edges[i] = [u_i, v_i]$Â è¡¨ç¤ºæœåŠ¡å™¨Â $u_i$ å’ŒÂ $v_i$Â ä¹‹é—´æœ‰ä¸€æ¡ä¿¡æ¯çº¿è·¯ï¼Œåœ¨ä¸€ç§’å†…å®ƒä»¬ä¹‹é—´å¯ä»¥ä¼ è¾“ä»»æ„æ•°ç›®çš„ä¿¡æ¯ã€‚å†ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º $n$Â ä¸”ä¸‹æ ‡ä»Â $0$Â å¼€å§‹çš„æ•´æ•°æ•°ç»„Â `patience`Â ã€‚

é¢˜ç›®ä¿è¯æ‰€æœ‰æœåŠ¡å™¨éƒ½æ˜¯ç›¸é€šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªä¿¡æ¯ä»ä»»æ„æœåŠ¡å™¨å‡ºå‘ï¼Œéƒ½å¯ä»¥é€šè¿‡è¿™äº›ä¿¡æ¯çº¿è·¯ç›´æ¥æˆ–é—´æ¥åœ°åˆ°è¾¾ä»»ä½•å…¶ä»–æœåŠ¡å™¨ã€‚

ç¼–å·ä¸º $0$Â çš„æœåŠ¡å™¨æ˜¯ä¸»æœåŠ¡å™¨ï¼Œå…¶ä»–æœåŠ¡å™¨ä¸ºæ•°æ®æœåŠ¡å™¨ã€‚æ¯ä¸ªæ•°æ®æœåŠ¡å™¨éƒ½è¦å‘ä¸»æœåŠ¡å™¨å‘é€ä¿¡æ¯ï¼Œå¹¶ç­‰å¾…å›å¤ã€‚ä¿¡æ¯åœ¨æœåŠ¡å™¨ä¹‹é—´æŒ‰æœ€ä¼˜çº¿è·¯ä¼ è¾“ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯ä¸ªä¿¡æ¯éƒ½ä¼šä»¥æœ€å°‘æ—¶é—´åˆ°è¾¾ä¸»æœåŠ¡å™¨ã€‚ä¸»æœåŠ¡å™¨ä¼šå¤„ç†æ‰€æœ‰æ–°åˆ°è¾¾çš„ä¿¡æ¯å¹¶ç«‹å³æŒ‰ç…§æ¯æ¡ä¿¡æ¯æ¥æ—¶çš„è·¯çº¿åæ–¹å‘å‘é€å›å¤ä¿¡æ¯ã€‚

åœ¨ $0$Â ç§’çš„å¼€å§‹ï¼Œæ‰€æœ‰æ•°æ®æœåŠ¡å™¨éƒ½ä¼šå‘é€å„è‡ªéœ€è¦å¤„ç†çš„ä¿¡æ¯ã€‚ä»ç¬¬ $1$Â ç§’å¼€å§‹ï¼Œæ¯ä¸€ç§’æœ€å¼€å§‹æ—¶ï¼Œæ¯ä¸ªæ•°æ®æœåŠ¡å™¨éƒ½ä¼šæ£€æŸ¥å®ƒæ˜¯å¦æ”¶åˆ°äº†ä¸»æœåŠ¡å™¨çš„å›å¤ä¿¡æ¯ï¼ˆåŒ…æ‹¬æ–°å‘å‡ºä¿¡æ¯çš„å›å¤ä¿¡æ¯ï¼‰ï¼š

* å¦‚æœè¿˜æ²¡æ”¶åˆ°ä»»ä½•å›å¤ä¿¡æ¯ï¼Œé‚£ä¹ˆè¯¥æœåŠ¡å™¨ä¼šå‘¨æœŸæ€§é‡å‘ä¿¡æ¯ã€‚æ•°æ®æœåŠ¡å™¨Â $i$Â æ¯Â $patience[i]$Â ç§’éƒ½ä¼šé‡å‘ä¸€æ¡ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®æœåŠ¡å™¨Â $i$Â åœ¨ä¸Šä¸€æ¬¡å‘é€ä¿¡æ¯ç»™ä¸»æœåŠ¡å™¨åçš„ $patience[i]$Â ç§’ åÂ ä¼šé‡å‘ä¸€æ¡ä¿¡æ¯ç»™ä¸»æœåŠ¡å™¨ã€‚
* å¦åˆ™ï¼Œè¯¥æ•°æ®æœåŠ¡å™¨ä¸ä¼šé‡å‘ä¿¡æ¯ã€‚

å½“æ²¡æœ‰ä»»ä½•ä¿¡æ¯åœ¨çº¿è·¯ä¸Šä¼ è¾“æˆ–è€…åˆ°è¾¾æŸæœåŠ¡å™¨æ—¶ï¼Œè¯¥è®¡ç®—æœºç½‘ç»œå˜ä¸ºç©ºé—²çŠ¶æ€ã€‚

è¯·è¿”å›è®¡ç®—æœºç½‘ç»œå˜ä¸ºç©ºé—²çŠ¶æ€çš„æœ€æ—©ç§’æ•°ã€‚

ç¤ºä¾‹ 1ï¼š

![](https://assets.leetcode.com/uploads/2021/09/22/quiet-place-example1.png)

```
è¾“å…¥ï¼šedges = [[0,1],[1,2]], patience = [0,2,1]

è¾“å‡ºï¼š8

è§£é‡Šï¼š
0 ç§’æœ€å¼€å§‹æ—¶ï¼Œ
- æ•°æ®æœåŠ¡å™¨ 1 ç»™ä¸»æœåŠ¡å™¨å‘å‡ºä¿¡æ¯ï¼ˆç”¨ 1A è¡¨ç¤ºï¼‰ã€‚
- æ•°æ®æœåŠ¡å™¨ 2 ç»™ä¸»æœåŠ¡å™¨å‘å‡ºä¿¡æ¯ï¼ˆç”¨ 2A è¡¨ç¤ºï¼‰ã€‚

1 ç§’æ—¶ï¼Œ
- ä¿¡æ¯ 1A åˆ°è¾¾ä¸»æœåŠ¡å™¨ï¼Œä¸»æœåŠ¡å™¨ç«‹åˆ»å¤„ç†ä¿¡æ¯ 1A å¹¶å‘å‡º 1A çš„å›å¤ä¿¡æ¯ã€‚
- æ•°æ®æœåŠ¡å™¨ 1 è¿˜æ²¡æ”¶åˆ°ä»»ä½•å›å¤ã€‚è·ç¦»ä¸Šæ¬¡å‘å‡ºä¿¡æ¯è¿‡å»äº† 1 ç§’ï¼ˆ1 < patience[1] = 2ï¼‰ï¼Œæ‰€ä»¥ä¸ä¼šé‡å‘ä¿¡æ¯ã€‚
- æ•°æ®æœåŠ¡å™¨ 2 è¿˜æ²¡æ”¶åˆ°ä»»ä½•å›å¤ã€‚è·ç¦»ä¸Šæ¬¡å‘å‡ºä¿¡æ¯è¿‡å»äº† 1 ç§’ï¼ˆ1 == patience[2] = 1ï¼‰ï¼Œæ‰€ä»¥å®ƒé‡å‘ä¸€æ¡ä¿¡æ¯ï¼ˆç”¨ 2B è¡¨ç¤ºï¼‰ã€‚

2 ç§’æ—¶ï¼Œ
- å›å¤ä¿¡æ¯ 1A åˆ°è¾¾æœåŠ¡å™¨ 1 ï¼ŒæœåŠ¡å™¨ 1 ä¸ä¼šå†é‡å‘ä¿¡æ¯ã€‚
- ä¿¡æ¯ 2A åˆ°è¾¾ä¸»æœåŠ¡å™¨ï¼Œä¸»æœåŠ¡å™¨ç«‹åˆ»å¤„ç†ä¿¡æ¯ 2A å¹¶å‘å‡º 2A çš„å›å¤ä¿¡æ¯ã€‚
- æœåŠ¡å™¨ 2 é‡å‘ä¸€æ¡ä¿¡æ¯ï¼ˆç”¨ 2C è¡¨ç¤ºï¼‰ã€‚
...
4 ç§’æ—¶ï¼Œ
- å›å¤ä¿¡æ¯ 2A åˆ°è¾¾æœåŠ¡å™¨ 2 ï¼ŒæœåŠ¡å™¨ 2 ä¸ä¼šå†é‡å‘ä¿¡æ¯ã€‚
...
7 ç§’æ—¶ï¼Œå›å¤ä¿¡æ¯ 2D åˆ°è¾¾æœåŠ¡å™¨ 2 ã€‚

ä»ç¬¬ 8 ç§’å¼€å§‹ï¼Œä¸å†æœ‰ä»»ä½•ä¿¡æ¯åœ¨æœåŠ¡å™¨ä¹‹é—´ä¼ è¾“ï¼Œä¹Ÿä¸å†æœ‰ä¿¡æ¯åˆ°è¾¾æœåŠ¡å™¨ã€‚
æ‰€ä»¥ç¬¬ 8 ç§’æ˜¯ç½‘ç»œå˜ç©ºé—²çš„æœ€æ—©æ—¶åˆ»ã€‚
```
ç¤ºä¾‹ 2ï¼š

![](https://assets.leetcode.com/uploads/2021/09/04/network_a_quiet_place_2.png)

```
è¾“å…¥ï¼šedges = [[0,1],[0,2],[1,2]], patience = [0,10,10]

è¾“å‡ºï¼š3

è§£é‡Šï¼šæ•°æ®æœåŠ¡å™¨ 1 å’Œ 2 ç¬¬ 2 ç§’åˆæ”¶åˆ°å›å¤ä¿¡æ¯ã€‚
ä»ç¬¬ 3 ç§’å¼€å§‹ï¼Œç½‘ç»œå˜ç©ºé—²ã€‚
```

æç¤ºï¼š
* $n = patience.length$
* $2 <= n <= 10^5$
* $patience[0] == 0$
* å¯¹äºÂ $1 <= i < n$ ï¼Œæ»¡è¶³Â $1 <= patience[i] <= 10^5$
* $1 <= edges.length <= \min(105, n \times (n - 1) / 2)$
* $edges[i].length == 2$
* $0 <= ui, vi < n$
* $ui != vi$
* ä¸ä¼šæœ‰é‡è¾¹ã€‚
* æ¯ä¸ªæœåŠ¡å™¨éƒ½ç›´æ¥æˆ–é—´æ¥ä¸åˆ«çš„æœåŠ¡å™¨ç›¸è¿ã€‚

---

### å»ºå›¾ + BFS

æ ¹æ®é¢˜ç›®å¯çŸ¥è¿™æ˜¯ä¸€ä¸ªè¾¹æƒä¸º $1$ çš„æ— å‘è¿é€šå›¾ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ã€Œé‚»æ¥è¡¨å»ºå›¾ + BFSã€çš„æ–¹å¼é¢„å¤„ç†å‡º $dist$ æ•°ç»„ï¼Œ$dist[i]$ å«ä¹‰ä¸ºèŠ‚ç‚¹ $i$ åˆ° $0$ å·ç‚¹çš„æœ€çŸ­è·ç¦»ã€‚

ä¸€ä¸ªæ•°æ®æœåŠ¡å™¨ $i$ å¾€ä¸»æœåŠ¡å™¨å‘é€æ¶ˆæ¯æ‰€æ¶ˆè€—çš„æ—¶é—´ä¸ºä¸¤èŠ‚ç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ $dist[i]$ï¼Œè€Œä»å‘é€æ¶ˆæ¯åˆ°æ”¶åˆ°å›å¤æ‰€éœ€çš„æ—¶é—´ä¸º $di = 2 \times dist[i]$ã€‚

åŒæ—¶æ¯ä¸ªæ•°æ®æœåŠ¡å™¨è¿˜å­˜åœ¨æ—¶é—´é—´éš”ä¸º $t = patience[i]$ çš„é‡å‘åŠ¨ä½œï¼Œå¹¶ä¸”åŠ¨ä½œåªæœ‰åœ¨ç¬¬ä¸€æ¬¡æ”¶åˆ°ä¸»æœåŠ¡çš„å›å¤åæ‰ä¼šåœæ­¢ã€‚

å› æ­¤å¦‚æœ $di <= t$ï¼Œé‚£ä¹ˆæ•°æ®æœåŠ¡å™¨ä¸ä¼šå‘ç”Ÿé‡å‘åŠ¨ä½œï¼Œè¯¥èŠ‚ç‚¹æ´»åŠ¨åœæ­¢æ—¶é—´ç‚¹ä¸º $di$ï¼›å½“ $di > t$ï¼Œæ•°æ®æœåŠ¡å™¨å°†ä¼šå‘ç”Ÿé‡å‘åŠ¨ä½œï¼Œä¸”æœ€åä¸€ä¸ªæ•°æ®åŒ…çš„å‘é€æ—¶é—´ä¸º $(di - 1) / t * t$ï¼Œåªæœ‰å½“æœ€åä¸€ä¸ªæ•°æ®åŒ…æ”¶åˆ°å›å¤ï¼Œè¯¥èŠ‚ç‚¹çš„æ‰€æœ‰æ´»åŠ¨æ‰ç®—åœæ­¢ï¼Œåœæ­¢æ—¶é—´ç‚¹ä¸º $(di - 1) / t * t + di$ã€‚æ‰€æœ‰èŠ‚ç‚¹çš„æ´»åŠ¨åœæ­¢æ—¶é—´ç‚¹çš„æœ€å¤§å€¼å³æ˜¯ç­”æ¡ˆã€‚

> ä¸€äº›ç»†èŠ‚ï¼šè€è§„çŸ©ï¼Œä¸ºäº†é¿å…æ¯ä¸ªæ ·ä¾‹éƒ½ `new` å¤§æ•°ç»„ï¼Œæˆ‘ä»¬ä½¿ç”¨ `static` ä¼˜åŒ–ã€‚ä½¿ç”¨ `static` ä¼˜åŒ–åï¼Œä½ ç”šè‡³ä¼šæ”¶è·ä¸€ä¸ªç¨³å®š $100$% çš„ç»“æœ ğŸ¤£

Java ä»£ç ï¼š
```Java
class Solution {
    static int N = 100010, M = N * 2, INF = 0x3f3f3f3f;
    static int[] he = new int[N], e = new int[M], ne = new int[M];
    static int[] dist = new int[N];
    int idx;
    void add(int a, int b) {
        e[idx] = b;
        ne[idx] = he[a];
        he[a] = idx++;
    }
    public int networkBecomesIdle(int[][] edges, int[] patience) {
        Arrays.fill(he, -1);
        Arrays.fill(dist, INF);
        int n = patience.length;
        for (int[] e : edges) {
            add(e[0], e[1]);
            add(e[1], e[0]);
        }
        Deque<Integer> d = new ArrayDeque<>();
        d.addLast(0);
        dist[0] = 0;
        while (!d.isEmpty()) {
            int t = d.pollFirst();
            for (int i = he[t]; i != -1; i = ne[i]) {
                int j = e[i];
                if (dist[j] != INF) continue;
                dist[j] = dist[t] + 1;
                d.addLast(j);
            }
        }
        int ans = 0;
        for (int i = 1; i < n; i++) {
            int di = dist[i] * 2, t = patience[i];
            int cur = di <= t ? di : (di - 1) / t * t + di;
            if (cur > ans) ans = cur;
        }
        return ans + 1;
    }
}
```
C++ ä»£ç ï¼š
```C++
class Solution {
public:
    static const int N = 100010, M = N * 2, INF = 0x3f3f3f3f;
    int he[N], e[M], ne[M], idx = 0;
    int dist[N];
    void add(int a, int b) {
        e[idx] = b;
        ne[idx] = he[a];
        he[a] = idx++;
    }
    int networkBecomesIdle(vector<vector<int>>& edges, vector<int>& patience) {
        memset(he, -1, sizeof(he));
        memset(dist, INF, sizeof(dist));
        int n = patience.size();
        for (auto& edge : edges) {
            add(edge[0], edge[1]);
            add(edge[1], edge[0]);
        }
        queue<int> q;
        q.push(0);
        dist[0] = 0;
        while (!q.empty()) {
            int t = q.front();
            q.pop();
            for (int i = he[t]; i != -1; i = ne[i]) {
                int j = e[i];
                if (dist[j] != INF) continue;
                dist[j] = dist[t] + 1;
                q.push(j);
            }
        }
        int ans = 0;
        for (int i = 1; i < n; i++) {
            int di = dist[i] * 2, t = patience[i];
            int cur = (di <= t) ? di : ((di - 1) / t) * t + di;
            ans = max(ans, cur);
        }
        return ans + 1;
    }
};
```
Python ä»£ç ï¼š
```Python
class Solution:
    def networkBecomesIdle(self, edges: List[List[int]], patience: List[int]) -> int:
        N = 100010
        M = N * 2
        INF = 0x3f3f3f3f
        he = [-1] * N
        e = [0] * M
        ne = [0] * M
        idx = 0
        dist = [INF] * N
        
        def add(a: int, b: int):
            nonlocal idx
            e[idx] = b
            ne[idx] = he[a]
            he[a] = idx
            idx += 1
        
        n = len(patience)
        for u, v in edges:
            add(u, v)
            add(v, u)
        
        q = deque([0])
        dist[0] = 0
        while q:
            t = q.popleft()
            i = he[t]
            while i != -1:
                j = e[i]
                if dist[j] == INF:
                    dist[j] = dist[t] + 1
                    q.append(j)
                i = ne[i]
        
        ans = 0
        for i in range(1, n):
            di = dist[i] * 2
            t_val = patience[i]
            cur = di if di <= t_val else ((di - 1) // t_val) * t_val + di
            ans = max(ans, cur)
        
        return ans + 1
```
* æ—¶é—´å¤æ‚åº¦ï¼š$O(n + m)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n + m)$

---

### æœ€å

è¿™æ˜¯æˆ‘ä»¬ã€Œåˆ·ç©¿ LeetCodeã€ç³»åˆ—æ–‡ç« çš„ç¬¬ `No.2039` ç¯‡ï¼Œç³»åˆ—å¼€å§‹äº 2021/01/01ï¼Œæˆªæ­¢äºèµ·å§‹æ—¥ LeetCode ä¸Šå…±æœ‰ 1916 é“é¢˜ç›®ï¼Œéƒ¨åˆ†æ˜¯æœ‰é”é¢˜ï¼Œæˆ‘ä»¬å°†å…ˆæŠŠæ‰€æœ‰ä¸å¸¦é”çš„é¢˜ç›®åˆ·å®Œã€‚

åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« é‡Œé¢ï¼Œé™¤äº†è®²è§£è§£é¢˜æ€è·¯ä»¥å¤–ï¼Œè¿˜ä¼šå°½å¯èƒ½ç»™å‡ºæœ€ä¸ºç®€æ´çš„ä»£ç ã€‚å¦‚æœæ¶‰åŠé€šè§£è¿˜ä¼šç›¸åº”çš„ä»£ç æ¨¡æ¿ã€‚

ä¸ºäº†æ–¹ä¾¿å„ä½åŒå­¦èƒ½å¤Ÿç”µè„‘ä¸Šè¿›è¡Œè°ƒè¯•å’Œæäº¤ä»£ç ï¼Œæˆ‘å»ºç«‹äº†ç›¸å…³çš„ä»“åº“ï¼šhttps://github.com/SharingSource/LogicStack-LeetCode ã€‚

åœ¨ä»“åº“åœ°å€é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°ç³»åˆ—æ–‡ç« çš„é¢˜è§£é“¾æ¥ã€ç³»åˆ—æ–‡ç« çš„ç›¸åº”ä»£ç ã€LeetCode åŸé¢˜é“¾æ¥å’Œå…¶ä»–ä¼˜é€‰é¢˜è§£ã€‚

