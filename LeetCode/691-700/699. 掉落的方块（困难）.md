### é¢˜ç›®æè¿°

è¿™æ˜¯ LeetCode ä¸Šçš„ **[699. æ‰è½çš„æ–¹å—](https://leetcode-cn.com/problems/degree-of-an-array/solution/shu-zu-ji-shu-ha-xi-biao-ji-shu-jie-fa-y-a0mg/)** ï¼Œéš¾åº¦ä¸º **å›°éš¾**ã€‚

Tag : ã€Œçº¿æ®µæ ‘ï¼ˆåŠ¨æ€å¼€ç‚¹ï¼‰ã€ã€ã€Œçº¿æ®µæ ‘ã€



åœ¨æ— é™é•¿çš„æ•°è½´ï¼ˆå³ `x` è½´ï¼‰ä¸Šï¼Œæˆ‘ä»¬æ ¹æ®ç»™å®šçš„é¡ºåºæ”¾ç½®å¯¹åº”çš„æ­£æ–¹å½¢æ–¹å—ã€‚

ç¬¬ i ä¸ªæ‰è½çš„æ–¹å—ï¼ˆ`positions[i] = (left, side_length)`ï¼‰æ˜¯æ­£æ–¹å½¢ï¼Œå…¶ä¸­Â `left` è¡¨ç¤ºè¯¥æ–¹å—æœ€å·¦è¾¹çš„ç‚¹ä½ç½®(`positions[i][0]`)ï¼Œ`side_length` è¡¨ç¤ºè¯¥æ–¹å—çš„è¾¹é•¿(`positions[i][1]`)ã€‚

æ¯ä¸ªæ–¹å—çš„åº•éƒ¨è¾¹ç¼˜å¹³è¡Œäºæ•°è½´ï¼ˆå³ `x` è½´ï¼‰ï¼Œå¹¶ä¸”ä»ä¸€ä¸ªæ¯”ç›®å‰æ‰€æœ‰çš„è½åœ°æ–¹å—æ›´é«˜çš„é«˜åº¦æ‰è½è€Œä¸‹ã€‚åœ¨ä¸Šä¸€ä¸ªæ–¹å—ç»“æŸæ‰è½ï¼Œå¹¶ä¿æŒé™æ­¢åï¼Œæ‰å¼€å§‹æ‰è½æ–°æ–¹å—ã€‚

æ–¹å—çš„åº•è¾¹å…·æœ‰éå¸¸å¤§çš„ç²˜æ€§ï¼Œå¹¶å°†ä¿æŒå›ºå®šåœ¨å®ƒä»¬æ‰€æ¥è§¦çš„ä»»ä½•é•¿åº¦è¡¨é¢ä¸Šï¼ˆæ— è®ºæ˜¯æ•°è½´è¿˜æ˜¯å…¶ä»–æ–¹å—ï¼‰ã€‚é‚»æ¥æ‰è½çš„è¾¹ä¸ä¼šè¿‡æ—©åœ°ç²˜åˆåœ¨ä¸€èµ·ï¼Œå› ä¸ºåªæœ‰åº•è¾¹æ‰å…·æœ‰ç²˜æ€§ã€‚

è¿”å›ä¸€ä¸ªå †å é«˜åº¦åˆ—è¡¨Â `ans`ã€‚æ¯ä¸€ä¸ªå †å é«˜åº¦Â `ans[i]`Â è¡¨ç¤ºåœ¨é€šè¿‡Â `positions[0], positions[1], ..., positions[i]`Â è¡¨ç¤ºçš„æ–¹å—æ‰è½ç»“æŸåï¼Œç›®å‰æ‰€æœ‰å·²ç»è½ç¨³çš„æ–¹å—å †å çš„æœ€é«˜é«˜åº¦ã€‚

ç¤ºä¾‹ 1:
```
è¾“å…¥: [[1, 2], [2, 3], [6, 1]]

è¾“å‡º: [2, 5, 5]

è§£é‡Š:

ç¬¬ä¸€ä¸ªæ–¹å— positions[0] = [1, 2] æ‰è½ï¼š
_aa
_aa
-------
æ–¹å—æœ€å¤§é«˜åº¦ä¸º 2 ã€‚

ç¬¬äºŒä¸ªæ–¹å— positions[1] = [2, 3] æ‰è½ï¼š
__aaa
__aaa
__aaa
_aa__
_aa__
--------------
æ–¹å—æœ€å¤§é«˜åº¦ä¸º5ã€‚
å¤§çš„æ–¹å—ä¿æŒåœ¨è¾ƒå°çš„æ–¹å—çš„é¡¶éƒ¨ï¼Œä¸è®ºå®ƒçš„é‡å¿ƒåœ¨å“ªé‡Œï¼Œå› ä¸ºæ–¹å—çš„åº•éƒ¨è¾¹ç¼˜æœ‰éå¸¸å¤§çš„ç²˜æ€§ã€‚

ç¬¬ä¸‰ä¸ªæ–¹å— positions[1] = [6, 1] æ‰è½ï¼š
__aaa
__aaa
__aaa
_aa
_aa___a
-------------- 
æ–¹å—æœ€å¤§é«˜åº¦ä¸º5ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬è¿”å›ç»“æœ[2, 5, 5]ã€‚
```

ç¤ºä¾‹ 2:
```
è¾“å…¥: [[100, 100], [200, 100]]

è¾“å‡º: [100, 100]

è§£é‡Š: ç›¸é‚»çš„æ–¹å—ä¸ä¼šè¿‡æ—©åœ°å¡ä½ï¼Œåªæœ‰å®ƒä»¬çš„åº•éƒ¨è¾¹ç¼˜æ‰èƒ½ç²˜åœ¨è¡¨é¢ä¸Šã€‚
```

æ³¨æ„:
* $1 <= positions.length <= 1000$
* $1 <= positions[i][0] <= 10^8$
* $1 <= positions[i][1] <= 10^6$

---

### åŸºæœ¬åˆ†æ 

ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä½¿ç”¨ `ps` æ¥ä»£æŒ‡ `positions`ã€‚

æ¯æ¬¡ä»æ’å…¥æ“ä½œéƒ½é™„å¸¦ä¸€æ¬¡è¯¢é—®ï¼Œå› æ­¤è¯¢é—®æ¬¡æ•°ä¸º $1e3$ï¼Œå·¦ç«¯ç‚¹çš„æœ€å¤§å€¼ä¸º $10e8$ï¼Œè¾¹é•¿æœ€å¤§å€¼ä¸º $1e6$ï¼Œç”±æ­¤å¯çŸ¥å€¼åŸŸèŒƒå›´å¤§äº $1e8$ï¼Œä½†ä¸è¶…è¿‡ $1e9$ã€‚

å¯¹äºå€¼åŸŸèŒƒå›´å¤§ï¼Œä½†æŸ¥è¯¢æ¬¡æ•°æœ‰é™çš„åŒºé—´å’Œé—®é¢˜ï¼Œä¸ä¹…å‰æ›¾ç»æ€»ç»“è¿‡ : [æ±‚è§£å¸¸è§ã€Œå€¼åŸŸçˆ†ç‚¸ï¼ŒæŸ¥è¯¢æœ‰é™ã€åŒºé—´é—®é¢˜çš„å‡ ç§æ–¹å¼](https://mp.weixin.qq.com/s?__biz=MzU4NDE3MTEyMA==&mid=2247491187&idx=2&sn=bb2d8b7e89c535914da8107387e951a2)ï¼Œå¯ä½œä¸ºå‰ç½® ğŸ§€ è¿›è¡Œäº†è§£ã€‚

è€Œæˆ‘çš„ä¸ªäººä¹ æƒ¯ï¼Œä¸€èˆ¬è¦ä¹ˆä½¿ç”¨ã€Œç¦»æ•£åŒ– + çº¿æ®µæ ‘ã€ï¼Œè¦ä¹ˆä½¿ç”¨ã€Œçº¿æ®µæ ‘ï¼ˆåŠ¨æ€å¼€ç‚¹ï¼‰ã€è¿›è¡Œæ±‚è§£ã€‚

æœ¬é¢˜ä¸ºã€Œéå¼ºåˆ¶åœ¨çº¿ã€é—®é¢˜ï¼Œå› æ­¤å¯ä»¥å…ˆå¯¹ `ps` æ•°ç»„è¿›è¡Œç¦»æ•£åŒ–ï¼Œå°†å€¼åŸŸæ˜ å°„åˆ°è¾ƒå°çš„ç©ºé—´ï¼Œç„¶åå¥—ç”¨å›ºå®šå ç”¨ $4 \times n$ ç©ºé—´çš„çº¿æ®µæ ‘æ±‚è§£ã€‚

ä½†æ›´ä¸ºçµæ´»ï¼ˆèƒ½å¤ŸåŒæ—¶åº”å¯¹å¼ºåˆ¶åœ¨çº¿é—®é¢˜ï¼‰çš„æ±‚è§£æ–¹å¼æ˜¯ã€Œçº¿æ®µæ ‘ï¼ˆåŠ¨æ€å¼€ç‚¹ï¼‰ã€ã€‚

åŒæ—¶å®ç°åŠ¨æ€å¼€ç‚¹çš„æ–¹å¼æœ‰ä¸¤ç§ï¼š

1. æ ¹æ®æ“ä½œæ¬¡æ•°å¯¹ä½¿ç”¨åˆ°çš„æœ€å¤§ç‚¹æ•°è¿›è¡Œé¢„ä¼°ï¼Œå¹¶é‡‡ç”¨æ•°ç»„æ–¹å¼è¿›è¡Œå®ç°çº¿æ®µæ ‘ï¼ˆè§£æ³•ä¸€ï¼‰ï¼›
2. ä½¿ç”¨åŠ¨æ€æŒ‡é’ˆï¼ˆè§£æ³•äºŒï¼‰ï¼›

æ–¹å¼ä¸€åœ¨ä¸ä¹…ä¹‹å‰çš„æ¯æ—¥ä¸€é¢˜ [933. æœ€è¿‘çš„è¯·æ±‚æ¬¡æ•°](https://sharingsource.github.io/2022/05/06/933.%20%E6%9C%80%E8%BF%91%E7%9A%84%E8%AF%B7%E6%B1%82%E6%AC%A1%E6%95%B0%EF%BC%88%E7%AE%80%E5%8D%95%EF%BC%89/) è®²è¿‡ï¼Œå› æ­¤ä»Šå¤©æŠŠæ–¹å¼äºŒä¹Ÿå†™ä¸€ä¸‹ã€‚

å…·ä½“çš„ï¼Œæˆ‘ä»¬å°†é¡ºåºæ”¾ç½®æ–¹å—çš„æ“ä½œï¼ˆå‡è®¾å½“å‰æ–¹å—çš„å·¦ç«¯ç‚¹ä¸º $a$ï¼Œè¾¹é•¿ä¸º $len$ï¼Œåˆ™æœ‰å³ç«¯ç‚¹ä¸º $b = a + len$ï¼‰ï¼Œåˆ†æˆå¦‚ä¸‹ä¸¤æ­¥è¿›è¡Œï¼š

* æŸ¥è¯¢å½“å‰èŒƒå›´ $[a, b]$ çš„æœ€å¤§é«˜åº¦ä¸ºå¤šå°‘ï¼Œå‡è®¾ä¸º $cur$ï¼›
* æ›´æ–°å½“å‰èŒƒå›´ $[a, b]$ çš„æœ€æ–°é«˜åº¦ä¸º $cur + len$ã€‚

å› æ­¤è¿™æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªã€ŒåŒºé—´ä¿®æ”¹ + åŒºé—´æŸ¥è¯¢ã€çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å®ç°å¸¦ã€Œæ‡’æ ‡è®°ã€çš„çº¿æ®µæ ‘ï¼Œä»è€Œç¡®ä¿åœ¨è¿›è¡Œã€ŒåŒºé—´ä¿®æ”¹ã€æ—¶å¤æ‚åº¦ä»ä¸º $O(\log{n})$ã€‚

> å¦å¤–æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç»†èŠ‚æ˜¯ï¼šä¸åŒæ–¹å—ä¹‹é—´çš„è¾¹ç¼˜å¯ä»¥é‡åˆï¼Œä½†ä¸ä¼šå¯¼è‡´æ–¹å—å åŠ ï¼Œå› æ­¤æˆ‘ä»¬å½“æˆ‘ä»¬å¯¹ä¸€ä¸ªåŒºé—´ $[a, b]$ è¿›è¡Œæ“ä½œï¼ˆæŸ¥è¯¢æˆ–æ’å…¥ï¼‰æ—¶ï¼Œå¯ä»¥å°†å…¶è°ƒæ•´ä¸º $[a, b - 1]$ï¼Œä»è€Œè§£å†³è¾¹ç¼˜å åŠ æ“ä½œé«˜åº¦é”™è¯¯çš„é—®é¢˜ã€‚

---

### çº¿æ®µæ ‘ï¼ˆåŠ¨æ€å¼€ç‚¹ - ä¼°ç‚¹ï¼‰

ä¼°ç‚¹çš„åŸºæœ¬æ–¹å¼åœ¨å‰ç½® ğŸ§€ [æ±‚è§£å¸¸è§ã€Œå€¼åŸŸçˆ†ç‚¸ï¼ŒæŸ¥è¯¢æœ‰é™ã€åŒºé—´é—®é¢˜çš„å‡ ç§æ–¹å¼](https://mp.weixin.qq.com/s?__biz=MzU4NDE3MTEyMA==&mid=2247491187&idx=2&sn=bb2d8b7e89c535914da8107387e951a2) è¯¦ç»†è®²è¿‡ã€‚

ç®€å•æ¥è¯´ï¼Œå¯ä»¥ç›´æ¥ä¼°ç®—ä¸º $6 \times m \times \log{n}$ å³å¯ï¼Œå…¶ä¸­ $m$ ä¸ºè¯¢é—®æ¬¡æ•°ï¼ˆå¯¹åº”æœ¬é¢˜å°±æ˜¯ `ps` çš„é•¿åº¦ï¼‰ï¼Œè€Œ $n$ ä¸ºå€¼åŸŸå¤§å°ï¼ˆå¯¹åº”æœ¬é¢˜å¯ç›´æ¥å–æˆ $1e9$ï¼‰ï¼›è€Œå¦å¤–ä¸€ä¸ªæ¯”è¾ƒå®ç”¨ï¼ˆé¿å…ä¼°ç®—ï¼‰çš„ä¼°ç‚¹æ–¹å¼å¯ä»¥ã€Œå°½å¯èƒ½çš„å¤šå¼€ç‚¹æ•°ã€ï¼Œåˆ©ç”¨é¢˜ç›®ç»™å®šçš„ç©ºé—´ä¸Šç•Œå’Œæˆ‘ä»¬åˆ›å»ºçš„è‡ªå®šä¹‰ç±»ï¼ˆç»“æ„ä½“ï¼‰çš„å¤§å°ï¼Œå°½å¯èƒ½çš„å¤šå¼€ï¼ˆä¸è€ƒè™‘å­—èŠ‚å¯¹é½ï¼Œæˆ–è€…ç»“æ„ä½“è¿‡å¤§çš„æƒ…å†µï¼Œ`Java` çš„ $128M$ å¯ä»¥å¼€åˆ° $5 \times 10^6$ ä»¥ä¸Šï¼‰ã€‚

ä»£ç ï¼š
```Java
class Solution {
    class Node {
        // ls å’Œ rs åˆ†åˆ«ä»£è¡¨å½“å‰åŒºé—´çš„å·¦å³å­èŠ‚ç‚¹æ‰€åœ¨ tr æ•°ç»„ä¸­çš„ä¸‹æ ‡
        // val ä»£è¡¨å½“å‰åŒºé—´çš„æœ€å¤§é«˜åº¦ï¼Œadd ä¸ºæ‡’æ ‡è®°
        int ls, rs, val, add;
    }
    int N = (int)1e9, cnt = 0;
    Node[] tr = new Node[1000010];
    void update(int u, int lc, int rc, int l, int r, int v) {
        if (l <= lc && rc <= r) {
            tr[u].val = v;
            tr[u].add = v;
            return ;
        }
        pushdown(u);
        int mid = lc + rc >> 1;
        if (l <= mid) update(tr[u].ls, lc, mid, l, r, v);
        if (r > mid) update(tr[u].rs, mid + 1, rc, l, r, v);
        pushup(u);
    }
    int query(int u, int lc, int rc, int l, int r) {
        if (l <= lc && rc <= r) return tr[u].val;
        pushdown(u);
        int mid = lc + rc >> 1, ans = 0;
        if (l <= mid) ans = query(tr[u].ls, lc, mid, l, r);
        if (r > mid) ans = Math.max(ans, query(tr[u].rs, mid + 1, rc, l, r));
        return ans;
    }
    void pushdown(int u) {
        if (tr[u] == null) tr[u] = new Node();
        if (tr[u].ls == 0) {
            tr[u].ls = ++cnt;
            tr[tr[u].ls] = new Node();
        }
        if (tr[u].rs == 0) {
            tr[u].rs = ++cnt;
            tr[tr[u].rs] = new Node();
        }
        if (tr[u].add == 0) return ;
        int add = tr[u].add;
        tr[tr[u].ls].add = add; tr[tr[u].rs].add = add;
        tr[tr[u].ls].val = add; tr[tr[u].rs].val = add;
        tr[u].add = 0;
    }
    void pushup(int u) {
        tr[u].val = Math.max(tr[tr[u].ls].val, tr[tr[u].rs].val);
    }
    public List<Integer> fallingSquares(int[][] ps) {
        List<Integer> ans = new ArrayList<>();
        tr[1] = new Node();
        for (int[] info : ps) {
            int x = info[0], h = info[1], cur = query(1, 1, N, x, x + h - 1);
            update(1, 1, N, x, x + h - 1, cur + h);
            ans.add(tr[1].val);
        }
        return ans;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šä»¤ $m$ ä¸ºæŸ¥è¯¢æ¬¡æ•°ï¼Œ$n$ ä¸ºå€¼åŸŸå¤§å°ï¼Œå¤æ‚åº¦ä¸º $O(m\log{n})$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(m\log{n})$

---

### çº¿æ®µæ ‘ï¼ˆåŠ¨æ€å¼€ç‚¹ - åŠ¨æ€æŒ‡é’ˆï¼‰

åˆ©ç”¨ã€ŒåŠ¨æ€æŒ‡é’ˆã€å®ç°çš„ã€ŒåŠ¨æ€å¼€ç‚¹ã€å¯ä»¥æœ‰æ•ˆé¿å…æ•°ç»„ä¼°ç‚¹é—®é¢˜ï¼Œæ›´é‡è¦çš„æ˜¯å¯ä»¥æœ‰æ•ˆé¿å… `new` å¤§æ•°ç»„çš„åˆå§‹åŒ–å¼€é”€ï¼Œå¯¹äº LC è¿™ç§è¿˜è·Ÿä½ ç®—æ‰€æœ‰æ ·ä¾‹æ€»æ—¶é•¿çš„ OJ æ¥è¯´ï¼Œåœ¨ä¸è€ƒè™‘ `static` ä¼˜åŒ–/å…¨å±€æ•°ç»„ä¼˜åŒ– çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€æŒ‡é’ˆçš„æ–¹å¼è¦æ¯”ä¼°ç‚¹çš„æ–¹å¼æ¥å¾—å¥½ã€‚

ä»£ç ï¼š
```Java
class Solution {
    int N = (int)1e9;
    class Node {
        // ls å’Œ rs åˆ†åˆ«ä»£è¡¨å½“å‰åŒºé—´çš„å·¦å³å­èŠ‚ç‚¹
        Node ls, rs;
        // val ä»£è¡¨å½“å‰åŒºé—´çš„æœ€å¤§é«˜åº¦ï¼Œadd ä¸ºæ‡’æ ‡è®°
        int val, add;
    }
    Node root = new Node();
    void update(Node node, int lc, int rc, int l, int r, int v) {
        if (l <= lc && rc <= r) {
            node.add = v;
            node.val = v;
            return ;
        }
        pushdown(node);
        int mid = lc + rc >> 1;
        if (l <= mid) update(node.ls, lc, mid, l, r, v);
        if (r > mid) update(node.rs, mid + 1, rc, l, r, v);
        pushup(node);
    }
    int query(Node node, int lc, int rc, int l, int r) {
        if (l <= lc && rc <= r) return node.val;
        pushdown(node);
        int mid = lc + rc >> 1, ans = 0;
        if (l <= mid) ans = query(node.ls, lc, mid, l, r);
        if (r > mid) ans = Math.max(ans, query(node.rs, mid + 1, rc, l, r));
        return ans;
    }
    void pushdown(Node node) {
        if (node.ls == null) node.ls = new Node();
        if (node.rs == null) node.rs = new Node();
        if (node.add == 0) return ;
        node.ls.add = node.add; node.rs.add = node.add;
        node.ls.val = node.add; node.rs.val = node.add;
        node.add = 0;
    }
    void pushup(Node node) {
        node.val = Math.max(node.ls.val, node.rs.val);
    }
    public List<Integer> fallingSquares(int[][] ps) {
        List<Integer> ans = new ArrayList<>();
        for (int[] info : ps) {
            int x = info[0], h = info[1], cur = query(root, 0, N, x, x + h - 1);
            update(root, 0, N, x, x + h - 1, cur + h);
            ans.add(root.val);
        }
        return ans;
    }
}
```
* æ—¶é—´å¤æ‚åº¦ï¼šä»¤ $m$ ä¸ºæŸ¥è¯¢æ¬¡æ•°ï¼Œ$n$ ä¸ºå€¼åŸŸå¤§å°ï¼Œå¤æ‚åº¦ä¸º $O(m\log{n})$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(m\log{n})$

---

### æœ€å

è¿™æ˜¯æˆ‘ä»¬ã€Œåˆ·ç©¿ LeetCodeã€ç³»åˆ—æ–‡ç« çš„ç¬¬ `No.699` ç¯‡ï¼Œç³»åˆ—å¼€å§‹äº 2021/01/01ï¼Œæˆªæ­¢äºèµ·å§‹æ—¥ LeetCode ä¸Šå…±æœ‰ 1916 é“é¢˜ç›®ï¼Œéƒ¨åˆ†æ˜¯æœ‰é”é¢˜ï¼Œæˆ‘ä»¬å°†å…ˆæŠŠæ‰€æœ‰ä¸å¸¦é”çš„é¢˜ç›®åˆ·å®Œã€‚

åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« é‡Œé¢ï¼Œé™¤äº†è®²è§£è§£é¢˜æ€è·¯ä»¥å¤–ï¼Œè¿˜ä¼šå°½å¯èƒ½ç»™å‡ºæœ€ä¸ºç®€æ´çš„ä»£ç ã€‚å¦‚æœæ¶‰åŠé€šè§£è¿˜ä¼šç›¸åº”çš„ä»£ç æ¨¡æ¿ã€‚

ä¸ºäº†æ–¹ä¾¿å„ä½åŒå­¦èƒ½å¤Ÿç”µè„‘ä¸Šè¿›è¡Œè°ƒè¯•å’Œæäº¤ä»£ç ï¼Œæˆ‘å»ºç«‹äº†ç›¸å…³çš„ä»“åº“ï¼šhttps://github.com/SharingSource/LogicStack-LeetCode ã€‚

åœ¨ä»“åº“åœ°å€é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°ç³»åˆ—æ–‡ç« çš„é¢˜è§£é“¾æ¥ã€ç³»åˆ—æ–‡ç« çš„ç›¸åº”ä»£ç ã€LeetCode åŸé¢˜é“¾æ¥å’Œå…¶ä»–ä¼˜é€‰é¢˜è§£ã€‚

