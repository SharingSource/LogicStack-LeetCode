### é¢˜ç›®æè¿°

è¿™æ˜¯ LeetCode ä¸Šçš„ **[795. åŒºé—´å­æ•°ç»„ä¸ªæ•°](https://leetcode.cn/problems/number-of-subarrays-with-bounded-maximum/solution/by-ac_oier-gmpt/)** ï¼Œéš¾åº¦ä¸º **ä¸­ç­‰**ã€‚

Tag : ã€Œæ¨¡æ‹Ÿã€ã€ã€Œå•è°ƒæ ˆã€



ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` å’Œä¸¤ä¸ªæ•´æ•°ï¼š`left` åŠ `right` ã€‚

æ‰¾å‡º `nums` ä¸­è¿ç»­ã€éç©ºä¸”å…¶ä¸­æœ€å¤§å…ƒç´ åœ¨èŒƒå›´Â $[left, right]$ å†…çš„å­æ•°ç»„ï¼Œå¹¶è¿”å›æ»¡è¶³æ¡ä»¶çš„å­æ•°ç»„çš„ä¸ªæ•°ã€‚

ç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹ä¿è¯ç»“æœç¬¦åˆ `32-bit` æ•´æ•°èŒƒå›´ã€‚

ç¤ºä¾‹ 1ï¼š
```Â 
è¾“å…¥ï¼šnums = [2,1,4,3], left = 2, right = 3

è¾“å‡ºï¼š3

è§£é‡Šï¼šæ»¡è¶³æ¡ä»¶çš„ä¸‰ä¸ªå­æ•°ç»„ï¼š[2], [2, 1], [3]
```
ç¤ºä¾‹ 2ï¼š
```Â 
è¾“å…¥ï¼šnums = [2,9,2,5,6], left = 2, right = 8

è¾“å‡ºï¼š7
```

æç¤ºï¼š
* $1 <= nums.length <= 10^5$
* $0 <= nums[i] <= 10^9$
* $0 <= left <= right <= 10^9$

---

### å•è°ƒæ ˆ

ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä»¤ $[left, right]$ ä¸º $[a, b]$ã€‚

ä¸€ä¸ªå®¹æ˜“æƒ³åˆ°çš„æ€è·¯æ˜¯ä½¿ç”¨ã€Œå•è°ƒæ ˆã€ã€‚

**ç»Ÿè®¡æ‰€æœ‰æœ€å¤§å€¼èŒƒå›´åœ¨ $[a, b]$ ä¹‹é—´çš„å­æ•°ç»„ä¸ªæ•°ï¼Œå¯ç­‰ä»·ä¸ºç»Ÿè®¡æ¯ä¸€ä¸ªèŒƒå›´è½åœ¨ $[a, b]$ ä¹‹é—´çš„ $nums[i]$ ä½œä¸ºæœ€å¤§å€¼æ—¶å­æ•°ç»„çš„ä¸ªæ•°ã€‚**

ç”±æ­¤å¯ä»¥è¿›ä¸€æ­¥å°†é—®é¢˜è½¬æ¢ä¸ºï¼šæ±‚è§£æ¯ä¸ª $nums[i]$ ä½œä¸ºå­æ•°ç»„æœ€å¤§å€¼æ—¶ï¼Œæœ€è¿œçš„åˆæ³•å·¦å³ç«¯ç‚¹çš„ä½ç½®ã€‚ä¹Ÿå°±æ˜¯æ±‚è§£æ¯ä¸€ä¸ª $nums[i]$ å·¦å³æœ€è¿‘ä¸€ä¸ªæ¯”å…¶â€œå¤§â€çš„ä½ç½®ï¼Œè¿™å¯ä»¥ä½¿ç”¨ã€Œå•è°ƒæ ˆã€æ¥è¿›è¡Œæ±‚è§£ã€‚

> å¯¹äºå•è°ƒæ ˆä¸äº†è§£çš„åŒå­¦ï¼Œå¯ä»¥çœ‹å‰ç½® ğŸ§€ : [ã€RMQ ä¸“é¢˜ã€‘å…³äº RMQ çš„è‹¥å¹²è§£æ³•](https://mp.weixin.qq.com/s?__biz=MzU4NDE3MTEyMA==&mid=2247493262&idx=1&sn=2d8e192a5767b49b9a13a6192ab3b833)

**ç»Ÿè®¡æ‰€æœ‰ $nums[i]$ å¯¹ç­”æ¡ˆçš„è´¡çŒ®å³æ˜¯æœ€ç»ˆç­”æ¡ˆï¼Œä½†æˆ‘ä»¬å¿½ç•¥äº†ã€Œå½“  `nums` å­˜åœ¨é‡å¤å…ƒç´ ï¼Œä¸”è¯¥å…ƒç´ ä½œä¸ºå­æ•°ç»„æœ€å¤§å€¼æ—¶ï¼Œæœ€è¿œå·¦å³ç«¯ç‚¹çš„è¾¹ç•Œè¶Šè¿‡é‡å¤å…ƒç´ æ—¶ï¼Œå¯¼è‡´é‡å¤ç»Ÿè®¡å­æ•°ç»„ã€çš„é—®é¢˜ã€‚**

æˆ‘ä»¬ä¸å¤±ä¸€èˆ¬æ€§çš„ä¸¾ä¸ª ğŸŒ° æ¥ç†è§£ï¼ˆä¸‹å›¾ï¼‰ï¼š

![](https://pic.leetcode.cn/1669252798-kJygAC-WechatIMG2612.png)

ä¸ºäº†æ¶ˆé™¤è¿™ç§é‡å¤ç»Ÿè®¡ï¼Œæˆ‘ä»¬å¯ä»¥å°†ã€Œæœ€è¿œå·¦å³è¾¹ç•Œã€çš„ä¸€ç«¯ï¼Œä»ã€Œä¸¥æ ¼å°äºã€è°ƒæ•´ä¸ºã€Œå°äºç­‰äºã€ï¼Œä»è€Œå®ç°åŠå¼€åŠé—­çš„æ•ˆæœã€‚

Java ä»£ç ï¼š
```Java
class Solution {
    public int numSubarrayBoundedMax(int[] nums, int a, int b) {
        int n = nums.length, ans = 0;
        int[] l = new int[n + 10], r = new int[n + 10];
        Arrays.fill(l, -1); Arrays.fill(r, n);
        Deque<Integer> d = new ArrayDeque<>();
        for (int i = 0; i < n; i++) {
            while (!d.isEmpty() && nums[d.peekLast()] < nums[i]) r[d.pollLast()] = i;
            d.addLast(i);
        }
        d.clear();
        for (int i = n - 1; i >= 0; i--) {
            while (!d.isEmpty() && nums[d.peekLast()] <= nums[i]) l[d.pollLast()] = i;
            d.addLast(i);
        }
        for (int i = 0; i < n; i++) {
            if (nums[i] < a || nums[i] > b) continue;
            ans += (i - l[i]) * (r[i] - i);
        }
        return ans;
    }
}
```
C++ ä»£ç ï¼š
```C++
class Solution {
public:
    int numSubarrayBoundedMax(vector<int>& nums, int a, int b) {
        int n = nums.size(), ans = 0;
        vector<int> l(n + 10, -1), r(n + 10, n);
        deque<int> d;
        for (int i = 0; i < n; i++) {
            while (!d.empty() && nums[d.back()] < nums[i]) {
                r[d.back()] = i;
                d.pop_back();
            }
            d.push_back(i);
        }
        d.clear();
        for (int i = n - 1; i >= 0; i--) {
            while (!d.empty() && nums[d.back()] <= nums[i]) {
                l[d.back()] = i;
                d.pop_back();
            }
            d.push_back(i);
        }
        for (int i = 0; i < n; i++) {
            if (nums[i] < a || nums[i] > b) continue;
            ans += (i - l[i]) * (r[i] - i);
        }
        return ans;
    }
};
```
Python3 ä»£ç ï¼š
```Python
class Solution:
    def numSubarrayBoundedMax(self, nums: List[int], a: int, b: int) -> int:
        n, ans = len(nums), 0
        l, r = [-1] * n, [n] * n
        stk = []
        for i in range(n):
            while stk and nums[stk[-1]] < nums[i]:
                r[stk.pop()] = i
            stk.append(i)
        stk = []
        for i in range(n - 1, -1, -1):
            while stk and nums[stk[-1]] <= nums[i]:
                l[stk.pop()] = i
            stk.append(i)
        for i in range(n):
            if a <= nums[i] <= b:
                ans += (i - l[i]) * (r[i] - i)
        return ans
```
TypeScript ä»£ç ï¼š
```TypeScript
function numSubarrayBoundedMax(nums: number[], a: number, b: number): number {
    let n = nums.length, ans = 0
    const l = new Array<number>(n).fill(-1), r = new Array<number>(n).fill(n)
    let stk = new Array<number>()
    for (let i = 0; i < n; i++) {
        while (stk.length > 0 && nums[stk[stk.length - 1]] < nums[i]) r[stk.pop()] = i
        stk.push(i)
    }
    stk = new Array<number>()
    for (let i = n - 1; i >= 0; i--) {
        while (stk.length > 0 && nums[stk[stk.length - 1]] <= nums[i]) l[stk.pop()] = i
        stk.push(i)
    }
    for (let i = 0; i < n; i++) {
        if (nums[i] < a || nums[i] > b) continue
        ans += (i - l[i]) * (r[i] - i)
    }
    return ans
}
```
* æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

---

### æ¨¡æ‹Ÿ

é™¤äº†ç»Ÿè®¡ã€Œæ¯ä¸ª $nums[i]$ ä½œä¸ºå­æ•°ç»„æœ€å¤§å€¼æ—¶ï¼Œæ‰€èƒ½è´¡çŒ®çš„å­æ•°ç»„ä¸ªæ•°ã€ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç»Ÿè®¡ã€Œæ¯ä¸ª $nums[i]$ ä½œä¸ºå­æ•°ç»„å³ç«¯ç‚¹æ—¶ï¼Œæ‰€èƒ½è´¡çŒ®çš„å­æ•°ç»„ä¸ªæ•°ã€ã€‚

å…·ä½“çš„ï¼Œæˆ‘ä»¬ä»å‰å¾€åå¤„ç†æ¯ä¸ª $nums[i]$ï¼Œå¹¶ç»Ÿè®¡å…¶ä½œä¸ºå­æ•°ç»„å³ç«¯ç‚¹æ—¶ï¼Œæ‰€èƒ½è´¡çŒ®çš„å­æ•°ç»„ä¸ªæ•°ã€‚åŒæ—¶ä½¿ç”¨å˜é‡ `j` å’Œ `k` åˆ†åˆ«è®°å½•æœ€è¿‘ä¸€æ¬¡æ»¡è¶³ã€Œ$nums[i]$ èŒƒå›´è½åœ¨ $[a, b]$ ä¹‹é—´ã€ä»¥åŠã€Œ$nums[i]$ æ•°å€¼å¤§äº $b$ã€çš„ä¸‹æ ‡ä½ç½®ã€‚

éå†è¿‡ç¨‹ä¸­æ ¹æ® $nums[i]$ ä¸è§„å®šèŒƒå›´ $[a, b]$ ä¹‹é—´çš„å…³ç³»è¿›è¡Œåˆ†æƒ…å†µè®¨è®ºï¼š

* $nums[i]$ å¤§äº $b$ï¼Œ$nums[i]$ ä½œä¸ºå³ç«¯ç‚¹ï¼Œå¿…ä¸å¯èƒ½è´¡çŒ®åˆæ³•å­æ•°ç»„ã€‚æ›´æ–° `k`ï¼›
* $nums[i]$ å°äº $a$ï¼Œæ­¤æ—¶ $nums[i]$ æƒ³ä½œä¸ºå³ç«¯ç‚¹çš„è¯ï¼Œå­æ•°ç»„å¿…é¡»æœ‰å…¶ä»–æ»¡è¶³ã€ŒèŒƒå›´è½åœ¨ $[a, b]$ ä¹‹é—´ã€çš„å…¶ä»–æ•°ï¼Œè€Œæœ€è¿‘ä¸€ä¸ªæ»¡è¶³è¦æ±‚çš„ä½ç½®ä¸º $j$ï¼Œè‹¥æœ‰ $j > k$ï¼Œè¯´æ˜èŒƒå›´åœ¨ $(k, j]$ å‡èƒ½ä½œä¸ºå­æ•°ç»„çš„å·¦ç«¯ç‚¹ï¼Œç´¯åŠ æ–¹æ¡ˆæ•° $j - k$ï¼›è‹¥æœ‰ $j < k$ï¼Œè¯´æ˜æˆ‘ä»¬æ— æ³•æ‰¾åˆ°ä»»ä½•ä¸€ä¸ªå·¦ç«¯ç‚¹ï¼Œä½¿å¾—å½¢æˆçš„å­æ•°ç»„æ»¡è¶³è¦æ±‚ï¼ˆè¦ä¹ˆæœ€å€¼ä¸åœ¨ $[a, b]$ èŒƒå›´å†…ï¼Œè¦ä¹ˆæœ‰ $[a, b]$ èŒƒå›´å†…çš„æ•°ï¼Œä½†æœ€å¤§å€¼åˆå¤§äº `b` å€¼ï¼‰ï¼›
* $nums[i]$ è½åœ¨èŒƒå›´ $[a, b]$ï¼Œæ­¤æ—¶ $nums[i]$ æƒ³ä½œä¸ºå³ç«¯ç‚¹çš„è¯ï¼Œåªéœ€è¦æ‰¾åˆ°å·¦è¾¹ç¬¬ä¸€ä¸ªæ•°å€¼å¤§äº $b$ çš„æ•°å€¼å³å¯ï¼ˆå³å˜é‡ `k`ï¼‰ï¼Œç´¯åŠ æ–¹æ¡ˆæ•° $i - k$ã€‚æ›´æ–° `j`ã€‚

Java ä»£ç ï¼š
```Java
class Solution {
    public int numSubarrayBoundedMax(int[] nums, int a, int b) {
        int n = nums.length, ans = 0;
        for (int i = 0, j = -1, k = -1; i < n; i++) {
            if (nums[i] > b) {
                k = i;
            } else {
                if (nums[i] < a) {
                    if (j > k) ans += j - k;
                } else {
                    ans += i - k;
                    j = i;
                }
            }
        }
        return ans;
    }
}
```
C++ ä»£ç ï¼š
```C++
class Solution {
public:
    int numSubarrayBoundedMax(vector<int>& nums, int a, int b) {
        int n = nums.size(), ans = 0;
        for (int i = 0, j = -1, k = -1; i < n; i++) {
            if (nums[i] > b) {
                k = i;
            } else {
                if (nums[i] < a) {
                    if (j > k) ans += j - k;
                } else {
                    ans += i - k;
                    j = i;
                }
            }
        }
        return ans;
    }
};
```
Python3 ä»£ç ï¼š
```Python
class Solution:
    def numSubarrayBoundedMax(self, nums: List[int], a: int, b: int) -> int:
        n, ans = len(nums), 0
        j, k = -1, -1
        for i in range(n):
            if nums[i] > b:
                k = i
            else:
                if nums[i] < a:
                    ans += j - k if j > k else 0
                else:
                    ans += i - k
                    j = i
        return ans
```
TypeScript ä»£ç ï¼š
```TypeScript
function numSubarrayBoundedMax(nums: number[], a: number, b: number): number {
    let n = nums.length, ans = 0
    for (let i = 0, j = -1, k = -1; i < n; i++) {
        if (nums[i] > b) {
            k = i
        } else {
            if (nums[i] < a) {
                if (j > k) ans += j - k
            } else {
                ans += i - k
                j = i
            }
        }
    }
    return ans
}
```
* æ—¶é—´å¤æ‚åº¦ï¼š$O(n)$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(1)$

---

### æœ€å

è¿™æ˜¯æˆ‘ä»¬ã€Œåˆ·ç©¿ LeetCodeã€ç³»åˆ—æ–‡ç« çš„ç¬¬ `No.795` ç¯‡ï¼Œç³»åˆ—å¼€å§‹äº 2021/01/01ï¼Œæˆªæ­¢äºèµ·å§‹æ—¥ LeetCode ä¸Šå…±æœ‰ 1916 é“é¢˜ç›®ï¼Œéƒ¨åˆ†æ˜¯æœ‰é”é¢˜ï¼Œæˆ‘ä»¬å°†å…ˆæŠŠæ‰€æœ‰ä¸å¸¦é”çš„é¢˜ç›®åˆ·å®Œã€‚

åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« é‡Œé¢ï¼Œé™¤äº†è®²è§£è§£é¢˜æ€è·¯ä»¥å¤–ï¼Œè¿˜ä¼šå°½å¯èƒ½ç»™å‡ºæœ€ä¸ºç®€æ´çš„ä»£ç ã€‚å¦‚æœæ¶‰åŠé€šè§£è¿˜ä¼šç›¸åº”çš„ä»£ç æ¨¡æ¿ã€‚

ä¸ºäº†æ–¹ä¾¿å„ä½åŒå­¦èƒ½å¤Ÿç”µè„‘ä¸Šè¿›è¡Œè°ƒè¯•å’Œæäº¤ä»£ç ï¼Œæˆ‘å»ºç«‹äº†ç›¸å…³çš„ä»“åº“ï¼šhttps://github.com/SharingSource/LogicStack-LeetCode ã€‚

åœ¨ä»“åº“åœ°å€é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°ç³»åˆ—æ–‡ç« çš„é¢˜è§£é“¾æ¥ã€ç³»åˆ—æ–‡ç« çš„ç›¸åº”ä»£ç ã€LeetCode åŸé¢˜é“¾æ¥å’Œå…¶ä»–ä¼˜é€‰é¢˜è§£ã€‚

