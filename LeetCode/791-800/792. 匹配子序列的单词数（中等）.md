### é¢˜ç›®æè¿°

è¿™æ˜¯ LeetCode ä¸Šçš„ **[792. åŒ¹é…å­åºåˆ—çš„å•è¯æ•°](https://leetcode.cn/problems/number-of-matching-subsequences/solution/by-ac_oier-u1ox/)** ï¼Œéš¾åº¦ä¸º **ä¸­ç­‰**ã€‚

Tag : ã€ŒäºŒåˆ†ã€ã€ã€Œå“ˆå¸Œè¡¨ã€



ç»™å®šå­—ç¬¦ä¸² `s`Â å’Œå­—ç¬¦ä¸²æ•°ç»„Â `words`, è¿”å›Â Â `words[i]`Â ä¸­æ˜¯ `s` çš„å­åºåˆ—çš„å•è¯ä¸ªæ•°Â ã€‚

å­—ç¬¦ä¸²çš„å­åºåˆ—æ˜¯ä»åŸå§‹å­—ç¬¦ä¸²ä¸­ç”Ÿæˆçš„æ–°å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä»ä¸­åˆ å»ä¸€äº›å­—ç¬¦(å¯ä»¥æ˜¯`""`)ï¼Œè€Œä¸æ”¹å˜å…¶ä½™å­—ç¬¦çš„ç›¸å¯¹é¡ºåºã€‚

ä¾‹å¦‚ï¼Œ `â€œaceâ€` æ˜¯ `â€œabcdeâ€` çš„å­åºåˆ—ã€‚

ç¤ºä¾‹ 1:
```
è¾“å…¥: s = "abcde", words = ["a","bb","acd","ace"]

è¾“å‡º: 3

è§£é‡Š: æœ‰ä¸‰ä¸ªæ˜¯Â s çš„å­åºåˆ—çš„å•è¯: "a", "acd", "ace"ã€‚
```
ç¤ºä¾‹ 2:
```
è¾“å…¥: s = "dsahjpjauf", words = ["ahjpjau","ja","ahbwzgqnuk","tnmlanowax"]

è¾“å‡º: 2
```

æç¤º:
* $1 <= s.length <= 5 \times 10^4$
* $1 <= words.length <= 5000$
* $1 <= words[i].length <= 50$
* `words[i]` å’Œ `s`Â éƒ½åªç”±å°å†™å­—æ¯ç»„æˆã€‚

---

### é¢„å¤„ç† + å“ˆå¸Œè¡¨ + äºŒåˆ†

æœ´ç´ åˆ¤å®šæŸä¸ªå­—ç¬¦ä¸²æ˜¯ä¸ºå¦ä¸€å­—ç¬¦ä¸²çš„å­åºåˆ—çš„å¤æ‚åº¦ä¸º $O(n + m)$ï¼Œå¯¹äºæœ¬é¢˜å…±æœ‰ $5000$ ä¸ªå­—ç¬¦ä¸²éœ€è¦åˆ¤å®šï¼Œæ¯ä¸ªå­—ç¬¦ä¸²æœ€å¤šé•¿ä¸º $50$ï¼Œå› æ­¤æ•´ä½“è®¡ç®—é‡ä¸º $(5 \times 10^4 + 50) \times 5000 \approx 2.5 \times 10^8$ï¼Œä¼šè¶…æ—¶ã€‚

ä¸å¯é¿å…çš„æ˜¯ï¼Œæˆ‘ä»¬è¦å¯¹æ¯ä¸ª $words[i]$ è¿›è¡Œæ£€æŸ¥ï¼Œå› æ­¤ä¼˜åŒ–çš„æ€è·¯å¯æ”¾åœ¨å¦‚ä½•ä¼˜åŒ–å•ä¸ª $words[i]$ çš„åˆ¤å®šæ“ä½œã€‚

æœ´ç´ çš„åˆ¤å®šè¿‡ç¨‹éœ€è¦ä½¿ç”¨åŒæŒ‡é’ˆæ‰«æä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå…¶ä¸­å¯¹äºåŸä¸²çš„æ‰«æï¼Œä¼šæœ‰å¤§é‡çš„å­—ç¬¦ä¼šè¢«è·³è¿‡ï¼ˆæ— æ•ˆåŒ¹é…ï¼‰ï¼Œå³åªæœ‰ä¸¤æŒ‡é’ˆå¯¹åº”çš„å­—ç¬¦ç›¸åŒæ—¶ï¼ŒåŒ¹é…ä¸²æŒ‡é’ˆæ‰ä¼šåç§»ã€‚

æˆ‘ä»¬è€ƒè™‘å¦‚ä½•ä¼˜åŒ–è¿™éƒ¨åˆ†æ— æ•ˆåŒ¹é…ã€‚

å¯¹äºä»»æ„ä¸€ä¸ª $w = words[i]$ è€Œè¨€ï¼Œå‡è®¾æˆ‘ä»¬å½“å‰åŒ¹é…åˆ° $w[j]$ ä½ç½®ï¼Œæ­¤æ—¶æˆ‘ä»¬å·²ç»æ˜ç¡®ä¸‹ä¸€ä¸ªå¾…åŒ¹é…çš„å­—ç¬¦ä¸º $w[j + 1]$ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨ `s` ä¸­å­—ç¬¦ä¸º $w[j + 1]$ çš„ä½ç½®ä¸­æ‰¾å€™é€‰ã€‚

å…·ä½“çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å“ˆå¸Œè¡¨ `map` å¯¹ `s` è¿›è¡Œé¢„å¤„ç†ï¼šä»¥å­—ç¬¦ $c = s[i]$ ä¸ºå“ˆå¸Œè¡¨çš„ `key`ï¼Œå¯¹åº”çš„ä¸‹æ ‡ $i$ é›†åˆä¸º `value`ï¼Œç”±äºæˆ‘ä»¬ä»å‰å¾€åå¤„ç† `s` è¿›è¡Œé¢„å¤„ç†ï¼Œå› æ­¤å¯¹äºæ‰€æœ‰çš„ `value` å‡æ»¡è¶³é€’å¢æ€§è´¨ã€‚

> ä¸¾ä¸ª ğŸŒ° : å¯¹äº `s = abcabc` è€Œè¨€ï¼Œé¢„å¤„ç†çš„å“ˆå¸Œè¡¨ä¸º `{a=[0,3], b=[1,4], c=[2,5]}`

æœ€åè€ƒè™‘å¦‚ä½•åˆ¤å®šæŸä¸ª $w = words[i]$ æ˜¯å¦æ»¡è¶³è¦æ±‚ï¼šå¾…åŒ¹é…å­—ç¬¦ä¸² `w` é•¿åº¦ä¸º `m`ï¼Œæˆ‘ä»¬ä»å‰å¾€åå¯¹ `w` è¿›è¡Œåˆ¤å®šï¼Œå‡è®¾å½“å‰åˆ¤å¾…åŒ¹é…ä½ç½®ä¸º $w[i]$ï¼Œæˆ‘ä»¬ä½¿ç”¨å˜é‡ `idx` ä»£è¡¨èƒ½å¤Ÿæ»¡è¶³åŒ¹é… $w[0:i]$ çš„æœ€å°ä¸‹æ ‡ï¼ˆè´ªå¿ƒæ€è·¯ï¼‰ã€‚

å¯¹äºåŒ¹é…çš„ $w[i]$ å­—ç¬¦ï¼Œå¯ä»¥ç­‰ä»·ä¸ºåœ¨ `map[w[i]]` ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªå¤§äº `idx` çš„ä¸‹æ ‡ï¼Œå«ä¹‰åœ¨åŸä¸² `s` ä¸­æ‰¾åˆ°å­—ç¬¦ä¸º `w[i]` ä¸”ä¸‹æ ‡å¤§äº `idx` çš„æœ€å°å€¼ï¼Œç”±äºæˆ‘ä»¬æ‰€æœ‰çš„ `map[X]` å‡æ»¡è¶³å•è°ƒé€’å¢ï¼Œè¯¥è¿‡ç¨‹å¯ä½¿ç”¨ã€ŒäºŒåˆ†ã€è¿›è¡Œã€‚

Java ä»£ç ï¼š
```Java
class Solution {
    public int numMatchingSubseq(String s, String[] words) {
        int n = s.length(), ans = 0;
        Map<Character, List<Integer>> map = new HashMap<>();
        for (int i = 0; i < n; i++) {
            List<Integer> list = map.getOrDefault(s.charAt(i), new ArrayList<>());
            list.add(i);
            map.put(s.charAt(i), list);
        }
        for (String w : words) {
            boolean ok = true;
            int m = w.length(), idx = -1;
            for (int i = 0; i < m && ok; i++) {
                List<Integer> list = map.getOrDefault(w.charAt(i), new ArrayList<>());
                int l = 0, r = list.size() - 1;
                while (l < r) {
                    int mid = l + r >> 1;
                    if (list.get(mid) > idx) r = mid;
                    else l = mid + 1;
                }
                if (r < 0 || list.get(r) <= idx) ok = false;
                else idx = list.get(r);
            }
            if (ok) ans++;
        }
        return ans;
    }
}
```
TypeScript ä»£ç ï¼š
```TypeScript
function numMatchingSubseq(s: string, words: string[]): number {
    let n = s.length, ans = 0
    const map = new Map<String, Array<number>>()
    for (let i = 0; i < n; i++) {
        if (!map.has(s[i])) map.set(s[i], new Array<number>())
        map.get(s[i]).push(i)
    }
    for (const w of words) {
        let ok = true
        let m = w.length, idx = -1
        for (let i = 0; i < m && ok; i++) {
            if (!map.has(w[i])) {
                ok = false
            } else {
                const list = map.get(w[i])
                let l = 0, r = list.length - 1
                while (l < r) {
                    const mid = l + r >> 1
                    if (list[mid] > idx) r = mid
                    else l = mid + 1
                }
                if (r < 0 || list[r] <= idx) ok = false
                else idx = list[r]
            }
        }
        if (ok) ans++
    }
    return ans
}
```
Python3 ä»£ç ï¼š
```Python
class Solution:
    def numMatchingSubseq(self, s: str, words: List[str]) -> int:
        dmap = defaultdict(list)
        for i, c in enumerate(s):
            dmap[c].append(i)
        ans = 0
        for w in words:
            ok = True
            idx = -1
            for i in range(len(w)):
                idxs = dmap[w[i]]
                l, r = 0, len(idxs) - 1
                while l < r :
                    mid = l + r >> 1
                    if dmap[w[i]][mid] > idx:
                        r = mid
                    else:
                        l = mid + 1
                if r < 0 or dmap[w[i]][r] <= idx:
                    ok = False
                    break
                else:
                    idx = dmap[w[i]][r]
            ans += 1 if ok else 0
        return ans
```
* æ—¶é—´å¤æ‚åº¦ï¼šä»¤ `n` ä¸º `s` é•¿åº¦ï¼Œ`m` ä¸º `words` é•¿åº¦ï¼Œ`l = 50` ä¸º $words[i]$ é•¿åº¦çš„æœ€å¤§å€¼ã€‚æ„é€  `map` çš„å¤æ‚åº¦ä¸º $O(n)$ï¼›ç»Ÿè®¡ç¬¦åˆè¦æ±‚çš„ $words[i]$ çš„æ•°é‡å¤æ‚åº¦ä¸º $O(m \times l \times \log{n})$ã€‚æ•´ä½“å¤æ‚åº¦ä¸º $O(n + m \times l \times \log{n})$
* ç©ºé—´å¤æ‚åº¦ï¼š$O(n)$

---

### æœ€å

è¿™æ˜¯æˆ‘ä»¬ã€Œåˆ·ç©¿ LeetCodeã€ç³»åˆ—æ–‡ç« çš„ç¬¬ `No.792` ç¯‡ï¼Œç³»åˆ—å¼€å§‹äº 2021/01/01ï¼Œæˆªæ­¢äºèµ·å§‹æ—¥ LeetCode ä¸Šå…±æœ‰ 1916 é“é¢˜ç›®ï¼Œéƒ¨åˆ†æ˜¯æœ‰é”é¢˜ï¼Œæˆ‘ä»¬å°†å…ˆæŠŠæ‰€æœ‰ä¸å¸¦é”çš„é¢˜ç›®åˆ·å®Œã€‚

åœ¨è¿™ä¸ªç³»åˆ—æ–‡ç« é‡Œé¢ï¼Œé™¤äº†è®²è§£è§£é¢˜æ€è·¯ä»¥å¤–ï¼Œè¿˜ä¼šå°½å¯èƒ½ç»™å‡ºæœ€ä¸ºç®€æ´çš„ä»£ç ã€‚å¦‚æœæ¶‰åŠé€šè§£è¿˜ä¼šç›¸åº”çš„ä»£ç æ¨¡æ¿ã€‚

ä¸ºäº†æ–¹ä¾¿å„ä½åŒå­¦èƒ½å¤Ÿç”µè„‘ä¸Šè¿›è¡Œè°ƒè¯•å’Œæäº¤ä»£ç ï¼Œæˆ‘å»ºç«‹äº†ç›¸å…³çš„ä»“åº“ï¼šhttps://github.com/SharingSource/LogicStack-LeetCode ã€‚

åœ¨ä»“åº“åœ°å€é‡Œï¼Œä½ å¯ä»¥çœ‹åˆ°ç³»åˆ—æ–‡ç« çš„é¢˜è§£é“¾æ¥ã€ç³»åˆ—æ–‡ç« çš„ç›¸åº”ä»£ç ã€LeetCode åŸé¢˜é“¾æ¥å’Œå…¶ä»–ä¼˜é€‰é¢˜è§£ã€‚

